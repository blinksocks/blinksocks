/*!
 * Copyright (c) 2016-present, blinksocks. All rights reserved.
 * 
 * name: blinksocks.js
 * version: v2.6.1
 * hash: 913f2249dd6432212497
 */
module.exports=function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=34)}([function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(49);Object.keys(r).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var a=n(52);Object.keys(a).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=n(54);Object.keys(o).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=n(55);Object.keys(s).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var i=n(56);Object.keys(i).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var d=n(57);Object.keys(d).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})});var l=n(58);Object.keys(l).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})})},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0});const n=t.CONNECTION_CREATED='@action:connection_created',r=t.CONNECTION_CLOSED='@action:connection_closed',a=t.CONNECTION_WILL_CLOSE='@action:connection_will_close',o=t.CONNECT_TO_REMOTE='@action:connect_to_remote',s=t.PRESET_FAILED='@action:preset_failed',i=t.PRESET_CLOSE_CONNECTION='@action:preset_close_connection',d=t.PRESET_PAUSE_RECV='@action:preset_pause_recv',l=t.PRESET_PAUSE_SEND='@action:preset_pause_send',c=t.PRESET_RESUME_RECV='@action:preset_resume_recv',u=t.PRESET_RESUME_SEND='@action:preset_resume_send';class p{static checkParams(){}static onInit(){}onNotified(){return!1}onDestroy(){}beforeOut({buffer:e}){return e}beforeIn({buffer:e}){return e}clientOut({buffer:e}){return e}serverIn({buffer:e}){return e}serverOut({buffer:e}){return e}clientIn({buffer:e}){return e}next(){}broadcast(){}fail(){}}t.IPreset=p;class m extends p{constructor(){if(super(),m.isInstantiated)throw Error(`${this.constructor.name} is singleton and can only be instantiated once`);m.isInstantiated=!0}}t.IPresetStatic=m,m.isInstantiated=!1},function(e){e.exports=require('crypto')},function(e){e.exports=require('fs')},function(e){e.exports=require('net')},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(89);Object.keys(r).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var a=n(90);Object.keys(a).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e){e.exports=require('events')},function(e){e.exports=require('os')},function(e){e.exports=require('util')},function(e){e.exports=require('path')},function(e,t,n){'use strict';function r(e){return e?e.toLowerCase():'ipv4'}var o=t,a=n(50).Buffer,s=n(7);o.toBuffer=function(e,t,n){n=~~n;var r;if(this.isV4Format(e))r=t||new a(n+4),e.split(/\./g).map(function(e){r[n++]=255&parseInt(e,10)});else if(this.isV6Format(e)){var o=e.split(':',8),s;for(s=0;s<o.length;s++){var i=this.isV4Format(o[s]),d;i&&(d=this.toBuffer(o[s]),o[s]=d.slice(0,2).toString('hex')),d&&8>++s&&o.splice(s,0,d.slice(2,4).toString('hex'))}if(''===o[0])for(;8>o.length;)o.unshift('0');else if(''===o[o.length-1])for(;8>o.length;)o.push('0');else if(8>o.length){for(s=0;s<o.length&&''!==o[s];s++);var l=[s,1];for(s=9-o.length;0<s;s--)l.push('0');o.splice.apply(o,l)}for(r=t||new a(n+16),s=0;s<o.length;s++){var c=parseInt(o[s],16);r[n++]=255&c>>8,r[n++]=255&c}}if(!r)throw Error('Invalid ip address: '+e);return r},o.toString=function(e,t,n){t=~~t,n=n||e.length-t;var r=[];if(4===n){for(var a=0;a<n;a++)r.push(e[t+a]);r=r.join('.')}else if(16===n){for(var a=0;a<n;a+=2)r.push(e.readUInt16BE(t+a).toString(16));r=r.join(':'),r=r.replace(/(^|:)0(:0)*:0(:|$)/,'$1::$3'),r=r.replace(/:{3,4}/,'::')}return r};var i=/^(\d{1,3}\.){3,3}\d{1,3}$/,d=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i;o.isV4Format=function(e){return i.test(e)},o.isV6Format=function(e){return d.test(e)},o.fromPrefixLen=function(e,t){t=32<e?'ipv6':r(t);var s=4;'ipv6'===t&&(s=16);for(var d=new a(s),l=0,i=d.length,n;l<i;++l)n=8,8>e&&(n=e),e-=n,d[l]=255&~(255>>n);return o.toString(d)},o.mask=function(e,t){e=o.toBuffer(e),t=o.toBuffer(t);var n=new a(Math.max(e.length,t.length)),r=0;if(e.length===t.length)for(r=0;r<e.length;r++)n[r]=e[r]&t[r];else if(4===t.length)for(r=0;r<t.length;r++)n[r]=e[e.length-4+r]&t[r];else{for(var r=0;r<n.length-6;r++)n[r]=0;for(n[10]=255,n[11]=255,r=0;r<e.length;r++)n[r+12]=e[r]&t[r+12];r+=12}for(;r<n.length;r++)n[r]=0;return o.toString(n)},o.cidr=function(e){var t=e.split('/'),n=t[0];if(2!==t.length)throw new Error('invalid CIDR subnet: '+n);var r=o.fromPrefixLen(parseInt(t[1],10));return o.mask(n,r)},o.subnet=function(e,t){for(var n=o.toLong(o.mask(e,t)),r=o.toBuffer(t),a=0,s=0;s<r.length;s++)if(255===r[s])a+=8;else for(var i=255&r[s];i;)i=255&i<<1,a++;var d=Math.pow(2,32-a);return{networkAddress:o.fromLong(n),firstAddress:2>=d?o.fromLong(n):o.fromLong(n+1),lastAddress:2>=d?o.fromLong(n+d-1):o.fromLong(n+d-2),broadcastAddress:o.fromLong(n+d-1),subnetMask:t,subnetMaskLength:a,numHosts:2>=d?d:d-2,length:d,contains:function(e){return n===o.toLong(o.mask(e,t))}}},o.cidrSubnet=function(e){var t=e.split('/'),n=t[0];if(2!==t.length)throw new Error('invalid CIDR subnet: '+n);var r=o.fromPrefixLen(parseInt(t[1],10));return o.subnet(n,r)},o.not=function(e){for(var t=o.toBuffer(e),n=0;n<t.length;n++)t[n]=255^t[n];return o.toString(t)},o.or=function(e,t){if(e=o.toBuffer(e),t=o.toBuffer(t),e.length===t.length){for(var n=0;n<e.length;++n)e[n]|=t[n];return o.toString(e)}var r=e,a=t;t.length>e.length&&(r=t,a=e);for(var s=r.length-a.length,n=s;n<r.length;++n)r[n]|=a[n-s];return o.toString(r)},o.isEqual=function(e,n){if(e=o.toBuffer(e),n=o.toBuffer(n),e.length===n.length){for(var r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}if(4===n.length){var a=n;n=e,e=a}for(var r=0;10>r;r++)if(0!==n[r])return!1;var t=n.readUInt16BE(10);if(0!==t&&65535!==t)return!1;for(var r=0;4>r;r++)if(e[r]!==n[r+12])return!1;return!0},o.isPrivate=function(e){return /^(::f{4}:)?10\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?192\.168\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?172\.(1[6-9]|2\d|30|31)\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?169\.254\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^f[cd][0-9a-f]{2}:/i.test(e)||/^fe80:/i.test(e)||/^::1$/.test(e)||/^::$/.test(e)},o.isPublic=function(e){return!o.isPrivate(e)},o.isLoopback=function(e){return /^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})/.test(e)||/^fe80::1$/.test(e)||/^::1$/.test(e)||/^::$/.test(e)},o.loopback=function(e){if(e=r(e),'ipv4'!==e&&'ipv6'!==e)throw new Error('family must be ipv4 or ipv6');return'ipv4'===e?'127.0.0.1':'fe80::1'},o.address=function(e,t){var n=s.networkInterfaces(),a;if(t=r(t),e&&'private'!==e&&'public'!==e){var i=n[e].filter(function(e){var n=e.family.toLowerCase();return n===t});return 0===i.length?void 0:i[0].address}var a=Object.keys(n).map(function(r){var a=n[r].filter(function(n){return(n.family=n.family.toLowerCase(),!(n.family!==t||o.isLoopback(n.address)))&&(!e||('public'===e?o.isPrivate(n.address):o.isPublic(n.address)))});return a.length?a[0].address:void 0}).filter(Boolean);return a.length?a[0]:o.loopback(t)},o.toLong=function(e){var t=0;return e.split('.').forEach(function(e){t<<=8,t+=parseInt(e)}),t>>>0},o.fromLong=function(e){return(e>>>24)+'.'+(255&e>>16)+'.'+(255&e>>8)+'.'+(255&e)}},function(e,t,n){'use strict';var r=n(8),a=n(2),o=n(62),s=n(3),i=n(63).StringDecoder,d=n(13).Stream,l=n(17);t.setLevels=function(e,n,r){this;return n&&Object.keys(n).forEach(function(t){delete e[t]}),e.levels=r||l.npm.levels,e.padLevels&&(e.levelLength=t.longestElement(Object.keys(e.levels))),Object.keys(e.levels).forEach(function(t){return'log'===t?void console.warn('Log level named "log" will clash with the method "log". Consider using a different name.'):void(e[t]=function(){var n=[t].concat(Array.prototype.slice.call(arguments));e.log.apply(e,n)})}),e},t.longestElement=function(e){return Math.max.apply(null,e.map(function(e){return e.length}))},t.clone=function(e){var n={};if(e instanceof Error)return n={message:e.message},Object.getOwnPropertyNames(e).forEach(function(t){n[t]=e[t]}),n;if(!(e instanceof Object))return e;if(e instanceof Date)return new Date(e.getTime());for(var r in e)Array.isArray(e[r])?n[r]=e[r].slice(0):e[r]instanceof Buffer?n[r]=e[r].slice(0):'function'==typeof e[r]?'function'==typeof e[r]&&(n[r]=e[r]):n[r]=e[r]instanceof Object?t.clone(e[r]):e[r];return n},t.log=function(e){var n='function'==typeof e.timestamp?e.timestamp:t.timestamp,a=e.timestamp?n():null,s=void 0===e.showLevel||e.showLevel,i=null===e.meta||void 0===e.meta||e.meta instanceof Error?e.meta||null:t.clone(o.decycle(e.meta)),d;if(e.raw)return'object'!=typeof i&&null!=i&&(i={meta:i}),d=t.clone(i)||{},d.level=e.level,d.message=e.message.stripColors?e.message.stripColors:e.message,JSON.stringify(d);if(e.json||!0===e.logstash){if('object'!=typeof i&&null!=i&&(i={meta:i}),d=t.clone(i)||{},d.level=e.level,d.message=d.message||'',e.label&&(d.label=e.label),e.message&&(d.message=e.message),a&&(d.timestamp=a),!0===e.logstash){var c={};void 0!==d.message&&(c['@message']=d.message,delete d.message),void 0!==d.timestamp&&(c['@timestamp']=d.timestamp,delete d.timestamp),c['@fields']=t.clone(d),d=c}return'function'==typeof e.stringify?e.stringify(d):JSON.stringify(d,function(e,t){return t instanceof Buffer?t.toString('base64'):t})}if('function'==typeof e.formatter)return e.meta=i,e.formatter(t.clone(e))+'';if(d=a?a+' - ':'',s&&(d+='all'===e.colorize||'level'===e.colorize||!0===e.colorize?l.colorize(e.level):e.level),d+=e.align?'\t':'',d+=a||s?': ':'',d+=e.label?'['+e.label+'] ':'',d+='all'===e.colorize||'message'===e.colorize?l.colorize(e.level,e.message):e.message,null!==i&&void 0!==i)if(i&&i instanceof Error&&i.stack&&(i=i.stack),'object'!=typeof i)d+=' '+i;else if(0<Object.keys(i).length)if('function'==typeof e.prettyPrint)d+=' '+e.prettyPrint(i);else if(e.prettyPrint)d+=' \n'+r.inspect(i,!1,e.depth||null,e.colorize);else if(e.humanReadableUnhandledException&&5===Object.keys(i).length&&i.hasOwnProperty('date')&&i.hasOwnProperty('process')&&i.hasOwnProperty('os')&&i.hasOwnProperty('trace')&&i.hasOwnProperty('stack')){var u=i.stack;delete i.stack,delete i.trace,d+=' '+t.serialize(i),u&&(d+='\n'+u.join('\n'))}else d+=' '+t.serialize(i);return d},t.capitalize=function(e){return e&&e[0].toUpperCase()+e.slice(1)},t.hash=function(e){return a.createHash('sha1').update(e).digest('hex')},t.pad=function(e){return 10>e?'0'+e.toString(10):e.toString(10)},t.timestamp=function(){return new Date().toISOString()},t.serialize=function(e,n){if('symbol'==typeof n&&(n=n.toString()),'symbol'==typeof e&&(e=e.toString()),null===e?e='null':void 0===e?e='undefined':!1===e&&(e='false'),'object'!=typeof e)return n?n+'='+e:e;if(e instanceof Buffer)return n?n+'='+e.toString('base64'):e.toString('base64');for(var r='',a=Object.keys(e),o=a.length,s=0;s<o;s++){if(Array.isArray(e[a[s]])){r+=a[s]+'=[';for(var i=0,d=e[a[s]].length;i<d;i++)r+=t.serialize(e[a[s]][i]),i<d-1&&(r+=', ');r+=']'}else r+=e[a[s]]instanceof Date?a[s]+'='+e[a[s]]:t.serialize(e[a[s]],a[s]);s<o-1&&(r+=', ')}return r},t.tailFile=function(e,t){var n=new Buffer(65536),r=new i('utf8'),a=new d,o='',c=0,u=0;return-1===e.start&&delete e.start,a.readable=!0,a.destroy=function(){a.destroyed=!0,a.emit('end'),a.emit('close')},s.open(e.file,'a+','0644',function(i,d){return i?(t?t(i):a.emit('error',i),void a.destroy()):void function p(){return a.destroyed?void s.close(d):s.read(d,n,0,n.length,c,function(s,d){if(s)return t?t(s):a.emit('error',s),void a.destroy();if(!d)return o&&((null==e.start||u>e.start)&&(t?t(null,o):a.emit('line',o)),u++,o=''),setTimeout(p,1e3);var m=r.write(n.slice(0,d));t||a.emit('data',m);for(var m=(o+m).split(/\n+/),g=m.length-1,l=0;l<g;l++)(null==e.start||u>e.start)&&(t?t(null,m[l]):a.emit('line',m[l])),u++;return o=m[g],c+=d,p()})}()}),t?a.destroy:a},t.stringArrayToSet=function(e,t){return'undefined'==typeof t&&(t='Cannot make set from Array with non-string elements'),e.reduce(function(e,n){if(!('string'==typeof n||n instanceof String))throw new Error(t);return e[n]=!0,e},Object.create(null))}},function(e,t,n){'use strict';var r=t;r.version=n(59).version,r.transports=n(60);var a=n(11);r.hash=a.hash,r.clone=a.clone,r.longestElement=a.longestElement,r.exception=n(28),r.config=n(17),r.addColors=r.config.addColors,r.Container=n(84).Container,r.Logger=n(85).Logger,r.Transport=n(15).Transport,r.loggers=new r.Container;var o=new r.Logger({transports:[new r.transports.Console]});a.setLevels(r,null,o.levels),['log','query','stream','add','remove','clear','profile','startTimer','extend','cli','handleExceptions','unhandleExceptions','configure'].forEach(function(e){r[e]=function(){return o[e].apply(o,arguments)}}),r.cli=function(){return r.padLevels=!0,a.setLevels(r,o.levels,r.config.cli.levels),o.setLevels(r.config.cli.levels),r.config.addColors(r.config.cli.colors),o.transports.console&&(o.transports.console.colorize=!0,o.transports.console.timestamp=!1),r},r.setLevels=function(e){a.setLevels(r,o.levels,e),o.setLevels(e)},Object.defineProperty(r,'level',{get:function(){return o.level},set:function(e){o.level=e,Object.keys(o.transports).forEach(function(t){o.transports[t].level=e})}}),['emitErrs','exitOnError','padLevels','levelLength','stripColors'].forEach(function(e){Object.defineProperty(r,e,{get:function(){return o[e]},set:function(t){o[e]=t}})}),Object.defineProperty(r,'default',{get:function(){return{transports:o.transports,exceptionHandlers:o.exceptionHandlers}}})},function(e){e.exports=require('stream')},function(e,t,n){'use strict';function r(e){var t=function e(){return a.apply(e,arguments)};return t._styles=e,t.__proto__=m,t}function a(){var e=arguments,t=e.length,n=0!==t&&arguments[0]+'';if(1<t)for(var r=1;r<t;r++)n+=' '+e[r];if(!s.enabled||!n)return n;for(var a=this._styles,o=a.length,i;o--;)i=d[a[o]],n=i.open+n.replace(i.closeRe,i.open)+i.close;return n}function o(e){for(var t in e)(function(t){s[t]=function(n){return s[e[t]](n)}})(t)}var s={};e.exports=s,s.themes={};var d=s.styles=n(65),i=Object.defineProperties;s.supportsColor=n(66),'undefined'==typeof s.enabled&&(s.enabled=s.supportsColor),s.stripColors=s.strip=function(e){return(''+e).replace(/\x1B\[\d+m/g,'')};var l=s.stylize=function(e,t){return d[t].open+e+d[t].close},c=/[|\\{}()[\]^$+*?.]/g,u=function(e){if('string'!=typeof e)throw new TypeError('Expected a string');return e.replace(c,'\\$&')},p=function(){var e={};return d.grey=d.gray,Object.keys(d).forEach(function(t){d[t].closeRe=new RegExp(u(d[t].close),'g'),e[t]={get:function(){return r(this._styles.concat(t))}}}),e}(),m=i(function(){},p);s.setTheme=function(e){if('string'==typeof e)try{return s.themes[e]=!function(){var t=new Error('Cannot find module "."');throw t.code='MODULE_NOT_FOUND',t}(),o(s.themes[e]),s.themes[e]}catch(e){return console.log(e),e}else o(e)};var g=function(e,t){var n=t.split('');return n=n.map(e),n.join('')};for(var f in s.trap=n(68),s.zalgo=n(69),s.maps={},s.maps.america=n(70),s.maps.zebra=n(71),s.maps.rainbow=n(72),s.maps.random=n(73),s.maps)(function(e){s[e]=function(t){return g(s.maps[e],t)}})(f);i(s,function(){var e={};return Object.keys(p).forEach(function(t){e[t]={get:function(){return r([t])}}}),e}())},function(e,t,n){'use strict';var r=n(6),a=n(8),o=t.Transport=function(e){r.EventEmitter.call(this),e=e||{},this.silent=e.silent||!1,this.raw=e.raw||!1,this.name=e.name||this.name,this.formatter=e.formatter,this.level=e.level,this.handleExceptions=e.handleExceptions||!1,this.exceptionsLevel=e.exceptionsLevel||'error',this.humanReadableUnhandledException=e.humanReadableUnhandledException||!1};a.inherits(o,r.EventEmitter),o.prototype.formatQuery=function(e){return e},o.prototype.normalizeQuery=function(e){return e=e||{},e.rows=e.rows||e.limit||10,e.start=e.start||0,e.until=e.until||new Date,'object'!=typeof e.until&&(e.until=new Date(e.until)),e.from=e.from||e.until-86400000,'object'!=typeof e.from&&(e.from=new Date(e.from)),e.order=e.order||'desc',e.fields=e.fields,e},o.prototype.formatResults=function(e){return e},o.prototype.logException=function(e,t,n){function r(){o||(o=!0,a.removeListener('logged',r),a.removeListener('error',r),n())}var a=this,o;return this.silent?n():void(this.once('logged',r),this.once('error',r),this.log(a.exceptionsLevel,e,t,function(){}))}},function(e,t,n){'use strict';function r(e,t){let n=l[e.name];return void 0===n&&(e.onInit(t),n=new e(t),l[e.name]=n),n}function a(e,t={}){const n=(0,i.getPresetClassByName)(e);let a=null;return n.__proto__.name===i.IPresetStatic.name?a=r(n,t):(!n.initialized&&(n.onInit(t),n.initialized=!0),a=new n(t)),a}Object.defineProperty(t,'__esModule',{value:!0}),t.Middleware=t.MIDDLEWARE_DIRECTION_DOWNWARD=t.MIDDLEWARE_DIRECTION_UPWARD=void 0,t.createMiddleware=function(e,t={}){try{const n=a(e,t);return new p(n)}catch(e){console.error(e.message),process.exit(-1)}return null},t.cleanup=function(){const e=Object.values(l);var t=!0,n=!1,r;try{for(var a=e[Symbol.iterator](),o;!(t=(o=a.next()).done);t=!0){const e=o.value;e.onDestroy()}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}};var o=n(6),s=function(e){return e&&e.__esModule?e:{default:e}}(o),i=n(19),d=n(0);const l={},c=t.MIDDLEWARE_DIRECTION_UPWARD=1,u=t.MIDDLEWARE_DIRECTION_DOWNWARD=-1;class p extends s.default{constructor(e){super(),this._impl=null,this.onPresetNext=this.onPresetNext.bind(this),this.onPresetBroadcast=this.onPresetBroadcast.bind(this),this.onPresetFail=this.onPresetFail.bind(this),this._impl=e,this._impl.next=this.onPresetNext,this._impl.broadcast=this.onPresetBroadcast,this._impl.fail=this.onPresetFail}get name(){return(0,d.kebabCase)(this._impl.constructor.name).replace(/(.*)-preset/i,'$1')}hasListener(e){return 0<this.listenerCount(e)}notify(e){return this._impl.onNotified(e)}onPresetNext(e,t){this.emit(`next_${e}`,t)}onPresetBroadcast(e){this.emit('broadcast',this.name,e)}onPresetFail(e){this.emit('fail',this.name,e)}onDestroy(){this._impl instanceof i.IPresetStatic||this._impl.onDestroy(),this.removeAllListeners()}write(e,{buffer:t,direct:n}){const r=e===c?'Out':'In',a=this.onPresetBroadcast,o=this.onPresetFail,s=(t,r=!1)=>{const a=this.emit(`next_${r?-e:e}`,t);a||n(t,r)},i=(e)=>{const t={buffer:e,next:s,broadcast:a,direct:n,fail:o},i=__IS_CLIENT__?this._impl[`client${r}`](t):this._impl[`server${r}`](t);i instanceof Buffer&&s(i)},d=this._impl[`before${r}`]({buffer:t,next:i,broadcast:a,direct:n,fail:o});d instanceof Buffer&&i(d)}}t.Middleware=p},function(e,t,n){'use strict';function r(e){var t=Array.prototype.slice.call(arguments,1);return t.forEach(function(t){for(var n=Object.keys(t),r=0;r<n.length;r++)e[n[r]]=t[n[r]]}),e}var a=n(64);a.enabled=!0;var o=t,s=t.allColors={};o.addColors=function(e){r(s,e)},o.colorize=function(e,t){'undefined'==typeof t&&(t=e);var n=t;if(s[e]instanceof Array)for(var r=0,o=s[e].length;r<o;++r)n=a[s[e][r]](n);else if(s[e].match(/\s/)){for(var i=s[e].split(/\s+/),r=0;r<i.length;++r)n=a[i[r]](n);s[e]=i}else n=a[s[e]](n);return n},o.cli=n(74),o.npm=n(75),o.syslog=n(76),o.addColors(o.cli.colors),o.addColors(o.npm.colors),o.addColors(o.syslog.colors)},function(e){e.exports=require('zlib')},function(e,t,n){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.presets=t.getPresetClassByName=void 0;var a=n(1);Object.keys(a).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=n(87),s=r(o),i=n(104),d=r(i),l=n(105),c=r(l),u=n(106),p=r(u),m=n(107),g=r(m),f=n(108),h=r(f),_=n(109),y=r(_),b=n(110),k=r(b),v=n(111),E=r(v),P=n(112),S=r(P),x=n(113),T=r(x),O=n(114),R=r(O),C=n(115),w=r(C),D=n(116),N=r(D),I=n(117),M=r(I),A=n(118),B=r(A);const L={proxy:s.default,tunnel:d.default,stats:c.default,tracker:p.default,"access-control":g.default,"ss-base":h.default,"ss-stream-cipher":y.default,"ss-aead-cipher":k.default,"v2ray-vmess":E.default,"obfs-random-padding":S.default,"obfs-http":T.default,"obfs-tls1.2-ticket":R.default,"exp-base-with-padding":N.default,"exp-base-auth-stream":M.default,"exp-compress":w.default,"aead-random-cipher":B.default},z=Object.keys(L);t.getPresetClassByName=function(e){const t=L[e];if(t===void 0)throw Error(`cannot find preset: "${e}"`);return t},t.presets=z},function(e){'use strict';e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],!e.children&&(e.children=[]),Object.defineProperty(e,'loaded',{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,'id',{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){'use strict';function r(e,t){return s(e[0]-t[0],2)+s(e[1]-t[1],2)+s(e[2]-t[2],2)}var a=Math.round,o=Math.PI,d=Math.floor,i=Math.min,s=Math.pow,c=Math.max,l=n(39),u={};for(var p in l)l.hasOwnProperty(p)&&(u[l[p]]=p);var m=e.exports={rgb:{channels:3,labels:'rgb'},hsl:{channels:3,labels:'hsl'},hsv:{channels:3,labels:'hsv'},hwb:{channels:3,labels:'hwb'},cmyk:{channels:4,labels:'cmyk'},xyz:{channels:3,labels:'xyz'},lab:{channels:3,labels:'lab'},lch:{channels:3,labels:'lch'},hex:{channels:1,labels:['hex']},keyword:{channels:1,labels:['keyword']},ansi16:{channels:1,labels:['ansi16']},ansi256:{channels:1,labels:['ansi256']},hcg:{channels:3,labels:['h','c','g']},apple:{channels:3,labels:['r16','g16','b16']},gray:{channels:1,labels:['gray']}};for(var g in m)if(m.hasOwnProperty(g)){if(!('channels'in m[g]))throw new Error('missing channels property: '+g);if(!('labels'in m[g]))throw new Error('missing channel labels property: '+g);if(m[g].labels.length!==m[g].channels)throw new Error('channel and label counts mismatch: '+g);var f=m[g].channels,h=m[g].labels;delete m[g].channels,delete m[g].labels,Object.defineProperty(m[g],'channels',{value:f}),Object.defineProperty(m[g],'labels',{value:h})}m.rgb.hsl=function(e){var t=e[0]/255,n=e[1]/255,r=e[2]/255,a=i(t,n,r),o=c(t,n,r),d=o-a,u,p,s;return o===a?u=0:t===o?u=(n-r)/d:n===o?u=2+(r-t)/d:r===o&&(u=4+(t-n)/d),u=i(60*u,360),0>u&&(u+=360),s=(a+o)/2,p=o===a?0:0.5>=s?d/(o+a):d/(2-o-a),[u,100*p,100*s]},m.rgb.hsv=function(e){var t=e[0],n=e[1],r=e[2],a=i(t,n,r),o=c(t,n,r),d=o-a,l,u,s;return u=0===o?0:1e3*(d/o)/10,o===a?l=0:t===o?l=(n-r)/d:n===o?l=2+(r-t)/d:r===o&&(l=4+(t-n)/d),l=i(60*l,360),0>l&&(l+=360),s=1e3*(o/255)/10,[l,u,s]},m.rgb.hwb=function(e){var t=e[0],n=e[1],r=e[2],a=m.rgb.hsl(e)[0],o=1/255*i(t,i(n,r));return r=1-1/255*c(t,c(n,r)),[a,100*o,100*r]},m.rgb.cmyk=function(e){var t=e[0]/255,n=e[1]/255,r=e[2]/255,a,o,s,d;return d=i(1-t,1-n,1-r),a=(1-t-d)/(1-d)||0,o=(1-n-d)/(1-d)||0,s=(1-r-d)/(1-d)||0,[100*a,100*o,100*s,100*d]},m.rgb.keyword=function(e){var t=u[e];if(t)return t;var n=Infinity,a;for(var o in l)if(l.hasOwnProperty(o)){var s=l[o],i=r(e,s);i<n&&(n=i,a=o)}return a},m.keyword.rgb=function(e){return l[e]},m.rgb.xyz=function(e){var t=e[0]/255,n=e[1]/255,r=e[2]/255;t=0.04045<t?s((t+0.055)/1.055,2.4):t/12.92,n=0.04045<n?s((n+0.055)/1.055,2.4):n/12.92,r=0.04045<r?s((r+0.055)/1.055,2.4):r/12.92;var a=0.4124*t+0.3576*n+0.1805*r,o=0.2126*t+0.7152*n+0.0722*r,i=0.0193*t+0.1192*n+0.9505*r;return[100*a,100*o,100*i]},m.rgb.lab=function(e){var t=m.rgb.xyz(e),n=t[0],r=t[1],o=t[2],i,d,a;return n/=95.047,r/=100,o/=108.883,n=0.008856<n?s(n,1/3):7.787*n+16/116,r=0.008856<r?s(r,1/3):7.787*r+16/116,o=0.008856<o?s(o,1/3):7.787*o+16/116,i=116*r-16,d=500*(n-r),a=200*(r-o),[i,d,a]},m.hsl.rgb=function(e){var t=e[0]/360,n=e[1]/100,r=e[2]/100,a,o,s,d,l;if(0==n)return l=255*r,[l,l,l];o=0.5>r?r*(1+n):r+n-r*n,a=2*r-o,d=[0,0,0];for(var c=0;3>c;c++)s=t+1/3*-(c-1),0>s&&s++,1<s&&s--,l=1>6*s?a+6*(o-a)*s:1>2*s?o:2>3*s?a+6*((o-a)*(2/3-s)):a,d[c]=255*l;return d},m.hsl.hsv=function(e){var t=e[0],n=e[1]/100,r=e[2]/100,a=n,o=c(r,0.01),s,i;return r*=2,n*=1>=r?r:2-r,a*=1>=o?o:2-o,i=(r+n)/2,s=0==r?2*a/(o+a):2*n/(r+n),[t,100*s,100*i]},m.hsv.rgb=function(e){var n=e[0]/60,r=e[1]/100,a=e[2]/100,o=d(n)%6,s=n-d(n),i=255*a*(1-r),l=255*a*(1-r*s),c=255*a*(1-r*(1-s));return a*=255,0==o?[a,c,i]:1==o?[l,a,i]:2==o?[i,a,c]:3==o?[i,l,a]:4==o?[c,i,a]:5==o?[a,i,l]:void 0},m.hsv.hsl=function(e){var t=e[0],n=e[1]/100,r=e[2]/100,a=c(r,0.01),o,s,i;return i=(2-n)*r,o=(2-n)*a,s=n*a,s/=1>=o?o:2-o,s=s||0,i/=2,[t,100*s,100*i]},m.hwb.rgb=function(e){var t=e[0]/360,a=e[1]/100,o=e[2]/100,s=a+o,l,i,c,u;1<s&&(a/=s,o/=s),l=d(6*t),i=1-o,c=6*t-l,0!=(1&l)&&(c=1-c),u=a+c*(i-a);var n,r,p;switch(l){default:case 6:case 0:n=i,r=u,p=a;break;case 1:n=u,r=i,p=a;break;case 2:n=a,r=i,p=u;break;case 3:n=a,r=u,p=i;break;case 4:n=u,r=a,p=i;break;case 5:n=i,r=a,p=u;}return[255*n,255*r,255*p]},m.cmyk.rgb=function(e){var t=e[0]/100,n=e[1]/100,a=e[2]/100,o=e[3]/100,s,r,d;return s=1-i(1,t*(1-o)+o),r=1-i(1,n*(1-o)+o),d=1-i(1,a*(1-o)+o),[255*s,255*r,255*d]},m.xyz.rgb=function(e){var t=e[0]/100,n=e[1]/100,a=e[2]/100,o,r,d;return o=3.2406*t+-1.5372*n+-0.4986*a,r=-0.9689*t+1.8758*n+0.0415*a,d=0.0557*t+-0.204*n+1.057*a,o=0.0031308<o?1.055*s(o,1/2.4)-0.055:12.92*o,r=0.0031308<r?1.055*s(r,1/2.4)-0.055:12.92*r,d=0.0031308<d?1.055*s(d,1/2.4)-0.055:12.92*d,o=i(c(0,o),1),r=i(c(0,r),1),d=i(c(0,d),1),[255*o,255*r,255*d]},m.xyz.lab=function(e){var t=e[0],n=e[1],r=e[2],o,i,a;return t/=95.047,n/=100,r/=108.883,t=0.008856<t?s(t,1/3):7.787*t+16/116,n=0.008856<n?s(n,1/3):7.787*n+16/116,r=0.008856<r?s(r,1/3):7.787*r+16/116,o=116*n-16,i=500*(t-n),a=200*(n-r),[o,i,a]},m.lab.xyz=function(e){var t=e[0],n=e[1],r=e[2],a,o,i;o=(t+16)/116,a=n/500+o,i=o-r/200;var d=s(o,3),l=s(a,3),c=s(i,3);return o=0.008856<d?d:(o-16/116)/7.787,a=0.008856<l?l:(a-16/116)/7.787,i=0.008856<c?c:(i-16/116)/7.787,a*=95.047,o*=100,i*=108.883,[a,o,i]},m.lab.lch=function(e){var t=e[0],n=e[1],r=e[2],a,s,i;return a=Math.atan2(r,n),s=360*a/2/o,0>s&&(s+=360),i=Math.sqrt(n*n+r*r),[t,i,s]},m.lch.lab=function(e){var t=e[0],n=e[1],r=e[2],s,a,i;return i=2*(r/360)*o,s=n*Math.cos(i),a=n*Math.sin(i),[t,s,a]},m.rgb.ansi16=function(e){var t=e[0],n=e[1],r=e[2],o=1 in arguments?arguments[1]:m.rgb.hsv(e)[2];if(o=a(o/50),0===o)return 30;var s=30+(a(r/255)<<2|a(n/255)<<1|a(t/255));return 2===o&&(s+=60),s},m.hsv.ansi16=function(e){return m.rgb.ansi16(m.hsv.rgb(e),e[2])},m.rgb.ansi256=function(e){var t=e[0],n=e[1],r=e[2];if(t===n&&n===r)return 8>t?16:248<t?231:a(24*((t-8)/247))+232;var o=16+36*a(5*(t/255))+6*a(5*(n/255))+a(5*(r/255));return o},m.ansi16.rgb=function(e){var t=e%10;if(0==t||7==t)return 50<e&&(t+=3.5),t=255*(t/10.5),[t,t,t];var n=0.5*(~~(50<e)+1),a=255*((1&t)*n),r=255*((1&t>>1)*n),o=255*((1&t>>2)*n);return[a,r,o]},m.ansi256.rgb=function(e){if(232<=e){var t=10*(e-232)+8;return[t,t,t]}e-=16;var n=255*(d(e/36)/5),r=255*(d((o=e%36)/6)/5),a=255*(o%6/5),o;return[n,r,a]},m.rgb.hex=function(e){var t=((255&a(e[0]))<<16)+((255&a(e[1]))<<8)+(255&a(e[2])),n=t.toString(16).toUpperCase();return'000000'.substring(n.length)+n},m.hex.rgb=function(e){var t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];var n=t[0];3===t[0].length&&(n=n.split('').map(function(e){return e+e}).join(''));var r=parseInt(n,16);return[255&r>>16,255&r>>8,255&r]},m.rgb.hcg=function(e){var t=e[0]/255,n=e[1]/255,r=e[2]/255,a=c(c(t,n),r),o=i(i(t,n),r),s=a-o,d,l;return d=1>s?o/(1-s):0,l=0>=s?0:a===t?(n-r)/s%6:a===n?2+(r-t)/s:4+(t-n)/s+4,l/=6,l%=1,[360*l,100*s,100*d]},m.hsl.hcg=function(e){var t=e[1]/100,n=e[2]/100,r=1,a=0;return r=0.5>n?2*t*n:2*t*(1-n),1>r&&(a=(n-0.5*r)/(1-r)),[e[0],100*r,100*a]},m.hsv.hcg=function(e){var t=e[1]/100,n=e[2]/100,r=t*n,a=0;return 1>r&&(a=(n-r)/(1-r)),[e[0],100*r,100*a]},m.hcg.rgb=function(e){var t=e[0]/360,n=e[1]/100,r=e[2]/100;if(0==n)return[255*r,255*r,255*r];var a=[0,0,0],o=6*(t%1),s=o%1,i=1-s,l=0;switch(d(o)){case 0:a[0]=1,a[1]=s,a[2]=0;break;case 1:a[0]=i,a[1]=1,a[2]=0;break;case 2:a[0]=0,a[1]=1,a[2]=s;break;case 3:a[0]=0,a[1]=i,a[2]=1;break;case 4:a[0]=s,a[1]=0,a[2]=1;break;default:a[0]=1,a[1]=0,a[2]=i;}return l=(1-n)*r,[255*(n*a[0]+l),255*(n*a[1]+l),255*(n*a[2]+l)]},m.hcg.hsv=function(e){var t=e[1]/100,n=e[2]/100,r=t+n*(1-t),a=0;return 0<r&&(a=t/r),[e[0],100*a,100*r]},m.hcg.hsl=function(e){var t=e[1]/100,n=e[2]/100,r=n*(1-t)+0.5*t,a=0;return 0<r&&0.5>r?a=t/(2*r):0.5<=r&&1>r&&(a=t/(2*(1-r))),[e[0],100*a,100*r]},m.hcg.hwb=function(e){var t=e[1]/100,n=e[2]/100,r=t+n*(1-t);return[e[0],100*(r-t),100*(1-r)]},m.hwb.hcg=function(e){var t=e[1]/100,n=e[2]/100,r=1-n,a=r-t,o=0;return 1>a&&(o=(r-a)/(1-a)),[e[0],100*a,100*o]},m.apple.rgb=function(e){return[255*(e[0]/65535),255*(e[1]/65535),255*(e[2]/65535)]},m.rgb.apple=function(e){return[65535*(e[0]/255),65535*(e[1]/255),65535*(e[2]/255)]},m.gray.rgb=function(e){return[255*(e[0]/100),255*(e[0]/100),255*(e[0]/100)]},m.gray.hsl=m.gray.hsv=function(e){return[0,0,e[0]]},m.gray.hwb=function(e){return[0,100,e[0]]},m.gray.cmyk=function(e){return[0,0,0,e[0]]},m.gray.lab=function(e){return[e[0],0,0]},m.gray.hex=function(e){var t=255&a(255*(e[0]/100)),n=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return'000000'.substring(n.length)+n},m.rgb.gray=function(e){var t=(e[0]+e[1]+e[2])/3;return[100*(t/255)]}},function(e){e.exports=require('cluster')},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.Balancer=void 0;var r=Object.assign||function(e){for(var t=1,n;t<arguments.length;t++)for(var r in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},a=n(4),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=n(0);const d=()=>new Date().getTime();class i{static start(e,t=12e4){if(1>e.length)throw Error('servers cannot be empty');this._servers=e.map((e,t)=>r({id:t},e)),this._pings=this._servers.map(()=>0),this._startQuery(t)}static destroy(){this._stopQuery()}static getFastest(){let e=0;const t=this._pings;for(let n=0;n<t.length;++n){const r=t[n];(0<r&&r<t[e]||0>=t[e])&&(e=n)}return this._servers[e]}static _startQuery(e){1<this._servers.length&&(null!==this._timer&&this._stopQuery(),this._timer=setInterval(()=>this._query(),e),this._query())}static _stopQuery(){clearInterval(this._timer),this._timer=null}static _query(){this._servers.map((e,t)=>{const n=`${e.host}:${e.port}`;s.logger.verbose(`[balancer] querying ${n}`);const r=d(),a=o.default.connect({host:e.host,port:e.port},()=>{const e=d()-r;this._pings[t]=e,s.logger.verbose(`[balancer] ${n} = ${e}ms`),a.end()});a.on('error',()=>{this._pings[t]=-1,s.logger.warn(`[balancer] ${n} lost connection`)})})}}t.Balancer=i,i._servers=[],i._pings=[],i._timer=null},function(e,t,n){'use strict';(function(e){var r;(function(a){function o(e){throw new RangeError(w[e])}function s(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function i(e,t){var n=e.split('@'),r='';1<n.length&&(r=n[0]+'@',e=n[1]),e=e.replace(C,'.');var a=e.split('.'),o=s(a,t).join('.');return r+o}function d(e){for(var t=[],n=0,r=e.length,a,o;n<r;)a=e.charCodeAt(n++),55296<=a&&56319>=a&&n<r?(o=e.charCodeAt(n++),56320==(64512&o)?t.push(((1023&a)<<10)+(1023&o)+65536):(t.push(a),n--)):t.push(a);return t}function l(e){return s(e,function(e){var t='';return 65535<e&&(e-=65536,t+=I(55296|1023&e>>>10),e=56320|1023&e),t+=I(e),t}).join('')}function c(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:b}function u(e,t){return e+22+75*(26>e)-((0!=t)<<5)}function p(e,t,n){var r=0;for(e=n?N(e/S):e>>1,e+=N(e/t);e>D*E>>1;r+=b)e=N(e/D);return N(r+(D+1)*e/(e+P))}function m(e){var r=[],a=e.length,s=0,i=T,n=x,d,u,m,g,f,h,_,k,P,t;for(u=e.lastIndexOf(O),0>u&&(u=0),m=0;m<u;++m)128<=e.charCodeAt(m)&&o('not-basic'),r.push(e.charCodeAt(m));for(g=0<u?u+1:0;g<a;){for(f=s,h=1,_=b;;_+=b){if(g>=a&&o('invalid-input'),k=c(e.charCodeAt(g++)),(k>=b||k>N((y-s)/h))&&o('overflow'),s+=k*h,P=_<=n?v:_>=n+E?E:_-n,k<P)break;t=b-P,h>N(y/t)&&o('overflow'),h*=t}d=r.length+1,n=p(s-f,d,0==f),N(s/d)>y-i&&o('overflow'),i+=N(s/d),s%=d,r.splice(s++,0,i)}return l(r)}function g(e){var r=[],a,n,s,i,l,c,g,m,f,h,t,_,k,P,S;for(e=d(e),_=e.length,a=T,n=0,l=x,c=0;c<_;++c)t=e[c],128>t&&r.push(I(t));for(s=i=r.length,i&&r.push(O);s<_;){for(g=y,c=0;c<_;++c)t=e[c],t>=a&&t<g&&(g=t);for(k=s+1,g-a>N((y-n)/k)&&o('overflow'),n+=(g-a)*k,a=g,c=0;c<_;++c)if(t=e[c],t<a&&++n>y&&o('overflow'),t==a){for(m=n,f=b;;f+=b){if(h=f<=l?v:f>=l+E?E:f-l,m<h)break;S=m-h,P=b-h,r.push(I(u(h+S%P,0))),m=N(S/P)}r.push(I(u(m,0))),l=p(n,k,s==i),n=0,++s}++n,++a}return r.join('')}var f='object'==typeof t&&t&&!t.nodeType&&t,h='object'==typeof e&&e&&!e.nodeType&&e,_='object'==typeof global&&global;(_.global===_||_.window===_||_.self===_)&&(a=_);var y=2147483647,b=36,v=1,E=26,P=38,S=700,x=72,T=128,O='-',k=/^xn--/,R=/[^\x20-\x7E]/,C=/[\x2E\u3002\uFF0E\uFF61]/g,w={overflow:'Overflow: input needs wider integers to process',"not-basic":'Illegal input >= 0x80 (not a basic code point)',"invalid-input":'Invalid input'},D=b-v,N=Math.floor,I=String.fromCharCode,M;M={version:'1.3.2',ucs2:{decode:d,encode:l},decode:m,encode:g,toASCII:function(e){return i(e,function(e){return R.test(e)?'xn--'+g(e):e})},toUnicode:function(e){return i(e,function(e){return k.test(e)?m(e.slice(4).toLowerCase()):e})}};r=function(){return M}.call(t,n,t,e),!(void 0!==r&&(e.exports=r))})(void 0)}).call(t,n(20)(e))},function(e,t,n){'use strict';var r,a;(function(o,s){'object'==typeof e&&e.exports?e.exports=s():(r=s,a='function'==typeof r?r.call(t,n,t,e):r,!(a!==void 0&&(e.exports=a)))})(void 0,function(e){var t=e&&e.IPv6;return{best:function(e){var t=e.toLowerCase(),n=t.split(':'),r=n.length,a=8;''===n[0]&&''===n[1]&&''===n[2]?(n.shift(),n.shift()):''===n[0]&&''===n[1]?n.shift():''===n[r-1]&&''===n[r-2]&&n.pop(),r=n.length,-1!==n[r-1].indexOf('.')&&(a=7);var o;for(o=0;o<r&&''!==n[o];o++);if(o<a)for(n.splice(o,1,'0000');n.length<a;)n.splice(o,0,'0000');for(var s=0,i;s<a;s++){i=n[s].split('');for(var d=0;3>d&&'0'===i[0]&&1<i.length;d++)i.splice(0,1);n[s]=i.join('')}var l=-1,c=0,u=0,p=-1,m=!1;for(s=0;s<a;s++)m?'0'===n[s]?u+=1:(m=!1,u>c&&(l=p,c=u)):'0'===n[s]&&(m=!0,p=s,u=1);u>c&&(l=p,c=u),1<c&&n.splice(l,c,''),r=n.length;var g='';for(''===n[0]&&(g=':'),s=0;s<r&&(g+=n[s],s!==r-1);s++)g+=':';return''===n[r-1]&&(g+=':'),g},noConflict:function(){return e.IPv6===this&&(e.IPv6=t),this}}})},function(e,t,n){'use strict';var r,a;(function(o,s){'object'==typeof e&&e.exports?e.exports=s():(r=s,a='function'==typeof r?r.call(t,n,t,e):r,!(a!==void 0&&(e.exports=a)))})(void 0,function(e){var t=e&&e.SecondLevelDomains,n={list:{ac:' com gov mil net org ',ae:' ac co gov mil name net org pro sch ',af:' com edu gov net org ',al:' com edu gov mil net org ',ao:' co ed gv it og pb ',ar:' com edu gob gov int mil net org tur ',at:' ac co gv or ',au:' asn com csiro edu gov id net org ',ba:' co com edu gov mil net org rs unbi unmo unsa untz unze ',bb:' biz co com edu gov info net org store tv ',bh:' biz cc com edu gov info net org ',bn:' com edu gov net org ',bo:' com edu gob gov int mil net org tv ',br:' adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ',bs:' com edu gov net org ',bz:' du et om ov rg ',ca:' ab bc mb nb nf nl ns nt nu on pe qc sk yk ',ck:' biz co edu gen gov info net org ',cn:' ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ',co:' com edu gov mil net nom org ',cr:' ac c co ed fi go or sa ',cy:' ac biz com ekloges gov ltd name net org parliament press pro tm ',do:' art com edu gob gov mil net org sld web ',dz:' art asso com edu gov net org pol ',ec:' com edu fin gov info med mil net org pro ',eg:' com edu eun gov mil name net org sci ',er:' com edu gov ind mil net org rochest w ',es:' com edu gob nom org ',et:' biz com edu gov info name net org ',fj:' ac biz com info mil name net org pro ',fk:' ac co gov net nom org ',fr:' asso com f gouv nom prd presse tm ',gg:' co net org ',gh:' com edu gov mil org ',gn:' ac com gov net org ',gr:' com edu gov mil net org ',gt:' com edu gob ind mil net org ',gu:' com edu gov net org ',hk:' com edu gov idv net org ',hu:' 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ',id:' ac co go mil net or sch web ',il:' ac co gov idf k12 muni net org ',in:' ac co edu ernet firm gen gov i ind mil net nic org res ',iq:' com edu gov i mil net org ',ir:' ac co dnssec gov i id net org sch ',it:' edu gov ',je:' co net org ',jo:' com edu gov mil name net org sch ',jp:' ac ad co ed go gr lg ne or ',ke:' ac co go info me mobi ne or sc ',kh:' com edu gov mil net org per ',ki:' biz com de edu gov info mob net org tel ',km:' asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ',kn:' edu gov net org ',kr:' ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ',kw:' com edu gov net org ',ky:' com edu gov net org ',kz:' com edu gov mil net org ',lb:' com edu gov net org ',lk:' assn com edu gov grp hotel int ltd net ngo org sch soc web ',lr:' com edu gov net org ',lv:' asn com conf edu gov id mil net org ',ly:' com edu gov id med net org plc sch ',ma:' ac co gov m net org press ',mc:' asso tm ',me:' ac co edu gov its net org priv ',mg:' com edu gov mil nom org prd tm ',mk:' com edu gov inf name net org pro ',ml:' com edu gov net org presse ',mn:' edu gov org ',mo:' com edu gov net org ',mt:' com edu gov net org ',mv:' aero biz com coop edu gov info int mil museum name net org pro ',mw:' ac co com coop edu gov int museum net org ',mx:' com edu gob net org ',my:' com edu gov mil name net org sch ',nf:' arts com firm info net other per rec store web ',ng:' biz com edu gov mil mobi name net org sch ',ni:' ac co com edu gob mil net nom org ',np:' com edu gov mil net org ',nr:' biz com edu gov info net org ',om:' ac biz co com edu gov med mil museum net org pro sch ',pe:' com edu gob mil net nom org sld ',ph:' com edu gov i mil net ngo org ',pk:' biz com edu fam gob gok gon gop gos gov net org web ',pl:' art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ',pr:' ac biz com edu est gov info isla name net org pro prof ',ps:' com edu gov net org plo sec ',pw:' belau co ed go ne or ',ro:' arts com firm info nom nt org rec store tm www ',rs:' ac co edu gov in org ',sb:' com edu gov net org ',sc:' com edu gov net org ',sh:' co com edu gov net nom org ',sl:' com edu gov net org ',st:' co com consulado edu embaixada gov mil net org principe saotome store ',sv:' com edu gob org red ',sz:' ac co org ',tr:' av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ',tt:' aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ',tw:' club com ebiz edu game gov idv mil net org ',mu:' ac co com gov net or org ',mz:' ac co edu gov org ',na:' co com ',nz:' ac co cri geek gen govt health iwi maori mil net org parliament school ',pa:' abo ac com edu gob ing med net nom org sld ',pt:' com edu gov int net nome org publ ',py:' com edu gov mil net org ',qa:' com edu gov mil net org ',re:' asso com nom ',ru:' ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ',rw:' ac co com edu gouv gov int mil net ',sa:' com edu gov med net org pub sch ',sd:' com edu gov info med net org tv ',se:' a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ',sg:' com edu gov idn net org per ',sn:' art com edu gouv org perso univ ',sy:' com edu gov mil net news org ',th:' ac co go in mi net or ',tj:' ac biz co com edu go gov info int mil name net nic org test web ',tn:' agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ',tz:' ac co go ne or ',ua:' biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ',ug:' ac co go ne or org sc ',uk:' ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ',us:' dni fed isa kids nsn ',uy:' com edu gub mil net org ',ve:' co com edu gob info mil net org web ',vi:' co com k12 net org ',vn:' ac biz com edu gov health info int name net org pro ',ye:' co com gov ltd me net org plc ',yu:' ac co edu gov org ',za:' ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ',zm:' ac co com edu gov net org sch ',com:'ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ',net:'gb jp se uk ',org:'ae',de:'com '},has:function(e){var t=e.lastIndexOf('.');if(0>=t||t>=e.length-1)return!1;var r=e.lastIndexOf('.',t-1);if(0>=r||r>=t-1)return!1;var a=n.list[e.slice(t+1)];return!!a&&0<=a.indexOf(' '+e.slice(r+1,t)+' ')},is:function(e){var t=e.lastIndexOf('.');if(0>=t||t>=e.length-1)return!1;var r=e.lastIndexOf('.',t-1);if(0<=r)return!1;var a=n.list[e.slice(t+1)];return!!a&&0<=a.indexOf(' '+e.slice(0,t)+' ')},get:function(e){var t=e.lastIndexOf('.');if(0>=t||t>=e.length-1)return null;var r=e.lastIndexOf('.',t-1);if(0>=r||r>=t-1)return null;var a=n.list[e.slice(t+1)];return a?0>a.indexOf(' '+e.slice(r+1,t)+' ')?null:e.slice(r+1):null},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return n})},function(e,t){'use strict';var n,r;(function(){function a(e){var t=!1;return function(){if(t)throw new Error('Callback was already called.');t=!0,e.apply(i,arguments)}}var o={},s=function(){},i,d;i='object'==typeof window&&this===window?window:'object'==typeof global&&this===global?global:this,null!=i&&(d=i.async),o.noConflict=function(){return i.async=d,o};var l=Object.prototype.toString,c=Array.isArray||function(e){return'[object Array]'===l.call(e)},u=function(e,t){for(var n=-1,r=e.length;++n<r;)t(e[n],n,e)},p=function(e,t){for(var n=-1,r=e.length,a=Array(r);++n<r;)a[n]=t(e[n],n,e);return a},m=function(e,t,n){return u(e,function(e,r,o){n=t(n,e,r,o)}),n},g=function(e,t){u(f(e),function(n){t(e[n],n)})},f=Object.keys||function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},h=function(e,t){t=t||0;var n=-1,r=e.length;t&&(r-=t,r=0>r?0:r);for(var a=Array(r);++n<r;)a[n]=e[n+t];return a},_;'function'==typeof setImmediate&&(_=setImmediate),'undefined'!=typeof process&&process.nextTick?(o.nextTick=process.nextTick,o.setImmediate=_?function(e){_(e)}:o.nextTick):_?(o.nextTick=function(e){_(e)},o.setImmediate=o.nextTick):(o.nextTick=function(e){setTimeout(e,0)},o.setImmediate=o.nextTick),o.each=function(e,t,n){function r(t){t?(n(t),n=s):(o+=1,o>=e.length&&n())}if(n=n||s,!e.length)return n();var o=0;u(e,function(e){t(e,a(r))})},o.forEach=o.each,o.eachSeries=function(e,t,n){if(n=n||s,!e.length)return n();var r=0;(function a(){t(e[r],function(t){t?(n(t),n=s):(r+=1,r>=e.length?n():a())})})()},o.forEachSeries=o.eachSeries,o.eachLimit=function(e,t,n,r){var a=y(t);a.apply(null,[e,n,r])},o.forEachLimit=o.eachLimit;var y=function(e){return function(t,n,r){if(r=r||s,!t.length||0>=e)return r();var a=0,o=0,i=0;(function d(){if(a>=t.length)return r();for(;i<e&&o<t.length;)o+=1,i+=1,n(t[o-1],function(e){e?(r(e),r=s):(a+=1,i-=1,a>=t.length?r():d())})})()}};o.forEachOf=o.eachOf=function(e,t,n){n=n||function(){};var r=e.length||f(e).length,a=0;return r?void g(e,function(o,s){t(e[s],s,function(e){e?(n(e),n=function(){}):(a+=1,a===r&&n(null))})}):n()},o.forEachOfSeries=o.eachOfSeries=function(e,t,n){n=n||function(){};var r=f(e),a=r.length;if(!a)return n();var s=0;(function i(){var d=!0,l=r[s];t(e[l],l,function(e){e?(n(e),n=function(){}):(s+=1,s>=a?n(null):d?o.nextTick(i):i())}),d=!1})()},o.forEachOfLimit=o.eachOfLimit=function(e,t,n,r){b(t)(e,n,r)};var b=function(e){return function(t,n,r){r=r||function(){};var a=f(t),o=a.length;if(!o||0>=e)return r();var s=0,i=0,d=0;(function l(){if(s>=o)return r();for(;d<e&&i<o;){i+=1,d+=1;var c=a[i-1];n(t[c],c,function(e){e?(r(e),r=function(){}):(s+=1,d-=1,s>=o?r():l())})}})()}},k=function(e){return function(){var t=h(arguments);return e.apply(null,[o.each].concat(t))}},v=function(e,t){return function(){var n=h(arguments);return t.apply(null,[y(e)].concat(n))}},E=function(e){return function(){var t=h(arguments);return e.apply(null,[o.eachSeries].concat(t))}},P=function(e,t,n,r){if(t=p(t,function(e,t){return{index:t,value:e}}),!r)e(t,function(e,t){n(e.value,function(e){t(e)})});else{var a=[];e(t,function(e,t){n(e.value,function(n,r){a[e.index]=r,t(n)})},function(e){r(e,a)})}};o.map=k(P),o.mapSeries=E(P),o.mapLimit=function(e,t,n,r){return S(t)(e,n,r)};var S=function(e){return v(e,P)};o.reduce=function(e,t,n,r){o.eachSeries(e,function(e,r){n(t,e,function(e,n){t=n,r(e)})},function(e){r(e,t)})},o.inject=o.reduce,o.foldl=o.reduce,o.reduceRight=function(e,t,n,r){var a=p(e,function(e){return e}).reverse();o.reduce(a,t,n,r)},o.foldr=o.reduceRight;var x=function(e,t,n,r){var a=[];t=p(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n&&a.push(e),t()})},function(){r(p(a.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};o.filter=k(x),o.filterSeries=E(x),o.select=o.filter,o.selectSeries=o.filterSeries;var T=function(e,t,n,r){var a=[];t=p(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n||a.push(e),t()})},function(){r(p(a.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};o.reject=k(T),o.rejectSeries=E(T);var O=function(e,t,n,r){e(t,function(e,t){n(e,function(n){n?(r(e),r=s):t()})},function(){r()})};o.detect=k(O),o.detectSeries=E(O),o.some=function(e,t,n){o.each(e,function(e,r){t(e,function(e){e&&(n(!0),n=s),r()})},function(){n(!1)})},o.any=o.some,o.every=function(e,t,n){o.each(e,function(e,r){t(e,function(e){e||(n(!1),n=s),r()})},function(){n(!0)})},o.all=o.every,o.sortBy=function(e,t,n){o.map(e,function(e,n){t(e,function(t,r){t?n(t):n(null,{value:e,criteria:r})})},function(e,t){if(e)return n(e);n(null,p(t.sort(function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0}),function(e){return e.value}))})},o.auto=function(e,t){t=t||s;var n=f(e),r=n.length;if(!r)return t();var i={},a=[],d=function(e){a.unshift(e)},l=function(e){for(var t=0;t<a.length;t+=1)if(a[t]===e)return void a.splice(t,1)},p=function(){r--,u(a.slice(0),function(e){e()})};d(function(){if(!r){var e=t;t=s,e(null,i)}}),u(n,function(n){for(var r=c(e[n])?e[n]:[e[n]],a=function(e){var r=h(arguments,1);if(1>=r.length&&(r=r[0]),e){var a={};u(f(i),function(e){a[e]=i[e]}),a[n]=r,t(e,a),t=s}else i[n]=r,o.setImmediate(p)},g=r.slice(0,Math.abs(r.length-1))||[],_=g.length,y;_--;){if(!(y=e[g[_]]))throw new Error('Has inexistant dependency');if(c(y)&&!!~y.indexOf(n))throw new Error('Has cyclic dependencies')}var b=function(){return m(g,function(e,t){return e&&i.hasOwnProperty(t)},!0)&&!i.hasOwnProperty(n)};if(b())r[r.length-1](a,i);else{var k=function e(){b()&&(l(e),r[r.length-1](a,i))};d(k)}})},o.retry=function(e,t,n){var r=5,a=[];'function'==typeof e&&(n=t,t=e,e=r),e=parseInt(e,10)||r;var s=function(r,s){for(var i=function(e,t){return function(n){e(function(e,r){n(!e||t,{err:e,result:r})},s)}};e;)a.push(i(t,!(e-=1)));o.series(a,function(e,t){t=t[t.length-1],(r||n)(t.err,t.result)})};return n?s():s},o.waterfall=function(e,t){if(t=t||s,!c(e)){var n=new Error('First argument to waterfall must be an array of functions');return t(n)}if(!e.length)return t();(function e(n){return function(r){if(r)t.apply(null,arguments),t=s;else{var a=h(arguments,1),i=n.next();i?a.push(e(i)):a.push(t),o.setImmediate(function(){n.apply(null,a)})}}})(o.iterator(e))()};var R=function(e,t,n){if(n=n||s,c(t))e.map(t,function(e,t){e&&e(function(e){var n=h(arguments,1);1>=n.length&&(n=n[0]),t.call(null,e,n)})},n);else{var r={};e.each(f(t),function(e,n){t[e](function(t){var a=h(arguments,1);1>=a.length&&(a=a[0]),r[e]=a,n(t)})},function(e){n(e,r)})}};o.parallel=function(e,t){R({map:o.map,each:o.each},e,t)},o.parallelLimit=function(e,t,n){R({map:S(t),each:y(t)},e,n)},o.series=function(e,t){if(t=t||s,c(e))o.mapSeries(e,function(e,t){e&&e(function(e){var n=h(arguments,1);1>=n.length&&(n=n[0]),t.call(null,e,n)})},t);else{var n={};o.eachSeries(f(e),function(t,r){e[t](function(e){var a=h(arguments,1);1>=a.length&&(a=a[0]),n[t]=a,r(e)})},function(e){t(e,n)})}},o.iterator=function(e){return function t(n){var r=function t(){return e.length&&e[n].apply(null,arguments),t.next()};return r.next=function(){return n<e.length-1?t(n+1):null},r}(0)},o.apply=function(e){var t=h(arguments,1);return function(){return e.apply(null,t.concat(h(arguments)))}};var C=function(e,t,n,a){var o=[];e(t,function(e,t){n(e,function(e,n){o=o.concat(n||[]),t(e)})},function(e){a(e,o)})};o.concat=k(C),o.concatSeries=E(C),o.whilst=function(e,t,n){e()?t(function(r){return r?n(r):void o.whilst(e,t,n)}):n()},o.doWhilst=function(e,t,n){e(function(r){if(r)return n(r);var a=h(arguments,1);t.apply(null,a)?o.doWhilst(e,t,n):n()})},o.until=function(e,t,n){e()?n():t(function(r){return r?n(r):void o.until(e,t,n)})},o.doUntil=function(e,t,n){e(function(r){if(r)return n(r);var a=h(arguments,1);t.apply(null,a)?n():o.doUntil(e,t,n)})},o.queue=function(e,t){function n(e,t,n,r){return e.started||(e.started=!0),c(t)||(t=[t]),0===t.length?o.setImmediate(function(){e.drain&&e.drain()}):void u(t,function(t){var a={data:t,callback:'function'==typeof r?r:null};n?e.tasks.unshift(a):e.tasks.push(a),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),o.setImmediate(e.process)})}if(t===void 0)t=1;else if(0===t)throw new Error('Concurrency must not be zero');var r=0,s={tasks:[],concurrency:t,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(e,t){n(s,e,!1,t)},kill:function(){s.drain=null,s.tasks=[]},unshift:function(e,t){n(s,e,!0,t)},process:function(){if(!s.paused&&r<s.concurrency&&s.tasks.length){var t=s.tasks.shift();s.empty&&0===s.tasks.length&&s.empty(),r+=1;var n=function(){r-=1,t.callback&&t.callback.apply(t,arguments),s.drain&&0===s.tasks.length+r&&s.drain(),s.process()},o=a(n);e(t.data,o)}},length:function(){return s.tasks.length},running:function(){return r},idle:function(){return 0===s.tasks.length+r},pause:function(){!0===s.paused||(s.paused=!0)},resume:function(){if(!1!==s.paused){s.paused=!1;for(var e=Math.min(s.concurrency,s.tasks.length),t=1;t<=e;t++)o.setImmediate(s.process)}}};return s},o.priorityQueue=function(e,t){function n(e,t){return e.priority-t.priority}function r(e,t,n){for(var r=-1,a=e.length-1,o;r<a;)o=r+(a-r+1>>>1),0<=n(t,e[o])?r=o:a=o-1;return r}function a(e,t,a,s){return e.started||(e.started=!0),c(t)||(t=[t]),0===t.length?o.setImmediate(function(){e.drain&&e.drain()}):void u(t,function(t){var i={data:t,priority:a,callback:'function'==typeof s?s:null};e.tasks.splice(r(e.tasks,i,n)+1,0,i),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),o.setImmediate(e.process)})}var s=o.queue(e,t);return s.push=function(e,t,n){a(s,e,t,n)},delete s.unshift,s},o.cargo=function(e,t){var n=!1,r=[],a={tasks:r,payload:t,saturated:null,empty:null,drain:null,drained:!0,push:function(e,n){c(e)||(e=[e]),u(e,function(e){r.push({data:e,callback:'function'==typeof n?n:null}),a.drained=!1,a.saturated&&r.length===t&&a.saturated()}),o.setImmediate(a.process)},process:function o(){if(!n){if(0===r.length)return a.drain&&!a.drained&&a.drain(),void(a.drained=!0);var s='number'==typeof t?r.splice(0,t):r.splice(0,r.length),i=p(s,function(e){return e.data});a.empty&&a.empty(),n=!0,e(i,function(){n=!1;var e=arguments;u(s,function(t){t.callback&&t.callback.apply(null,e)}),o()})}},length:function(){return r.length},running:function(){return n}};return a};var w=function(e){return function(t){var n=h(arguments,1);t.apply(null,n.concat([function(t){var n=h(arguments,1);'undefined'!=typeof console&&(t?console.error&&console.error(t):console[e]&&u(n,function(t){console[e](t)}))}]))}};o.log=w('log'),o.dir=w('dir'),o.memoize=function(e,t){var n={},r={};t=t||function(e){return e};var a=function(){var a=h(arguments),s=a.pop(),d=t.apply(null,a);d in n?o.nextTick(function(){s.apply(null,n[d])}):d in r?r[d].push(s):(r[d]=[s],e.apply(null,a.concat([function(){n[d]=h(arguments);var e=r[d];delete r[d];for(var t=0,a=e.length;t<a;t++)e[t].apply(null,arguments)}])))};return a.memo=n,a.unmemoized=e,a},o.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},o.times=function(e,t,n){for(var r=[],a=0;a<e;a++)r.push(a);return o.map(r,t,n)},o.timesSeries=function(e,t,n){for(var r=[],a=0;a<e;a++)r.push(a);return o.mapSeries(r,t,n)},o.seq=function(){var e=arguments;return function(){var t=this,n=h(arguments),r=n.pop();o.reduce(e,n,function(e,n,r){n.apply(t,e.concat([function(){var e=arguments[0],t=h(arguments,1);r(e,t)}]))},function(e,n){r.apply(t,[e].concat(n))})}},o.compose=function(){return o.seq.apply(null,Array.prototype.reverse.call(arguments))};var D=function(e,t){var n=function(){var n=this,r=h(arguments),a=r.pop();return e(t,function(e,t){e.apply(n,r.concat([t]))},a)};if(2<arguments.length){var r=h(arguments,2);return n.apply(this,r)}return n};o.applyEach=k(D),o.applyEachSeries=E(D),o.forever=function(e,t){function n(r){if(r){if(t)return t(r);throw r}e(n)}n()},'undefined'!=typeof e&&e.exports?e.exports=o:(n=[],r=function(){return o}.apply(t,n),!(r!==void 0&&(e.exports=r)))})()},function(e,t,n){'use strict';var r=n(7),a=n(83),o=t;o.getAllInfo=function(e){return{date:new Date().toString(),process:o.getProcessInfo(),os:o.getOsInfo(),trace:o.getTrace(e),stack:e.stack&&e.stack.split('\n')}},o.getProcessInfo=function(){return{pid:process.pid,uid:process.getuid?process.getuid():null,gid:process.getgid?process.getgid():null,cwd:process.cwd(),execPath:process.execPath,version:process.version,argv:process.argv,memoryUsage:process.memoryUsage()}},o.getOsInfo=function(){return{loadavg:r.loadavg(),uptime:r.uptime()}},o.getTrace=function(e){var t=e?a.parse(e):a.get();return t.map(function(e){return{column:e.getColumnNumber(),file:e.getFileName(),function:e.getFunctionName(),line:e.getLineNumber(),method:e.getMethodName(),native:e.isNative()}})}},function(e,t,n){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.Config=t.DEFAULT_LOG_LEVEL=void 0;var a=function(){function e(e,t){var n=[],r=!0,a=!1,o;try{for(var s=e[Symbol.iterator](),i;!(r=(i=s.next()).done)&&(n.push(i.value),!(t&&n.length===t));r=!0);}catch(e){a=!0,o=e}finally{try{!r&&s['return']&&s['return']()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),o=n(30),s=r(o),i=n(3),d=r(i),l=n(9),c=r(l),u=n(7),p=r(u),m=n(4),g=r(m),f=n(12),h=r(f),_=n(86),y=r(_),b=n(19),k=n(0),v=n(32);const E=t.DEFAULT_LOG_LEVEL='info';t.Config=class{static init(e){this._validate(e),global.__LOCAL_HOST__=e.host,global.__LOCAL_PORT__=e.port,e.servers===void 0?(global.__IS_CLIENT__=!1,global.__IS_SERVER__=!0,this.initServer(e)):(global.__SERVERS__=e.servers.filter((e)=>e.enabled),global.__IS_CLIENT__=!0,global.__IS_SERVER__=!1),global.__TIMEOUT__=e.timeout===void 0?600000:1e3*e.timeout,global.__REDIRECT__=''===e.redirect?null:e.redirect,global.__WORKERS__=e.workers===void 0?0:e.workers,global.__DNS_EXPIRE__=e.dns_expire===void 0?v.DNS_DEFAULT_EXPIRE:1e3*e.dns_expire,global.__ALL_CONFIG__=e,e.dns!==void 0&&0<e.dns.length&&(global.__DNS__=e.dns,s.default.setServers(e.dns));const t=c.default.resolve(process.cwd(),e.log_path||'.');let r=!1;d.default.existsSync(t)?r=d.default.statSync(t).isFile():''!==c.default.extname(t)&&(r=!0),global.__LOG_PATH__=r?t:c.default.join(t,`bs-${__IS_CLIENT__?'client':'server'}.log`),global.__LOG_LEVEL__=e.log_level===void 0?E:e.log_level,k.logger.configure({level:__LOG_LEVEL__,transports:[new h.default.transports.Console({colorize:!0,prettyPrint:!0}),new(n(119))({filename:__LOG_PATH__,level:__LOG_LEVEL__})]})}static initServer(e){global.__TRANSPORT__=e.transport===void 0?'tcp':e.transport,global.__IS_TLS__='tls'===__TRANSPORT__,__IS_TLS__&&(global.__TLS_CERT__=d.default.readFileSync(c.default.resolve(process.cwd(),e.tls_cert)),__IS_SERVER__&&(global.__TLS_KEY__=d.default.readFileSync(c.default.resolve(process.cwd(),e.tls_key)))),global.__SERVER_HOST__=e.host,global.__SERVER_PORT__=e.port,global.__KEY__=e.key,global.__PRESETS__=e.presets}static _validate(e){if(!(0,y.default)(e))throw Error('invalid configuration file');if('string'!=typeof e.host||''===e.host)throw Error('\'host\' must be provided and is not empty');if(!(0,k.isValidPort)(e.port))throw Error('\'port\' is invalid');if(void 0!==e.servers){if(!Array.isArray(e.servers))throw Error('\'servers\' must be provided as an array');const t=e.servers.filter((e)=>!0===e.enabled);if(1>t.length)throw Error('\'servers\' must have at least one enabled item');t.forEach(this._validateServer)}else this._validateServer(e);if(void 0!==e.timeout){if('number'!=typeof e.timeout)throw Error('\'timeout\' must be a number');if(1>e.timeout)throw Error('\'timeout\' must be greater than 0');60>e.timeout&&console.warn(`==> [config] 'timeout' is too short, is ${e.timeout}s expected?`)}if(void 0!==e.redirect&&''!==e.redirect){if('string'!=typeof e.redirect)throw Error('\'redirect\' must be a string');const n=e.redirect.split(':');if(2!==n.length)throw Error('\'redirect\' must be "<host or ip>:<port>"');var t=a(n,2);const r=t[0],o=t[1];if(!(0,k.isValidHostname)(r)&&!g.default.isIP(r))throw Error('\'redirect\' host is invalid');if(!(0,k.isValidPort)(+o))throw Error('\'redirect\' port is invalid')}if(void 0!==e.log_path&&'string'!=typeof e.log_path)throw Error('\'log_path\' must be a string');if(void 0!==e.log_level){const t=['error','warn','info','verbose','debug','silly'];if(!t.includes(e.log_level))throw Error(`'log_level' must be one of [${t.toString()}]`)}if(void 0!==e.workers){if('number'!=typeof e.workers)throw Error('\'workers\' must be a number');if(0>e.workers)throw Error('\'workers\' must be an integer');e.workers>p.default.cpus().length&&console.warn(`==> [config] 'workers' is greater than the number of cpus, is ${e.workers} workers expected?`)}if(void 0!==e.dns){if(!Array.isArray(e.dns))throw Error('\'dns\' must be an array');var n=!0,r=!1,o;try{for(var s=e.dns[Symbol.iterator](),i;!(n=(i=s.next()).done);n=!0){const e=i.value;if(!g.default.isIP(e))throw Error(`"${e}" is not an ip address`)}}catch(e){r=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}}if(void 0!==e.dns_expire){if('number'!=typeof e.dns_expire)throw Error('\'dns_expire\' must be a number');if(0>e.dns_expire)throw Error('\'dns_expire\' must be greater or equal to 0');86400<e.dns_expire&&console.warn(`==> [config] 'dns_expire' is too long, is ${e.dns_expire}s expected?`)}}static _validateServer(e){if(e.transport!==void 0){if(!['tcp','tls'].includes(e.transport))throw Error('\'server.transport\' must be "tcp" or "tls"');if('tls'===e.transport){if('string'!=typeof e.tls_cert)throw Error('\'server.tls_key\' must be a string');if(''===e.tls_cert)throw Error('\'server.tls_cert\' cannot be empty')}}if(!(0,k.isValidHostname)(e.host))throw Error('\'server.host\' is invalid');if(!(0,k.isValidPort)(e.port))throw Error('\'server.port\' is invalid');if('string'!=typeof e.key||''===e.key)throw Error('\'server.key\' must be a non-empty string');if(!Array.isArray(e.presets))throw Error('\'server.presets\' must be an array');if(1>e.presets.length)throw Error('\'server.presets\' must contain at least one preset');var t=!0,n=!1,r;try{for(var a=e.presets[Symbol.iterator](),o;!(t=(o=a.next()).done);t=!0){const e=o.value,t=e.name,n=e.params;if('string'!=typeof t)throw Error('\'server.presets[].name\' must be a string');if(''===t)throw Error('\'server.presets[].name\' cannot be empty');if(void 0!==n&&!(0,y.default)(n))throw Error('\'server.presets[].params\' must be an plain object');const r=(0,b.getPresetClassByName)(e.name);r.checkParams(e.params||{})}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}}}},function(e){e.exports=require('dns')},function(e){e.exports=require('readline')},function(e,t,n){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(a,o){try{var s=t[a](o),i=s.value}catch(e){return void n(e)}return s.done?void e(i):Promise.resolve(i).then(function(e){r('next',e)},function(e){r('throw',e)})}return r('next')})}}Object.defineProperty(t,'__esModule',{value:!0}),t.DNSCache=t.DNS_DEFAULT_EXPIRE=void 0;var o=function(){function e(e,t){var n=[],r=!0,a=!1,o;try{for(var s=e[Symbol.iterator](),i;!(r=(i=s.next()).done)&&(n.push(i.value),!(t&&n.length===t));r=!0);}catch(e){a=!0,o=e}finally{try{!r&&s['return']&&s['return']()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),s=n(30),i=r(s),d=n(4),l=r(d);const c=t.DNS_DEFAULT_EXPIRE=3.6e6;class u{constructor({expire:e}={}){this._expire=c,e!==void 0&&(this._expire=e)}_now(){return new Date().getTime()}_lookup(e){return a(function*(){return new Promise(function(t,n){i.default.lookup(e,function(e,r){e?n(e):t(r)})})})()}_put(e,t){if(0<this._expire){const n=this._now()+this._expire;u._pool[e]=[t,n]}}get(e){var t=this;return a(function*(){if(l.default.isIP(e))return e;let n=null;if(u._pool[e]===void 0)n=yield t._lookup(e),t._put(e,n);else{var r=o(u._pool[e],2);const a=r[0],s=r[1];t._now()>=s&&delete u._pool[e],n=a}return n})()}clear(){u._pool={}}}t.DNSCache=u,u._pool={}},function(e){e.exports=require('tls')},function(e,t,n){'use strict';function r(e){return-1!==f.indexOf(e)}function a(e){const t=f.indexOf(e);return-1===t?void 0:f[t+1]}const o=n(3),s=n(9),i=n(7),d=n(35),l=n(44),c=n(45),u=n(46),p='2.6.1',m=`
  ${d.bold.underline(`blinksocks v${p}`)}

  Usage: blinksocks [command] [options] ...

  Commands:

    init    generate configuration pair

  Options:

    -h, --help          output usage information
    -v, --version       output blinksocks version
    -c, --config        file json file with configuration
    -m, --minimal       generate minimal json files
    --list-presets      list all built-in presets

  Examples:

${[['Generate json file with minimal options','$ blinksocks init --minimal'],['Start blinksocks client','$ blinksocks --config blinksocks.client.json'],['Start blinksocks server','$ blinksocks --config blinksocks.server.json'],['List all built-in presets','$ blinksocks --list-presets']].map(([e,t])=>`  ${d.gray('-')} ${e}${i.EOL}    ${d.blue(t)}`).join(i.EOL)}

  About & Help: ${d.underline('https://github.com/blinksocks/blinksocks')}
`,g=process.argv,f=g.slice(2);(function(){if(3>g.length)return console.log(m);const e=f[0],t=s.resolve(process.cwd(),e);if(o.existsSync(t)&&'.json'===s.extname(t))return c(t,u);if('init'===f[0]){const e=r('-m')||r('--minimal');return l({isMinimal:e})}if(r('-h')||r('--help'))return console.log(m);if(r('-v')||r('--version'))return console.log(p);if(r('-c')||r('--config')){let e=a('-c')||a('--config');return void 0===e?console.log(d.red('config file must be provided')):(e=s.resolve(process.cwd(),e),o.existsSync(e)?c(e,u):console.log(d.red('config file is not found')))}return r('--list-presets')?console.log(u.presets.join(i.EOL)):void console.log(m)})()},function(e,t,n){'use strict';function r(e,t){t=t||{};const n=c?c.level:0;e.level=t.level===void 0?n:t.level,e.enabled='enabled'in t?t.enabled:0<e.level}function a(e){if(!this||!(this instanceof a)||this.template){const t={};return r(t,e),t.template=function(){const e=[].slice.call(arguments);return i.apply(null,[t.template].concat(e))},Object.setPrototypeOf(t,a.prototype),Object.setPrototypeOf(t.template,t),t.template.constructor=a,t.template}r(this,e)}function o(e,t){const n=function e(){return s.apply(e,arguments)};n._styles=e;const r=this;return Object.defineProperty(n,'level',{enumerable:!0,get(){return r.level},set(e){r.level=e}}),Object.defineProperty(n,'enabled',{enumerable:!0,get(){return r.enabled},set(e){r.enabled=e}}),n.hasGrey=this.hasGrey||'gray'===t||'grey'===t,n.__proto__=D,n}function s(){const e=arguments,t=e.length;let n=arguments[0]+'';if(0===t)return'';if(1<t)for(let r=1;r<t;r++)n+=' '+e[r];if(!this.enabled||0>=this.level||!n)return n;const r=l.dim.open;p&&this.hasGrey&&(l.dim.open='');var a=!0,o=!1,s;try{for(var i=this._styles.slice().reverse()[Symbol.iterator](),d;!(a=(d=i.next()).done);a=!0){const e=d.value;n=e.open+n.replace(e.closeRe,e.open)+e.close,n=n.replace(/\r?\n/g,`${e.close}$&${e.open}`)}}catch(e){o=!0,s=e}finally{try{!a&&i.return&&i.return()}finally{if(o)throw s}}return l.dim.open=r,n}function i(e,t){if(!Array.isArray(t))return[].slice.call(arguments,1).join(' ');const n=[].slice.call(arguments,2),r=[t.raw[0]];for(let a=1;a<t.length;a++)r.push((n[a-1]+'').replace(/[{}\\]/g,'\\$&')),r.push(t.raw[a]+'');return u(e,r.join(''))}const d=n(36),l=n(37),c=n(41),u=n(43),p='win32'===process.platform&&!(process.env.TERM||'').toLowerCase().startsWith('xterm'),m=['ansi','ansi','ansi256','ansi16m'],g=new Set(['gray']),f=Object.create(null);p&&(l.blue.open='\x1B[94m');var h=!0,_=!1,y;try{for(var b=Object.keys(l)[Symbol.iterator](),k;!(h=(k=b.next()).done);h=!0){const e=k.value;l[e].closeRe=new RegExp(d(l[e].close),'g'),f[e]={get(){const t=l[e];return o.call(this,this._styles?this._styles.concat(t):[t],e)}}}}catch(e){_=!0,y=e}finally{try{!h&&b.return&&b.return()}finally{if(_)throw y}}l.color.closeRe=new RegExp(d(l.color.close),'g');var v=!0,E=!1,P;try{for(var S=Object.keys(l.color.ansi)[Symbol.iterator](),x;!(v=(x=S.next()).done);v=!0){const e=x.value;g.has(e)||(f[e]={get(){const t=this.level;return function(){const n=l.color[m[t]][e].apply(null,arguments),r={open:n,close:l.color.close,closeRe:l.color.closeRe};return o.call(this,this._styles?this._styles.concat(r):[r],e)}}})}}catch(e){E=!0,P=e}finally{try{!v&&S.return&&S.return()}finally{if(E)throw P}}l.bgColor.closeRe=new RegExp(d(l.bgColor.close),'g');var T=!0,O=!1,R;try{for(var C=Object.keys(l.bgColor.ansi)[Symbol.iterator](),w;!(T=(w=C.next()).done);T=!0){const e=w.value;if(g.has(e))continue;const t='bg'+e[0].toUpperCase()+e.slice(1);f[t]={get(){const t=this.level;return function(){const n=l.bgColor[m[t]][e].apply(null,arguments),r={open:n,close:l.bgColor.close,closeRe:l.bgColor.closeRe};return o.call(this,this._styles?this._styles.concat(r):[r],e)}}}}}catch(e){O=!0,R=e}finally{try{!T&&C.return&&C.return()}finally{if(O)throw R}}const D=Object.defineProperties(()=>{},f);Object.defineProperties(a.prototype,f),e.exports=a(),e.exports.supportsColor=c},function(e){'use strict';var t=/[|\\{}()[\]^$+*?.]/g;e.exports=function(e){if('string'!=typeof e)throw new TypeError('Expected a string');return e.replace(t,'\\$&')}},function(e,t,n){'use strict';(function(e){const t=n(38),r=(e,n)=>function(){const r=e.apply(t,arguments);return`\u001B[${r+n}m`},a=(e,n)=>function(){const r=e.apply(t,arguments);return`\u001B[${38+n};5;${r}m`},o=(e,n)=>function(){const r=e.apply(t,arguments);return`\u001B[${38+n};2;${r[0]};${r[1]};${r[2]}m`};Object.defineProperty(e,'exports',{enumerable:!0,get:function(){const e=new Map,n={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};n.color.grey=n.color.gray;var s=!0,i=!1,d;try{for(var l=Object.keys(n)[Symbol.iterator](),c;!(s=(c=l.next()).done);s=!0){const t=c.value,r=n[t];var u=!0,p=!1,m=void 0;try{for(var g=Object.keys(r)[Symbol.iterator](),f;!(u=(f=g.next()).done);u=!0){const t=f.value,a=r[t];n[t]={open:`\u001B[${a[0]}m`,close:`\u001B[${a[1]}m`},r[t]=n[t],e.set(a[0],a[1])}}catch(e){p=!0,m=e}finally{try{!u&&g.return&&g.return()}finally{if(p)throw m}}Object.defineProperty(n,t,{value:r,enumerable:!1}),Object.defineProperty(n,'codes',{value:e,enumerable:!1})}}catch(e){i=!0,d=e}finally{try{!s&&l.return&&l.return()}finally{if(i)throw d}}const h=(e,t,n)=>[e,t,n];n.color.close='\x1B[39m',n.bgColor.close='\x1B[49m',n.color.ansi={},n.color.ansi256={},n.color.ansi16m={rgb:o(h,0)},n.bgColor.ansi={},n.bgColor.ansi256={},n.bgColor.ansi16m={rgb:o(h,10)};var _=!0,y=!1,b;try{for(var k=Object.keys(t)[Symbol.iterator](),v;!(_=(v=k.next()).done);_=!0){const e=v.value;if('object'!=typeof t[e])continue;const s=t[e];'ansi16'in s&&(n.color.ansi[e]=r(s.ansi16,0),n.bgColor.ansi[e]=r(s.ansi16,10)),'ansi256'in s&&(n.color.ansi256[e]=a(s.ansi256,0),n.bgColor.ansi256[e]=a(s.ansi256,10)),'rgb'in s&&(n.color.ansi16m[e]=o(s.rgb,0),n.bgColor.ansi16m[e]=o(s.rgb,10))}}catch(e){y=!0,b=e}finally{try{!_&&k.return&&k.return()}finally{if(y)throw b}}return n}})}).call(t,n(20)(e))},function(e,t,n){'use strict';function r(e){var t=function(t){return void 0===t||null===t?t:(1<arguments.length&&(t=Array.prototype.slice.call(arguments)),e(t))};return'conversion'in e&&(t.conversion=e.conversion),t}function a(e){var t=function(t){if(void 0===t||null===t)return t;1<arguments.length&&(t=Array.prototype.slice.call(arguments));var n=e(t);if('object'==typeof n)for(var r=n.length,a=0;a<r;a++)n[a]=Math.round(n[a]);return n};return'conversion'in e&&(t.conversion=e.conversion),t}var o=n(21),s=n(40),i={},d=Object.keys(o);d.forEach(function(e){i[e]={},Object.defineProperty(i[e],'channels',{value:o[e].channels}),Object.defineProperty(i[e],'labels',{value:o[e].labels});var t=s(e),n=Object.keys(t);n.forEach(function(n){var o=t[n];i[e][n]=a(o),i[e][n].raw=r(o)})}),e.exports=i},function(e){'use strict';e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},function(e,t,n){'use strict';function r(){for(var e={},t=l.length,n=0;n<t;n++)e[l[n]]={distance:-1,parent:null};return e}function a(e){var t=r(),n=[e];for(t[e].distance=0;n.length;)for(var a=n.pop(),o=Object.keys(d[a]),s=o.length,l=0;l<s;l++){var i=o[l],c=t[i];-1===c.distance&&(c.distance=t[a].distance+1,c.parent=a,n.unshift(i))}return t}function o(e,t){return function(n){return t(e(n))}}function s(e,t){for(var n=[t[e].parent,e],r=d[t[e].parent][e],a=t[e].parent;t[a].parent;)n.unshift(t[a].parent),r=o(d[t[a].parent][a],r),a=t[a].parent;return r.conversion=n,r}var d=n(21),l=Object.keys(d);e.exports=function(e){for(var t=a(e),n={},r=Object.keys(t),o=r.length,d=0;d<o;d++){var i=r[d],l=t[i];null!==l.parent&&(n[i]=s(i,t))}return n}},function(e,t,n){'use strict';const r=n(7),a=n(42),o=process.env;let s=(()=>{if(a('no-color')||a('no-colors')||a('color=false'))return 0;if(a('color=16m')||a('color=full')||a('color=truecolor'))return 3;if(a('color=256'))return 2;if(a('color')||a('colors')||a('color=true')||a('color=always'))return 1;if(process.stdout&&!process.stdout.isTTY)return 0;if('win32'===process.platform){const e=r.release().split('.');return 8<=+process.versions.node.split('.')[0]&&10<=+e[0]&&10586<=+e[2]?2:1}if('CI'in o)return['TRAVIS','CIRCLECI','APPVEYOR','GITLAB_CI'].some((e)=>e in o)||'codeship'===o.CI_NAME?1:0;if('TEAMCITY_VERSION'in o)return /^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(o.TEAMCITY_VERSION)?1:0;if('TERM_PROGRAM'in o){const e=parseInt((o.TERM_PROGRAM_VERSION||'').split('.')[0],10);switch(o.TERM_PROGRAM){case'iTerm.app':return 3<=e?3:2;case'Hyper':return 3;case'Apple_Terminal':return 2;}}return /-256(color)?$/i.test(o.TERM)?2:/^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(o.TERM)?1:'COLORTERM'in o?1:'dumb'===o.TERM?0:0})();'FORCE_COLOR'in o&&(s=0===parseInt(o.FORCE_COLOR,10)?0:s||1),e.exports=process&&((e)=>0!==e&&{level:e,hasBasic:!0,has256:2<=e,has16m:3<=e})(s)},function(e){'use strict';e.exports=function(e,t){t=t||process.argv;var n=t.indexOf('--'),r=/^-{1,2}/.test(e)?'':'--',a=t.indexOf(r+e);return-1!==a&&(!(-1!==n)||a<n)}},function(e){'use strict';function t(e){return'u'===e[0]&&5===e.length||'x'===e[0]&&3===e.length?String.fromCharCode(parseInt(e.slice(1),16)):l[e]||e}function n(e,n){const r=[],a=n.trim().split(/\s*,\s*/g);let o;var s=!0,l=!1,c;try{for(var u=a[Symbol.iterator](),p;!(s=(p=u.next()).done);s=!0){const n=p.value;if(!isNaN(n))r.push(+n);else if(o=n.match(i))r.push(o[2].replace(d,(e,n,r)=>n?t(n):r));else throw new Error(`Invalid Chalk template style argument: ${n} (in style '${e}')`)}}catch(e){l=!0,c=e}finally{try{!s&&u.return&&u.return()}finally{if(l)throw c}}return r}function r(e){s.lastIndex=0;const t=[];for(let r;null!==(r=s.exec(e));){const e=r[1];if(r[2]){const a=n(e,r[2]);t.push([e].concat(a))}else t.push([e])}return t}function a(e,t){const n={};var r=!0,a=!1,o;try{for(var s=t[Symbol.iterator](),i;!(r=(i=s.next()).done);r=!0){const e=i.value;var d=!0,l=!1,c=void 0;try{for(var u=e.styles[Symbol.iterator](),p;!(d=(p=u.next()).done);d=!0){const t=p.value;n[t[0]]=e.inverse?null:t.slice(1)}}catch(e){l=!0,c=e}finally{try{!d&&u.return&&u.return()}finally{if(l)throw c}}}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}let m=e;var g=!0,f=!1,h;try{for(var _=Object.keys(n)[Symbol.iterator](),y;!(g=(y=_.next()).done);g=!0){const e=y.value;if(Array.isArray(n[e])){if(!(e in m))throw new Error(`Unknown Chalk style: ${e}`);m=0<n[e].length?m[e].apply(m,n[e]):m[e]}}}catch(e){f=!0,h=e}finally{try{!g&&_.return&&_.return()}finally{if(f)throw h}}return m}const o=/(?:\\(u[a-f0-9]{4}|x[a-f0-9]{2}|.))|(?:\{(~)?(\w+(?:\([^)]*\))?(?:\.\w+(?:\([^)]*\))?)*)(?:[ \t]|(?=\r?\n)))|(\})|((?:.|[\r\n\f])+?)/gi,s=/(?:^|\.)(\w+)(?:\(([^)]*)\))?/g,i=/^(['"])((?:\\.|(?!\1)[^\\])*)\1$/,d=/\\(u[0-9a-f]{4}|x[0-9a-f]{2}|.)|([^\\])/gi,l={n:'\n',r:'\r',t:'\t',b:'\b',f:'\f',v:'\x0B',0:'\0',"\\":'\\',e:'\x1B',a:'\x07'};e.exports=(e,n)=>{const s=[],i=[];let d=[];if(n.replace(o,(n,o,l,c,u,p)=>{if(o)d.push(t(o));else if(c){const t=d.join('');d=[],i.push(0===s.length?t:a(e,s)(t)),s.push({inverse:l,styles:r(c)})}else if(u){if(0===s.length)throw new Error('Found extraneous } in Chalk template literal');i.push(a(e,s)(d.join(''))),d=[],s.pop()}else d.push(p)}),i.push(d.join('')),0<s.length){const e=`Chalk template literal is missing ${s.length} closing bracket${1===s.length?'':'s'} (\`}\`)`;throw new Error(e)}return i.join('')}},function(e,t,n){'use strict';function r(e,t){const n=e.length,r=i.randomBytes(t).toJSON().data;return r.map((t)=>e[t%n]).join('')}function a(e,t){return e=o(e),t=o(t),Math.floor(i.randomBytes(1)[0]/255*(t-e+1))+e}var o=Math.ceil;const s=n(3),i=n(2);e.exports=function({isMinimal:e}){const t=r('abcdefghjkmnpqrstuvwxyz23456789!@#$%^&*()_+<>?:|{}-=[];,./ABCDEFGHJKLMNPQRSTUVWXYZ',16),n=a(1024,65535),o=a(200,1e3),i={host:'127.0.0.1',port:1080,servers:[{enabled:!0,transport:'tcp',host:'127.0.0.1',port:n,key:t,presets:[{name:'ss-base'},{name:'ss-aead-cipher',params:{method:'aes-256-gcm'}}],tls_cert:'cert.pem'}],dns:[],dns_expire:3600,timeout:o,workers:0,log_path:'bs-client.log',log_level:'info'};e&&(delete i.servers[0].transport,delete i.servers[0].tls_cert,delete i.dns,delete i.dns_expire,delete i.timeout,delete i.workers,delete i.log_path,delete i.log_level);const d={host:'0.0.0.0',port:n,key:t,transport:'tcp',presets:[{name:'ss-base'},{name:'ss-aead-cipher',params:{method:'aes-256-gcm'}}],tls_key:'key.pem',tls_cert:'cert.pem',dns:[],dns_expire:3600,timeout:o,redirect:'',workers:0,log_path:'bs-server.log',log_level:'info'};e&&(delete d.transport,delete d.tls_key,delete d.tls_cert,delete d.dns,delete d.dns_expire,delete d.timeout,delete d.redirect,delete d.workers,delete d.log_path,delete d.log_level),s.writeFileSync('blinksocks.client.json',JSON.stringify(i,null,'  ')),s.writeFileSync('blinksocks.server.json',JSON.stringify(d,null,'  ')),console.log('> Generate Done.'),console.log('> For configuring please read: https://github.com/blinksocks/blinksocks/tree/master/docs/config/README.md')}},function(e,t,n){'use strict';function r(e){let t;try{const n=o.readFileSync(e);t=JSON.parse(n)}catch(t){throw Error(`fail to load/parse your '${e}': ${t.message}`)}return t}const a=n(22),o=n(3);e.exports=function(e,{Hub:t,Config:n}){try{if(n.init(r(e)),a.isMaster&&0<__WORKERS__){for(let e=0;e<__WORKERS__;++e)a.fork();console.log(`==> [bootstrap] started ${__WORKERS__} workers`)}else{const e=new t;e.on('close',()=>process.exit(0)),e.run(),process.on('SIGINT',()=>e.terminate())}}catch(e){console.error(e),process.exit(-1)}}},function(e,t,n){'use strict';e.exports=n(47)},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(48);Object.keys(r).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var a=n(19);Object.keys(a).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(23);Object.keys(r).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var a=n(29);Object.keys(a).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=n(121);Object.keys(o).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,t,n){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t=2,n=y){if(1>t)throw Error('len must be greater than 0');const r=e>parseInt(`0x${'ff'.repeat(t)}`);if(r)throw Error(`Number ${e} is too big to put into a ${t} byte(s) size buffer`);const a=Buffer.alloc(t);return n===y?a.writeUIntBE(e,0,t):a.writeUIntLE(e,0,t),a}function o(e,t){return e=s(e),t=s(t),Math.floor(c.default.randomBytes(1)[0]/255*(t-e))+e}var s=Math.ceil;Object.defineProperty(t,'__esModule',{value:!0}),t.BYTE_ORDER_LE=t.BYTE_ORDER_BE=t.ATYP_V6=t.ATYP_DOMAIN=t.ATYP_V4=void 0,t.numberToBuffer=a,t.parseURI=function(e){let t=e,n=null;t.startsWith('http://')&&(t=t.substr(7),n=80),t.startsWith('https://')&&(t=t.substr(8),n=443);const r={};g.default.parseHost(t,r);const o=r.hostname,s=r.port,i=d.default.isIP(o)?d.default.isIPv4(o)?f:_:h;return{type:i,host:d.default.isIP(o)?p.default.toBuffer(o):Buffer.from(o),port:a(s||n||80)}},t.getRandomInt=o,t.getRandomChunks=function(e,t,n){const r=e.length,a=[];let s=0;for(;s<r-1;){const r=o(t,n);a.push(e.slice(s,s+r)),s+=r}return s<r&&a.push(e.slice(s)),a},t.getChunks=function(e,t){const n=e.length,r=[];let a=0;for(;a<n-1;)r.push(e.slice(a,a+t)),a+=t;return a<n&&r.push(e.slice(a)),r};var i=n(4),d=r(i),l=n(2),c=r(l),u=n(10),p=r(u),m=n(51),g=r(m);const f=t.ATYP_V4=1,h=t.ATYP_DOMAIN=3,_=t.ATYP_V6=4,y=t.BYTE_ORDER_BE=0,b=t.BYTE_ORDER_LE=1},function(e){e.exports=require('buffer')},function(e,t,n){'use strict';var r=Math.max,a,o,s;(function(r,i){'object'==typeof e&&e.exports?e.exports=i(n(24),n(25),n(26)):(o=[n(24),n(25),n(26)],a=i,s='function'==typeof a?a.apply(t,o):a,!(s!==void 0&&(e.exports=s)))})(void 0,function(e,t,n,a){function o(e,t){var n=1<=arguments.length,r=2<=arguments.length;if(!(this instanceof o))return n?r?new o(e,t):new o(e):new o;if(void 0===e){if(n)throw new TypeError('undefined is not a valid argument for URI');e='undefined'==typeof location?'':location.href+''}if(null===e&&n)throw new TypeError('null is not a valid argument for URI');return this.href(e),void 0===t?this:this.absoluteTo(t)}function s(e){return /^[0-9]+$/.test(e)}function i(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,'\\$1')}function d(e){return void 0===e?'Undefined':(Object.prototype.toString.call(e)+'').slice(8,-1)}function c(e){return'Array'===d(e)}function l(e,t){var n={},r,a;if('RegExp'===d(t))n=null;else if(c(t))for(r=0,a=t.length;r<a;r++)n[t[r]]=!0;else n[t]=!0;for(r=0,a=e.length;r<a;r++){var o=n&&void 0!==n[e[r]]||!n&&t.test(e[r]);o&&(e.splice(r,1),a--,r--)}return e}function u(e,t){var n,r;if(c(t)){for(n=0,r=t.length;n<r;n++)if(!u(e,t[n]))return!1;return!0}var a=d(t);for(n=0,r=e.length;n<r;n++)if('RegExp'===a){if('string'==typeof e[n]&&e[n].match(t))return!0;}else if(e[n]===t)return!0;return!1}function m(e,t){if(!c(e)||!c(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function g(e){var t=/^\/+|\/+$/g;return e.replace(t,'')}function f(e){return escape(e)}function h(e){return encodeURIComponent(e).replace(/[!'()*]/g,f).replace(/\*/g,'%2A')}function _(e){return function(t,n){return void 0===t?this._parts[e]||'':(this._parts[e]=t||null,this.build(!n),this)}}function y(e,t){return function(n,r){return void 0===n?this._parts[e]||'':(null!==n&&(n+='',n.charAt(0)===t&&(n=n.substring(1))),this._parts[e]=n,this.build(!r),this)}}var b=a&&a.URI;o.version='1.18.12';var k=o.prototype,p=Object.prototype.hasOwnProperty;o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?]))/ig,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.defaultPorts={http:'80',https:'443',ftp:'21',gopher:'70',ws:'80',wss:'443'},o.hostProtocols=['http','https'],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:'href',blockquote:'cite',link:'href',base:'href',script:'src',form:'action',img:'src',area:'href',iframe:'src',embed:'src',source:'src',track:'src',input:'src',audio:'src',video:'src'},o.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();return'input'===t&&'image'!==e.type?void 0:o.domAttributes[t]}},o.encode=h,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=h,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":'$',"%26":'&',"%2B":'+',"%2C":',',"%3B":';',"%3D":'=',"%3A":':',"%40":'@'}},decode:{expression:/[\/\?#]/g,map:{"/":'%2F',"?":'%3F',"#":'%23'}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":':',"%2F":'/',"%3F":'?',"%23":'#',"%5B":'[',"%5D":']',"%40":'@',"%21":'!',"%24":'$',"%26":'&',"%27":'\'',"%28":'(',"%29":')',"%2A":'*',"%2B":'+',"%2C":',',"%3B":';',"%3D":'='}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":'!',"%24":'$',"%27":'\'',"%28":'(',"%29":')',"%2A":'*',"%2B":'+',"%2C":',',"%3B":';',"%3D":'=',"%40":'@'}},decode:{expression:/[\/\?#:]/g,map:{"/":'%2F',"?":'%3F',"#":'%23',":":'%3A'}}}},o.encodeQuery=function(e,t){var n=o.encode(e+'');return void 0===t&&(t=o.escapeQuerySpace),t?n.replace(/%20/g,'+'):n},o.decodeQuery=function(e,t){e+='',void 0===t&&(t=o.escapeQuerySpace);try{return o.decode(t?e.replace(/\+/g,'%20'):e)}catch(t){return e}};var v={encode:'encode',decode:'decode'},E=function(e,t){return function(n){try{return o[t](n+'').replace(o.characters[e][t].expression,function(n){return o.characters[e][t].map[n]})}catch(t){return n}}},P;for(P in v)o[P+'PathSegment']=E('pathname',v[P]),o[P+'UrnPathSegment']=E('urnpath',v[P]);var S=function(e,t,n){return function(r){var a=n?function(e){return o[t](o[n](e))}:o[t];for(var s=(r+'').split(e),d=0,i=s.length;d<i;d++)s[d]=a(s[d]);return s.join(e)}};o.decodePath=S('/','decodePathSegment'),o.decodeUrnPath=S(':','decodeUrnPathSegment'),o.recodePath=S('/','encodePathSegment','decode'),o.recodeUrnPath=S(':','encodeUrnPathSegment','decode'),o.encodeReserved=E('reserved','encode'),o.parse=function(e,t){var n;return t||(t={}),n=e.indexOf('#'),-1<n&&(t.fragment=e.substring(n+1)||null,e=e.substring(0,n)),n=e.indexOf('?'),-1<n&&(t.query=e.substring(n+1)||null,e=e.substring(0,n)),'//'===e.substring(0,2)?(t.protocol=null,e=e.substring(2),e=o.parseAuthority(e,t)):(n=e.indexOf(':'),-1<n&&(t.protocol=e.substring(0,n)||null,t.protocol&&!t.protocol.match(o.protocol_expression)?t.protocol=void 0:'//'===e.substring(n+1,n+3)?(e=e.substring(n+3),e=o.parseAuthority(e,t)):(e=e.substring(n+1),t.urn=!0))),t.path=e,t},o.parseHost=function(e,n){e=e.replace(/\\/g,'/');var r=e.indexOf('/'),a,s;if(-1===r&&(r=e.length),'['===e.charAt(0))a=e.indexOf(']'),n.hostname=e.substring(1,a)||null,n.port=e.substring(a+2,r)||null,'/'===n.port&&(n.port=null);else{var t=e.indexOf(':'),i=e.indexOf('/'),d=e.indexOf(':',t+1);-1!==d&&(-1===i||d<i)?(n.hostname=e.substring(0,r)||null,n.port=null):(s=e.substring(0,r).split(':'),n.hostname=s[0]||null,n.port=s[1]||null)}return n.hostname&&'/'!==e.substring(r).charAt(0)&&(r++,e='/'+e),o.ensureValidHostname(n.hostname,n.protocol),n.port&&o.ensureValidPort(n.port),e.substring(r)||'/'},o.parseAuthority=function(e,t){return e=o.parseUserinfo(e,t),o.parseHost(e,t)},o.parseUserinfo=function(e,n){var r=e.indexOf('/'),a=e.lastIndexOf('@',-1<r?r:e.length-1),s;return-1<a&&(-1===r||a<r)?(s=e.substring(0,a).split(':'),n.username=s[0]?o.decode(s[0]):null,s.shift(),n.password=s[0]?o.decode(s.join(':')):null,e=e.substring(a+1)):(n.username=null,n.password=null),e},o.parseQuery=function(e,t){if(!e)return{};if(e=e.replace(/&+/g,'&').replace(/^\?*&*|&+$/g,''),!e)return{};for(var n={},r=e.split('&'),a=r.length,s=0,i,d,l;s<a;s++)i=r[s].split('='),d=o.decodeQuery(i.shift(),t),l=i.length?o.decodeQuery(i.join('='),t):null,p.call(n,d)?(('string'==typeof n[d]||null===n[d])&&(n[d]=[n[d]]),n[d].push(l)):n[d]=l;return n},o.build=function(e){var n='';return e.protocol&&(n+=e.protocol+':'),!e.urn&&(n||e.hostname)&&(n+='//'),n+=o.buildAuthority(e)||'','string'==typeof e.path&&('/'!==e.path.charAt(0)&&'string'==typeof e.hostname&&(n+='/'),n+=e.path),'string'==typeof e.query&&e.query&&(n+='?'+e.query),'string'==typeof e.fragment&&e.fragment&&(n+='#'+e.fragment),n},o.buildHost=function(e){var n='';return e.hostname?(n+=o.ip6_expression.test(e.hostname)?'['+e.hostname+']':e.hostname,e.port&&(n+=':'+e.port),n):''},o.buildAuthority=function(e){return o.buildUserinfo(e)+o.buildHost(e)},o.buildUserinfo=function(e){var n='';return e.username&&(n+=o.encode(e.username)),e.password&&(n+=':'+o.encode(e.password)),n&&(n+='@'),n},o.buildQuery=function(e,n,r){var a='',t,s,d,i;for(s in e)if(p.call(e,s)&&s)if(c(e[s]))for(t={},d=0,i=e[s].length;d<i;d++)void 0!==e[s][d]&&void 0===t[e[s][d]+'']&&(a+='&'+o.buildQueryParameter(s,e[s][d],r),!0!==n&&(t[e[s][d]+'']=!0));else void 0!==e[s]&&(a+='&'+o.buildQueryParameter(s,e[s],r));return a.substring(1)},o.buildQueryParameter=function(e,t,n){return o.encodeQuery(e,n)+(null===t?'':'='+o.encodeQuery(t,n))},o.addQuery=function(e,t,n){if('object'==typeof t)for(var r in t)p.call(t,r)&&o.addQuery(e,r,t[r]);else if('string'==typeof t){if(void 0===e[t])return void(e[t]=n);'string'==typeof e[t]&&(e[t]=[e[t]]),c(n)||(n=[n]),e[t]=(e[t]||[]).concat(n)}else throw new TypeError('URI.addQuery() accepts an object, string as the name parameter')},o.removeQuery=function(e,t,n){var r,a,s;if(c(t))for(r=0,a=t.length;r<a;r++)e[t[r]]=void 0;else if('RegExp'===d(t))for(s in e)t.test(s)&&(e[s]=void 0);else if('object'==typeof t)for(s in t)p.call(t,s)&&o.removeQuery(e,s,t[s]);else if('string'==typeof t)void 0===n?e[t]=void 0:'RegExp'===d(n)?!c(e[t])&&n.test(e[t])?e[t]=void 0:e[t]=l(e[t],n):e[t]!==n+''||c(n)&&1!==n.length?c(e[t])&&(e[t]=l(e[t],n)):e[t]=void 0;else throw new TypeError('URI.removeQuery() accepts an object, string, RegExp as the first parameter')},o.hasQuery=function(e,t,n,r){switch(d(t)){case'String':break;case'RegExp':for(var a in e)if(p.call(e,a)&&t.test(a)&&(void 0===n||o.hasQuery(e,a,n)))return!0;return!1;case'Object':for(var s in t)if(p.call(t,s)&&!o.hasQuery(e,s,t[s]))return!1;return!0;default:throw new TypeError('URI.hasQuery() accepts a string, regular expression or object as the name parameter');}switch(d(n)){case'Undefined':return t in e;case'Boolean':var i=c(e[t])?!!e[t].length:!!e[t];return n===i;case'Function':return!!n(e[t],t,e);case'Array':if(!c(e[t]))return!1;var l=r?u:m;return l(e[t],n);case'RegExp':return c(e[t])?!!r&&u(e[t],n):!!(e[t]&&e[t].match(n));case'Number':n+='';case'String':return c(e[t])?!!r&&u(e[t],n):e[t]===n;default:throw new TypeError('URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter');}},o.joinPaths=function(){for(var e=[],t=[],n=0,r=0,a;r<arguments.length;r++){a=new o(arguments[r]),e.push(a);for(var i=a.segment(),d=0;d<i.length;d++)'string'==typeof i[d]&&t.push(i[d]),i[d]&&n++}if(!t.length||!n)return new o('');var s=new o('').segment(t);return(''===e[0].path()||'/'===e[0].path().slice(0,1))&&s.path('/'+s.path()),s.normalize()},o.commonPath=function(e,t){var n=Math.min(e.length,t.length),r;for(r=0;r<n;r++)if(e.charAt(r)!==t.charAt(r)){r--;break}return 1>r?e.charAt(0)===t.charAt(0)&&'/'===e.charAt(0)?'/':'':(('/'!==e.charAt(r)||'/'!==t.charAt(r))&&(r=e.substring(0,r).lastIndexOf('/')),e.substring(0,r+1))},o.withinString=function(e,t,n){n||(n={});var a=n.start||o.findUri.start,s=n.end||o.findUri.end,i=n.trim||o.findUri.trim,d=n.parens||o.findUri.parens,l=/[a-z0-9-]=["']?$/i;for(a.lastIndex=0;;){var c=a.exec(e);if(!c)break;var u=c.index;if(n.ignoreHtml){var p=e.slice(r(u-3,0),u);if(p&&l.test(p))continue}for(var m=u+e.slice(u).search(s),g=e.slice(u,m),f=-1,h,_;h=d.exec(g),!!h;)_=h.index+h[0].length,f=r(f,_);if((g=-1<f?g.slice(0,f)+g.slice(f).replace(i,''):g.replace(i,''),!(g.length<=c[0].length))&&!(n.ignore&&n.ignore.test(g))){m=u+g.length;var y=t(g,u,m,e);if(void 0===y){a.lastIndex=m;continue}y+='',e=e.slice(0,u)+y+e.slice(m),a.lastIndex=u+y.length}}return a.lastIndex=0,e},o.ensureValidHostname=function(t,n){var r=!1;if(!!n&&(r=u(o.hostProtocols,n)),r&&!!!t)throw new TypeError('Hostname cannot be empty, if protocol is '+n);else if(t&&t.match(o.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(t).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(e){if(e){var t=+e;if(!(s(t)&&0<t&&65536>t))throw new TypeError('Port "'+e+'" is not a valid port')}},o.noConflict=function(e){if(e){var t={URI:this.noConflict()};return a.URITemplate&&'function'==typeof a.URITemplate.noConflict&&(t.URITemplate=a.URITemplate.noConflict()),a.IPv6&&'function'==typeof a.IPv6.noConflict&&(t.IPv6=a.IPv6.noConflict()),a.SecondLevelDomains&&'function'==typeof a.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=a.SecondLevelDomains.noConflict()),t}return a.URI===this&&(a.URI=b),this},k.build=function(e){return!0===e?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},k.clone=function(){return new o(this)},k.valueOf=k.toString=function(){return this.build(!1)._string},k.protocol=_('protocol'),k.username=_('username'),k.password=_('password'),k.hostname=_('hostname'),k.port=_('port'),k.query=y('query','?'),k.fragment=y('fragment','#'),k.search=function(e,n){var r=this.query(e,n);return'string'==typeof r&&r.length?'?'+r:r},k.hash=function(e,n){var r=this.fragment(e,n);return'string'==typeof r&&r.length?'#'+r:r},k.pathname=function(e,t){if(void 0===e||!0===e){var n=this._parts.path||(this._parts.hostname?'/':'');return e?(this._parts.urn?o.decodeUrnPath:o.decodePath)(n):n}return this._parts.path=this._parts.urn?e?o.recodeUrnPath(e):'':e?o.recodePath(e):'/',this.build(!t),this},k.path=k.pathname,k.href=function(e,t){if(void 0===e)return this.toString();this._string='',this._parts=o._parts();var n=e instanceof o,r='object'==typeof e&&(e.hostname||e.path||e.pathname);if(e.nodeName){var a=o.getDomAttribute(e);e=e[a]||'',r=!1}if(!n&&r&&void 0!==e.pathname&&(e=e.toString()),'string'==typeof e||e instanceof String)this._parts=o.parse(e+'',this._parts);else if(n||r){var s=n?e._parts:e;for(var i in s)p.call(this._parts,i)&&(this._parts[i]=s[i])}else throw new TypeError('invalid input');return this.build(!t),this},k.is=function(e){var t=!1,r=!1,a=!1,s=!1,i=!1,d=!1,l=!1,c=!this._parts.urn;switch(this._parts.hostname&&(c=!1,r=o.ip4_expression.test(this._parts.hostname),a=o.ip6_expression.test(this._parts.hostname),t=r||a,s=!t,i=s&&n&&n.has(this._parts.hostname),d=s&&o.idn_expression.test(this._parts.hostname),l=s&&o.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case'relative':return c;case'absolute':return!c;case'domain':case'name':return s;case'sld':return i;case'ip':return t;case'ip4':case'ipv4':case'inet4':return r;case'ip6':case'ipv6':case'inet6':return a;case'idn':return d;case'url':return!this._parts.urn;case'urn':return!!this._parts.urn;case'punycode':return l;}return null};var x=k.protocol,T=k.port,O=k.hostname;k.protocol=function(e,t){if(void 0!==e&&e&&(e=e.replace(/:(\/\/)?$/,''),!e.match(o.protocol_expression)))throw new TypeError('Protocol "'+e+'" contains characters other than [A-Z0-9.+-] or doesn\'t start with [A-Z]');return x.call(this,e,t)},k.scheme=k.protocol,k.port=function(e,t){return this._parts.urn?void 0===e?'':this:(void 0!==e&&(0===e&&(e=null),e&&(e+='',':'===e.charAt(0)&&(e=e.substring(1)),o.ensureValidPort(e))),T.call(this,e,t))},k.hostname=function(e,t){if(this._parts.urn)return void 0===e?'':this;if(void 0!==e){var n={},r=o.parseHost(e,n);if('/'!==r)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=n.hostname,o.ensureValidHostname(e,this._parts.protocol)}return O.call(this,e,t)},k.origin=function(e,t){if(this._parts.urn)return void 0===e?'':this;if(void 0===e){var n=this.protocol(),r=this.authority();return r?(n?n+'://':'')+this.authority():''}var a=o(e);return this.protocol(a.protocol()).authority(a.authority()).build(!t),this},k.host=function(e,t){if(this._parts.urn)return void 0===e?'':this;if(void 0===e)return this._parts.hostname?o.buildHost(this._parts):'';var n=o.parseHost(e,this._parts);if('/'!==n)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},k.authority=function(e,t){if(this._parts.urn)return void 0===e?'':this;if(void 0===e)return this._parts.hostname?o.buildAuthority(this._parts):'';var n=o.parseAuthority(e,this._parts);if('/'!==n)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},k.userinfo=function(e,n){if(this._parts.urn)return void 0===e?'':this;if(void 0===e){var r=o.buildUserinfo(this._parts);return r?r.substring(0,r.length-1):r}return'@'!==e[e.length-1]&&(e+='@'),o.parseUserinfo(e,this._parts),this.build(!n),this},k.resource=function(e,t){var n;return void 0===e?this.path()+this.search()+this.hash():(n=o.parse(e),this._parts.path=n.path,this._parts.query=n.query,this._parts.fragment=n.fragment,this.build(!t),this)},k.subdomain=function(t,n){if(this._parts.urn)return void 0===t?'':this;if(void 0===t){if(!this._parts.hostname||this.is('IP'))return'';var r=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,r)||''}var a=this._parts.hostname.length-this.domain().length,e=this._parts.hostname.substring(0,a),s=new RegExp('^'+i(e));if(t&&'.'!==t.charAt(t.length-1)&&(t+='.'),-1!==t.indexOf(':'))throw new TypeError('Domains cannot contain colons');return t&&o.ensureValidHostname(t,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(s,t),this.build(!n),this},k.domain=function(e,n){if(this._parts.urn)return void 0===e?'':this;if('boolean'==typeof e&&(n=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is('IP'))return'';var r=this._parts.hostname.match(/\./g);if(r&&2>r.length)return this._parts.hostname;var t=this._parts.hostname.length-this.tld(n).length-1;return t=this._parts.hostname.lastIndexOf('.',t-1)+1,this._parts.hostname.substring(t)||''}if(!e)throw new TypeError('cannot set domain empty');if(-1!==e.indexOf(':'))throw new TypeError('Domains cannot contain colons');if(o.ensureValidHostname(e,this._parts.protocol),!this._parts.hostname||this.is('IP'))this._parts.hostname=e;else{var a=new RegExp(i(this.domain())+'$');this._parts.hostname=this._parts.hostname.replace(a,e)}return this.build(!n),this},k.tld=function(e,t){if(this._parts.urn)return void 0===e?'':this;if('boolean'==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is('IP'))return'';var r=this._parts.hostname.lastIndexOf('.'),a=this._parts.hostname.substring(r+1);return!0!==t&&n&&n.list[a.toLowerCase()]?n.get(this._parts.hostname)||a:a}var o;if(!e)throw new TypeError('cannot set TLD empty');else if(e.match(/[^a-zA-Z0-9-]/)){if(n&&n.is(e))o=new RegExp(i(this.tld())+'$'),this._parts.hostname=this._parts.hostname.replace(o,e);else throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');}else if(!this._parts.hostname||this.is('IP'))throw new ReferenceError('cannot set TLD on non-domain host');else o=new RegExp(i(this.tld())+'$'),this._parts.hostname=this._parts.hostname.replace(o,e);return this.build(!t),this},k.directory=function(t,n){if(this._parts.urn)return void 0===t?'':this;if(void 0===t||!0===t){if(!this._parts.path&&!this._parts.hostname)return'';if('/'===this._parts.path)return'/';var r=this._parts.path.length-this.filename().length-1,a=this._parts.path.substring(0,r)||(this._parts.hostname?'/':'');return t?o.decodePath(a):a}var s=this._parts.path.length-this.filename().length,e=this._parts.path.substring(0,s),d=new RegExp('^'+i(e));return this.is('relative')||(!t&&(t='/'),'/'!==t.charAt(0)&&(t='/'+t)),t&&'/'!==t.charAt(t.length-1)&&(t+='/'),t=o.recodePath(t),this._parts.path=this._parts.path.replace(d,t),this.build(!n),this},k.filename=function(e,t){if(this._parts.urn)return void 0===e?'':this;if('string'!=typeof e){if(!this._parts.path||'/'===this._parts.path)return'';var n=this._parts.path.lastIndexOf('/'),r=this._parts.path.substring(n+1);return e?o.decodePathSegment(r):r}var a=!1;'/'===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(a=!0);var s=new RegExp(i(this.filename())+'$');return e=o.recodePath(e),this._parts.path=this._parts.path.replace(s,e),a?this.normalizePath(t):this.build(!t),this},k.suffix=function(e,t){if(this._parts.urn)return void 0===e?'':this;if(void 0===e||!0===e){if(!this._parts.path||'/'===this._parts.path)return'';var n=this.filename(),r=n.lastIndexOf('.'),a,s;return-1===r?'':(a=n.substring(r+1),s=/^[a-z0-9%]+$/i.test(a)?a:'',e?o.decodePathSegment(s):s)}'.'===e.charAt(0)&&(e=e.substring(1));var d=this.suffix(),l;if(!d){if(!e)return this;this._parts.path+='.'+o.recodePath(e)}else l=e?new RegExp(i(d)+'$'):new RegExp(i('.'+d)+'$');return l&&(e=o.recodePath(e),this._parts.path=this._parts.path.replace(l,e)),this.build(!t),this},k.segment=function(e,t,n){var a=this._parts.urn?':':'/',o=this.path(),s='/'===o.substring(0,1),d=o.split(a);if(void 0!==e&&'number'!=typeof e&&(n=t,t=e,e=void 0),void 0!==e&&'number'!=typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');if(s&&d.shift(),0>e&&(e=r(d.length+e,0)),void 0===t)return void 0===e?d:d[e];if(null!==e&&void 0!==d[e])t?d[e]=g(t):d.splice(e,1);else if(c(t)){d=[];for(var u=0,i=t.length;u<i;u++)(t[u].length||d.length&&d[d.length-1].length)&&(d.length&&!d[d.length-1].length&&d.pop(),d.push(g(t[u])))}else(t||'string'==typeof t)&&(t=g(t),''===d[d.length-1]?d[d.length-1]=t:d.push(t));return s&&d.unshift(''),this.path(d.join(a),n)},k.segmentCoded=function(e,t,n){var r,a,s;if('number'!=typeof e&&(n=t,t=e,e=void 0),void 0===t){if(r=this.segment(e,t,n),!c(r))r=void 0===r?void 0:o.decode(r);else for(a=0,s=r.length;a<s;a++)r[a]=o.decode(r[a]);return r}if(!c(t))t='string'==typeof t||t instanceof String?o.encode(t):t;else for(a=0,s=t.length;a<s;a++)t[a]=o.encode(t[a]);return this.segment(e,t,n)};var R=k.query;return k.query=function(e,t){if(!0===e)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if('function'==typeof e){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),r=e.call(this,n);return this._parts.query=o.buildQuery(r||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&'string'!=typeof e?(this._parts.query=o.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):R.call(this,e,t)},k.setQuery=function(e,t,n){var r=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if('string'==typeof e||e instanceof String)r[e]=void 0===t?null:t;else if('object'==typeof e)for(var a in e)p.call(e,a)&&(r[a]=e[a]);else throw new TypeError('URI.addQuery() accepts an object, string as the name parameter');return this._parts.query=o.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),'string'!=typeof e&&(n=t),this.build(!n),this},k.addQuery=function(e,t,n){var r=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(r,e,void 0===t?null:t),this._parts.query=o.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),'string'!=typeof e&&(n=t),this.build(!n),this},k.removeQuery=function(e,t,n){var r=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(r,e,t),this._parts.query=o.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),'string'!=typeof e&&(n=t),this.build(!n),this},k.hasQuery=function(e,t,n){var r=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(r,e,t,n)},k.setSearch=k.setQuery,k.addSearch=k.addQuery,k.removeSearch=k.removeQuery,k.hasSearch=k.hasQuery,k.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},k.normalizeProtocol=function(e){return'string'==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},k.normalizeHostname=function(n){return this._parts.hostname&&(this.is('IDN')&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is('IPv6')&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!n)),this},k.normalizePort=function(e){return'string'==typeof this._parts.protocol&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},k.normalizePath=function(e){var t=this._parts.path;if(!t)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!e),this;if('/'===this._parts.path)return this;t=o.recodePath(t);var n='',r,a,s;for('/'!==t.charAt(0)&&(r=!0,t='/'+t),('/..'===t.slice(-3)||'/.'===t.slice(-2))&&(t+='/'),t=t.replace(/(\/(\.\/)+)|(\/\.$)/g,'/').replace(/\/{2,}/g,'/'),r&&(n=t.substring(1).match(/^(\.\.\/)+/)||'',n&&(n=n[0]));a=t.search(/\/\.\.(\/|$)/),-1!==a;){if(0===a){t=t.substring(3);continue}s=t.substring(0,a).lastIndexOf('/'),-1===s&&(s=a),t=t.substring(0,s)+t.substring(a+3)}return r&&this.is('relative')&&(t=n+t.substring(1)),this._parts.path=t,this.build(!e),this},k.normalizePathname=k.normalizePath,k.normalizeQuery=function(e){return'string'==typeof this._parts.query&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},k.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},k.normalizeSearch=k.normalizeQuery,k.normalizeHash=k.normalizeFragment,k.iso8859=function(){var t=o.encode,e=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=t,o.decode=e}return this},k.unicode=function(){var t=o.encode,e=o.decode;o.encode=h,o.decode=unescape;try{this.normalize()}finally{o.encode=t,o.decode=e}return this},k.readable=function(){var n=this.clone();n.username('').password('').normalize();var r='';if(n._parts.protocol&&(r+=n._parts.protocol+'://'),n._parts.hostname&&(n.is('punycode')&&e?(r+=e.toUnicode(n._parts.hostname),n._parts.port&&(r+=':'+n._parts.port)):r+=n.host()),n._parts.hostname&&n._parts.path&&'/'!==n._parts.path.charAt(0)&&(r+='/'),r+=n.path(!0),n._parts.query){for(var t='',a=0,s=n._parts.query.split('&'),i=s.length,d;a<i;a++)d=(s[a]||'').split('='),t+='&'+o.decodeQuery(d[0],this._parts.escapeQuerySpace).replace(/&/g,'%26'),void 0!==d[1]&&(t+='='+o.decodeQuery(d[1],this._parts.escapeQuerySpace).replace(/&/g,'%26'));r+='?'+t.substring(1)}return r+=o.decodeQuery(n.hash(),!0),r},k.absoluteTo=function(e){var t=this.clone(),n=['protocol','username','password','hostname','port'],r,a,s;if(this._parts.urn)throw new Error('URNs do not have any generally defined hierarchical components');if(e instanceof o||(e=new o(e)),t._parts.protocol)return t;if(t._parts.protocol=e._parts.protocol,this._parts.hostname)return t;for(a=0;s=n[a];a++)t._parts[s]=e._parts[s];return t._parts.path?('..'===t._parts.path.substring(-2)&&(t._parts.path+='/'),'/'!==t.path().charAt(0)&&(r=e.directory(),r=r?r:0===e.path().indexOf('/')?'/':'',t._parts.path=(r?r+'/':'')+t._parts.path,t.normalizePath())):(t._parts.path=e._parts.path,!t._parts.query&&(t._parts.query=e._parts.query)),t.build(),t},k.relativeTo=function(e){var t=this.clone().normalize(),n,r,a,s,i;if(t._parts.urn)throw new Error('URNs do not have any generally defined hierarchical components');if(e=new o(e).normalize(),n=t._parts,r=e._parts,s=t.path(),i=e.path(),'/'!==s.charAt(0))throw new Error('URI is already relative');if('/'!==i.charAt(0))throw new Error('Cannot calculate a URI relative to another relative URI');if(n.protocol===r.protocol&&(n.protocol=null),n.username!==r.username||n.password!==r.password)return t.build();if(null!==n.protocol||null!==n.username||null!==n.password)return t.build();if(n.hostname===r.hostname&&n.port===r.port)n.hostname=null,n.port=null;else return t.build();if(s===i)return n.path='',t.build();if(a=o.commonPath(s,i),!a)return t.build();var d=r.path.substring(a.length).replace(/[^\/]*$/,'').replace(/.*?\//g,'../');return n.path=d+n.path.substring(a.length)||'./',t.build()},k.equals=function(e){var t=this.clone(),n=new o(e),r={},a={},s={},i,d,l;if(t.normalize(),n.normalize(),t.toString()===n.toString())return!0;if(i=t.query(),d=n.query(),t.query(''),n.query(''),t.toString()!==n.toString())return!1;if(i.length!==d.length)return!1;for(l in r=o.parseQuery(i,this._parts.escapeQuerySpace),a=o.parseQuery(d,this._parts.escapeQuerySpace),r)if(p.call(r,l)){if(!c(r[l])){if(r[l]!==a[l])return!1;}else if(!m(r[l],a[l]))return!1;s[l]=!0}for(l in a)if(p.call(a,l)&&!s[l])return!1;return!0},k.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},k.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},o})},function(e,t,n){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){const n=i.default.createHash(e);return n.update(t),n.digest()}function o(e,t,n){const r=i.default.createHmac(e,t);return r.update(n).digest()}Object.defineProperty(t,'__esModule',{value:!0}),t.hash=a,t.hmac=o,t.shake128=function(e){let t=[],r=0;return{nextBytes:function(a){if(r+a>t.length){const n=l.default.shake128.create(8*t.length+512);n.update(e),t=Buffer.from(n.arrayBuffer())}const n=t.slice(r,r+a);return r+=a,n}}},t.fnv1a=function(e){let t=2166136261;for(let n=0;n<e.length;++n)t^=e[n],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);const n=Buffer.alloc(4);return n.writeUIntBE(t>>>0,0,4),n},t.xor=function(e,t){if(e.length===t.length){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r]^t[r];return e instanceof Buffer?Buffer.from(n):n}return null},t.EVP_BytesToKey=function(e,t,n){let r=Buffer.from(e),o=0;const s=[];for(;Buffer.concat(s).length<t+n;)0<o&&(r=Buffer.concat([s[o-1],Buffer.from(e)])),s.push(a('md5',r)),o+=1;return Buffer.concat(s).slice(0,t)},t.HKDF=function(e,n,r,a,s){const d=o(e,n,r);let l=Buffer.alloc(0),t=Buffer.alloc(0);for(let c=0;c<Math.ceil(s/d.length);++c)l=o(e,d,Buffer.concat([l,a,Buffer.alloc(1,c+1)])),t=Buffer.concat([t,l]);return t.slice(0,s)};var s=n(2),i=r(s),d=n(53),l=r(d)},function(e){'use strict';/**
 * [js-sha3]{@link https://github.com/emn178/js-sha3}
 *
 * @version 0.6.1
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2017
 * @license MIT
 */(function(){function t(e,t,n){this.blocks=[],this.s=[],this.padding=t,this.outputBits=n,this.reset=!0,this.block=0,this.start=0,this.blockCount=1600-(e<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=n>>5,this.extraBytes=(31&n)>>3;for(var r=0;50>r;++r)this.s[r]=0}function n(e,n,r){t.call(this,e,n,r)}var r='object'==typeof window?window:{},a=!r.JS_SHA3_NO_NODE_JS&&'object'==typeof process&&process.versions&&process.versions.node;a&&(r=global);var o=!r.JS_SHA3_NO_COMMON_JS&&'object'==typeof e&&e.exports,d=!r.JS_SHA3_NO_ARRAY_BUFFER&&'undefined'!=typeof ArrayBuffer,l=['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'],s=[31,7936,2031616,520093696],c=[4,1024,262144,67108864],u=[1,256,65536,16777216],p=[6,1536,393216,100663296],m=[0,8,16,24],g=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],h=[224,256,384,512],_=[128,256],y=['hex','buffer','arrayBuffer','array'],b={128:168,256:136};(r.JS_SHA3_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(e){return'[object Array]'===Object.prototype.toString.call(e)});for(var k=function(e,n,r){return function(a){return new t(e,n,e).update(a)[r]()}},v=function(e,n,r){return function(a,o){return new t(e,n,o).update(a)[r]()}},E=function(e,t,r){return function(t,a,o,n){return D['cshake'+e].update(t,a,o,n)[r]()}},P=function(e,t,n){return function(t,r,a,o){return D['kmac'+e].update(t,r,a,o)[n]()}},S=function(e,t,n,r){for(var a=0,o;a<y.length;++a)o=y[a],e[o]=t(n,r,o);return e},x=function(e,n){var r=k(e,n,'hex');return r.create=function(){return new t(e,n,e)},r.update=function(e){return r.create().update(e)},S(r,k,e,n)},T=function(e,n){var r=v(e,n,'hex');return r.create=function(r){return new t(e,n,r)},r.update=function(e,t){return r.create(t).update(e)},S(r,v,e,n)},O=function(e,r){var a=b[e],o=E(e,r,'hex');return o.create=function(o,i,n){return i||n?new t(e,r,o).bytepad([i,n],a):D['shake'+e].create(o)},o.update=function(e,t,r,n){return o.create(t,r,n).update(e)},S(o,E,e,r)},R=function(e,t){var r=b[e],a=P(e,t,'hex');return a.create=function(a,o,i){return new n(e,t,o).bytepad(['KMAC',i],r).bytepad([a],r)},a.update=function(e,t,n,r){return a.create(e,n,r).update(t)},S(a,P,e,t)},C=[{name:'keccak',padding:u,bits:h,createMethod:x},{name:'sha3',padding:p,bits:h,createMethod:x},{name:'shake',padding:s,bits:_,createMethod:T},{name:'cshake',padding:c,bits:_,createMethod:O},{name:'kmac',padding:c,bits:_,createMethod:R}],D={},w=[],N=0;N<C.length;++N)for(var i=C[N],I=i.bits,M=0,A;M<I.length;++M)if(A=i.name+'_'+I[M],w.push(A),D[A]=i.createMethod(I[M],i.padding),'sha3'!==i.name){var B=i.name+I[M];w.push(B),D[B]=D[A]}t.prototype.update=function(e){var t='string'!=typeof e;t&&e.constructor===r.ArrayBuffer&&(e=new Uint8Array(e));var n=e.length;if(t&&('number'!=typeof n||!Array.isArray(e)&&!(d&&ArrayBuffer.isView(e))))throw'input is invalid type';for(var a=this.blocks,o=this.byteCount,l=this.blockCount,c=0,u=this.s,s,i;c<n;){if(this.reset)for(this.reset=!1,a[0]=this.block,s=1;s<l+1;++s)a[s]=0;if(t)for(s=this.start;c<n&&s<o;++c)a[s>>2]|=e[c]<<m[3&s++];else for(s=this.start;c<n&&s<o;++c)i=e.charCodeAt(c),128>i?a[s>>2]|=i<<m[3&s++]:2048>i?(a[s>>2]|=(192|i>>6)<<m[3&s++],a[s>>2]|=(128|63&i)<<m[3&s++]):55296>i||57344<=i?(a[s>>2]|=(224|i>>12)<<m[3&s++],a[s>>2]|=(128|63&i>>6)<<m[3&s++],a[s>>2]|=(128|63&i)<<m[3&s++]):(i=65536+((1023&i)<<10|1023&e.charCodeAt(++c)),a[s>>2]|=(240|i>>18)<<m[3&s++],a[s>>2]|=(128|63&i>>12)<<m[3&s++],a[s>>2]|=(128|63&i>>6)<<m[3&s++],a[s>>2]|=(128|63&i)<<m[3&s++]);if(this.lastByteIndex=s,s>=o){for(this.start=s-o,this.block=a[l],s=0;s<l;++s)u[s]^=a[s];L(u),this.reset=!0}else this.start=s}return this},t.prototype.encode=function(e,t){var r=255&e,a=1,n=[r];for(e>>=8,r=255&e;0<r;)n.unshift(r),e>>=8,r=255&e,++a;return t?n.push(a):n.unshift(a),this.update(n),n.length},t.prototype.encodeString=function(e){e=e||'';var t='string'!=typeof e;t&&e.constructor===r.ArrayBuffer&&(e=new Uint8Array(e));var n=e.length;if(t&&('number'!=typeof n||!Array.isArray(e)&&!(d&&ArrayBuffer.isView(e))))throw'input is invalid type';var a=0;if(t)a=n;else for(var o=0,s;o<e.length;++o)s=e.charCodeAt(o),128>s?a+=1:2048>s?a+=2:55296>s||57344<=s?a+=3:(s=65536+((1023&s)<<10|1023&e.charCodeAt(++o)),a+=4);return a+=this.encode(8*a),this.update(e),a},t.prototype.bytepad=function(e,t){for(var n=this.encode(t),r=0;r<e.length;++r)n+=this.encodeString(e[r]);var a=t-n%t,o=[];return o.length=a,this.update(o),this},t.prototype.finalize=function(){var e=this.blocks,t=this.lastByteIndex,n=this.blockCount,r=this.s;if(e[t>>2]|=this.padding[3&t],this.lastByteIndex===this.byteCount)for(e[0]=e[n],t=1;t<n+1;++t)e[t]=0;for(e[n-1]|=2147483648,t=0;t<n;++t)r[t]^=e[t];L(r)},t.prototype.toString=t.prototype.hex=function(){this.finalize();for(var e=this.blockCount,t=this.s,n=this.outputBlocks,r=this.extraBytes,a=0,o=0,s='',i;o<n;){for(a=0;a<e&&o<n;++a,++o)i=t[a],s+=l[15&i>>4]+l[15&i]+l[15&i>>12]+l[15&i>>8]+l[15&i>>20]+l[15&i>>16]+l[15&i>>28]+l[15&i>>24];0==o%e&&(L(t),a=0)}return r&&(i=t[a],0<r&&(s+=l[15&i>>4]+l[15&i]),1<r&&(s+=l[15&i>>12]+l[15&i>>8]),2<r&&(s+=l[15&i>>20]+l[15&i>>16])),s},t.prototype.arrayBuffer=function(){this.finalize();var e=this.blockCount,t=this.s,n=this.outputBlocks,r=this.extraBytes,a=0,o=0,s=this.outputBits>>3,i;i=r?new ArrayBuffer(n+1<<2):new ArrayBuffer(s);for(var d=new Uint32Array(i);o<n;){for(a=0;a<e&&o<n;++a,++o)d[o]=t[a];0==o%e&&L(t)}return r&&(d[a]=t[a],i=i.slice(0,s)),i},t.prototype.buffer=t.prototype.arrayBuffer,t.prototype.digest=t.prototype.array=function(){this.finalize();for(var e=this.blockCount,t=this.s,n=this.outputBlocks,r=this.extraBytes,a=0,o=0,s=[],i,d;o<n;){for(a=0;a<e&&o<n;++a,++o)i=o<<2,d=t[a],s[i]=255&d,s[i+1]=255&d>>8,s[i+2]=255&d>>16,s[i+3]=255&d>>24;0==o%e&&L(t)}return r&&(i=o<<2,d=t[a],0<r&&(s[i]=255&d),1<r&&(s[i+1]=255&d>>8),2<r&&(s[i+2]=255&d>>16)),s},n.prototype=new t,n.prototype.finalize=function(){return this.encode(this.outputBits,!0),t.prototype.finalize.call(this)};var L=function(e){var t,r,a,n,o,s,i,d,l,c,u,p,m,f,h,_,y,b,k,v,E,P,S,x,T,O,R,C,w,D,N,I,M,A,B,L,z,H,j,U,V,F,Q,q,Y,K,W,G,$,Z,J,X,ee,te,ne,re,ae,oe,se,ie,de,le,ce;for(a=0;48>a;a+=2)n=e[0]^e[10]^e[20]^e[30]^e[40],o=e[1]^e[11]^e[21]^e[31]^e[41],s=e[2]^e[12]^e[22]^e[32]^e[42],i=e[3]^e[13]^e[23]^e[33]^e[43],d=e[4]^e[14]^e[24]^e[34]^e[44],l=e[5]^e[15]^e[25]^e[35]^e[45],c=e[6]^e[16]^e[26]^e[36]^e[46],u=e[7]^e[17]^e[27]^e[37]^e[47],p=e[8]^e[18]^e[28]^e[38]^e[48],m=e[9]^e[19]^e[29]^e[39]^e[49],t=p^(s<<1|i>>>31),r=m^(i<<1|s>>>31),e[0]^=t,e[1]^=r,e[10]^=t,e[11]^=r,e[20]^=t,e[21]^=r,e[30]^=t,e[31]^=r,e[40]^=t,e[41]^=r,t=n^(d<<1|l>>>31),r=o^(l<<1|d>>>31),e[2]^=t,e[3]^=r,e[12]^=t,e[13]^=r,e[22]^=t,e[23]^=r,e[32]^=t,e[33]^=r,e[42]^=t,e[43]^=r,t=s^(c<<1|u>>>31),r=i^(u<<1|c>>>31),e[4]^=t,e[5]^=r,e[14]^=t,e[15]^=r,e[24]^=t,e[25]^=r,e[34]^=t,e[35]^=r,e[44]^=t,e[45]^=r,t=d^(p<<1|m>>>31),r=l^(m<<1|p>>>31),e[6]^=t,e[7]^=r,e[16]^=t,e[17]^=r,e[26]^=t,e[27]^=r,e[36]^=t,e[37]^=r,e[46]^=t,e[47]^=r,t=c^(n<<1|o>>>31),r=u^(o<<1|n>>>31),e[8]^=t,e[9]^=r,e[18]^=t,e[19]^=r,e[28]^=t,e[29]^=r,e[38]^=t,e[39]^=r,e[48]^=t,e[49]^=r,f=e[0],h=e[1],K=e[11]<<4|e[10]>>>28,W=e[10]<<4|e[11]>>>28,C=e[20]<<3|e[21]>>>29,w=e[21]<<3|e[20]>>>29,ie=e[31]<<9|e[30]>>>23,de=e[30]<<9|e[31]>>>23,F=e[40]<<18|e[41]>>>14,Q=e[41]<<18|e[40]>>>14,A=e[2]<<1|e[3]>>>31,B=e[3]<<1|e[2]>>>31,_=e[13]<<12|e[12]>>>20,y=e[12]<<12|e[13]>>>20,G=e[22]<<10|e[23]>>>22,$=e[23]<<10|e[22]>>>22,D=e[33]<<13|e[32]>>>19,N=e[32]<<13|e[33]>>>19,le=e[42]<<2|e[43]>>>30,ce=e[43]<<2|e[42]>>>30,te=e[5]<<30|e[4]>>>2,ne=e[4]<<30|e[5]>>>2,L=e[14]<<6|e[15]>>>26,z=e[15]<<6|e[14]>>>26,b=e[25]<<11|e[24]>>>21,k=e[24]<<11|e[25]>>>21,Z=e[34]<<15|e[35]>>>17,J=e[35]<<15|e[34]>>>17,I=e[45]<<29|e[44]>>>3,M=e[44]<<29|e[45]>>>3,x=e[6]<<28|e[7]>>>4,T=e[7]<<28|e[6]>>>4,re=e[17]<<23|e[16]>>>9,ae=e[16]<<23|e[17]>>>9,H=e[26]<<25|e[27]>>>7,j=e[27]<<25|e[26]>>>7,v=e[36]<<21|e[37]>>>11,E=e[37]<<21|e[36]>>>11,X=e[47]<<24|e[46]>>>8,ee=e[46]<<24|e[47]>>>8,q=e[8]<<27|e[9]>>>5,Y=e[9]<<27|e[8]>>>5,O=e[18]<<20|e[19]>>>12,R=e[19]<<20|e[18]>>>12,oe=e[29]<<7|e[28]>>>25,se=e[28]<<7|e[29]>>>25,U=e[38]<<8|e[39]>>>24,V=e[39]<<8|e[38]>>>24,P=e[48]<<14|e[49]>>>18,S=e[49]<<14|e[48]>>>18,e[0]=f^~_&b,e[1]=h^~y&k,e[10]=x^~O&C,e[11]=T^~R&w,e[20]=A^~L&H,e[21]=B^~z&j,e[30]=q^~K&G,e[31]=Y^~W&$,e[40]=te^~re&oe,e[41]=ne^~ae&se,e[2]=_^~b&v,e[3]=y^~k&E,e[12]=O^~C&D,e[13]=R^~w&N,e[22]=L^~H&U,e[23]=z^~j&V,e[32]=K^~G&Z,e[33]=W^~$&J,e[42]=re^~oe&ie,e[43]=ae^~se&de,e[4]=b^~v&P,e[5]=k^~E&S,e[14]=C^~D&I,e[15]=w^~N&M,e[24]=H^~U&F,e[25]=j^~V&Q,e[34]=G^~Z&X,e[35]=$^~J&ee,e[44]=oe^~ie&le,e[45]=se^~de&ce,e[6]=v^~P&f,e[7]=E^~S&h,e[16]=D^~I&x,e[17]=N^~M&T,e[26]=U^~F&A,e[27]=V^~Q&B,e[36]=Z^~X&q,e[37]=J^~ee&Y,e[46]=ie^~le&te,e[47]=de^~ce&ne,e[8]=P^~f&_,e[9]=S^~h&y,e[18]=I^~x&O,e[19]=M^~T&R,e[28]=F^~A&L,e[29]=Q^~B&z,e[38]=X^~q&K,e[39]=ee^~Y&W,e[48]=le^~te&re,e[49]=ce^~ne&ae,e[0]^=g[a],e[1]^=g[a+1]};if(o)e.exports=D;else for(var N=0;N<w.length;++N)r[w[N]]=D[w[N]]})()},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.getCurrentTimestampInt=function(){return Math.floor(new Date().getTime()/1e3)}},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.kebabCase=function(e){const t=[];for(let n=0;n<e.length;++n){const r=e[n];'A'<=r&&'Z'>=r?(0<n&&t.push('-'),t.push(r.toLowerCase())):t.push(r)}return t.join('')}},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.isValidHostname=function(e){return!('string'!=typeof e)&&(1>e.length||253<e.length?!1:!1!==/^([a-z\d](-*[a-z\d])*)(\.([a-z\d](-*[a-z\d])*))*$/i.test(e)&&!1!==/^[^.]{1,63}(\.[^.]{1,63})*$/.test(e))},t.isValidPort=function(e){return!!Number.isInteger(e)&&!(0>=e||65535<=e)}},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.AdvancedBuffer=void 0;var r=n(6),a=function(e){return e&&e.__esModule?e:{default:e}}(r);class o extends a.default{constructor(e={}){if(super(),this._buffer=Buffer.alloc(0),this._getPacketLength=null,this._nextLength=0,'function'!=typeof e.getPacketLength)throw Error('options.getPacketLength should be a function');this._getPacketLength=e.getPacketLength}put(e,...t){if(!(e instanceof Buffer))throw Error('chunk must be a Buffer');this._buffer=this._digest(Buffer.concat([this._buffer,e]),...t)}final(){return this._buffer}clear(){this._buffer=Buffer.alloc(0)}_digest(e,...t){const n=this._nextLength||this._getPacketLength(e,...t);if(n instanceof Buffer)return this._digest(n,...t);return 0===n||void 0===n?e:0>n?Buffer.alloc(0):e.length===n?(this.emit('data',e,...t),this._nextLength=0,Buffer.alloc(0)):e.length<n?(this._nextLength=n,e):e.length>n?(this.emit('data',e.slice(0,n),...t),this._nextLength=0,this._digest(e.slice(n),...t)):void 0}}t.AdvancedBuffer=o},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.logger=void 0;var r=n(12),a=function(e){return e&&e.__esModule?e:{default:e}}(r);t.logger=new a.default.Logger},function(e){e.exports={name:'winston',description:'A multi-transport async logging library for Node.js',version:'2.3.1',author:'Charlie Robbins <charlie.robbins@gmail.com>',maintainers:['Jarrett Cruger <jcrugzz@gmail.com>','Alberto Pose <albertopose@gmail.com>'],repository:{type:'git',url:'https://github.com/winstonjs/winston.git'},keywords:['winston','logging','sysadmin','tools'],dependencies:{async:'~1.0.0',colors:'1.0.x',cycle:'1.0.x',eyes:'0.1.x',isstream:'0.1.x',"stack-trace":'0.0.x'},devDependencies:{"cross-spawn-async":'^2.0.0',hock:'1.x.x',"std-mocks":'~1.0.0',vows:'0.7.x'},main:'./lib/winston',scripts:{test:'vows --spec --isolate'},engines:{node:'>= 0.10.0'},license:'MIT'}},function(e,t,n){'use strict';Object.defineProperty(t,'Console',{configurable:!0,enumerable:!0,get:function(){return n(61).Console}}),Object.defineProperty(t,'File',{configurable:!0,enumerable:!0,get:function(){return n(77).File}}),Object.defineProperty(t,'Http',{configurable:!0,enumerable:!0,get:function(){return n(79).Http}}),Object.defineProperty(t,'Memory',{configurable:!0,enumerable:!0,get:function(){return n(82).Memory}})},function(e,t,n){'use strict';var r=n(6),a=n(7),o=n(8),s=n(11),i=n(15).Transport,d=t.Console=function(e){i.call(this,e),e=e||{},this.json=e.json||!1,this.colorize=e.colorize||!1,this.prettyPrint=e.prettyPrint||!1,this.timestamp='undefined'!=typeof e.timestamp&&e.timestamp,this.showLevel=!(e.showLevel!==void 0)||e.showLevel,this.label=e.label||null,this.logstash=e.logstash||!1,this.depth=e.depth||null,this.align=e.align||!1,this.stderrLevels=function(e,t){var n='Cannot have non-string elements in stderrLevels Array';if(t){if(e)throw new Error('Cannot set debugStdout and stderrLevels together');return s.stringArrayToSet(['error'],n)}if(!e)return s.stringArrayToSet(['error','debug'],n);if(!Array.isArray(e))throw new Error('Cannot set stderrLevels to type other than Array');return s.stringArrayToSet(e,n)}(e.stderrLevels,e.debugStdout),this.eol=e.eol||a.EOL,this.json&&(this.stringify=e.stringify||function(e){return JSON.stringify(e,null,2)})};o.inherits(d,i),d.prototype.name='console',d.prototype.log=function(e,t,n,r){if(this.silent)return r(null,!0);var a=this,o;o=s.log({colorize:this.colorize,json:this.json,level:e,message:t,meta:n,stringify:this.stringify,timestamp:this.timestamp,showLevel:this.showLevel,prettyPrint:this.prettyPrint,raw:this.raw,label:this.label,logstash:this.logstash,depth:this.depth,formatter:this.formatter,align:this.align,humanReadableUnhandledException:this.humanReadableUnhandledException}),this.stderrLevels[e]?process.stderr.write(o+this.eol):process.stdout.write(o+this.eol),a.emit('logged'),r(null,!0)}},function(e,t,n){'use strict';var r=t;r.decycle=function(e){var t=[],n=[];return function e(r,a){var o,s,i;if('object'==typeof r&&null!==r&&!(r instanceof Boolean)&&!(r instanceof Date)&&!(r instanceof Number)&&!(r instanceof RegExp)&&!(r instanceof String)){for(o=0;o<t.length;o+=1)if(t[o]===r)return{$ref:n[o]};if(t.push(r),n.push(a),'[object Array]'===Object.prototype.toString.apply(r))for(i=[],o=0;o<r.length;o+=1)i[o]=e(r[o],a+'['+o+']');else for(s in i={},r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=e(r[s],a+'['+JSON.stringify(s)+']'));return i}return r}(e,'$')},r.retrocycle=function(e){var t=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return function e(n){var r,a,o,s;if(n&&'object'==typeof n)if('[object Array]'===Object.prototype.toString.apply(n))for(r=0;r<n.length;r+=1)a=n[r],a&&'object'==typeof a&&(s=a.$ref,'string'==typeof s&&t.test(s)?n[r]=eval(s):e(a));else for(o in n)'object'==typeof n[o]&&(a=n[o],a&&(s=a.$ref,'string'==typeof s&&t.test(s)?n[o]=eval(s):e(a)))}(e),e}},function(e){e.exports=require('string_decoder')},function(e,t,n){'use strict';var r=n(14);e.exports=r},function(e){'use strict';var t={};e.exports=t;var n={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],grey:[90,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],blackBG:[40,49],redBG:[41,49],greenBG:[42,49],yellowBG:[43,49],blueBG:[44,49],magentaBG:[45,49],cyanBG:[46,49],whiteBG:[47,49]};Object.keys(n).forEach(function(e){var r=n[e],a=t[e]=[];a.open='\x1B['+r[0]+'m',a.close='\x1B['+r[1]+'m'})},function(e){'use strict';var t=process.argv;e.exports=function(){return-1!==t.indexOf('--no-color')||-1!==t.indexOf('--color=false')?!1:-1!==t.indexOf('--color')||-1!==t.indexOf('--color=true')||-1!==t.indexOf('--color=always')||(process.stdout&&!process.stdout.isTTY?!1:!('win32'!==process.platform)||!!('COLORTERM'in process.env)||'dumb'!==process.env.TERM&&!!/^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(process.env.TERM))}()},function(e){function t(e){throw new Error('Cannot find module \''+e+'\'.')}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=67},function(e){'use strict';e.exports=function(e){var t='';e=e||'Run the trap, drop the bass',e=e.split('');var n={a:['@','\u0104','\u023A','\u0245','\u0394','\u039B','\u0414'],b:['\xDF','\u0181','\u0243','\u026E','\u03B2','\u0E3F'],c:['\xA9','\u023B','\u03FE'],d:['\xD0','\u018A','\u0500','\u0501','\u0502','\u0503'],e:['\xCB','\u0115','\u018E','\u0258','\u03A3','\u03BE','\u04BC','\u0A6C'],f:['\u04FA'],g:['\u0262'],h:['\u0126','\u0195','\u04A2','\u04BA','\u04C7','\u050A'],i:['\u0F0F'],j:['\u0134'],k:['\u0138','\u04A0','\u04C3','\u051E'],l:['\u0139'],m:['\u028D','\u04CD','\u04CE','\u0520','\u0521','\u0D69'],n:['\xD1','\u014B','\u019D','\u0376','\u03A0','\u048A'],o:['\xD8','\xF5','\xF8','\u01FE','\u0298','\u047A','\u05DD','\u06DD','\u0E4F'],p:['\u01F7','\u048E'],q:['\u09CD'],r:['\xAE','\u01A6','\u0210','\u024C','\u0280','\u042F'],s:['\xA7','\u03DE','\u03DF','\u03E8'],t:['\u0141','\u0166','\u0373'],u:['\u01B1','\u054D'],v:['\u05D8'],w:['\u0428','\u0460','\u047C','\u0D70'],x:['\u04B2','\u04FE','\u04FC','\u04FD'],y:['\xA5','\u04B0','\u04CB'],z:['\u01B5','\u0240']};return e.forEach(function(e){e=e.toLowerCase();var r=n[e]||[' '],a=Math.floor(Math.random()*r.length);t+='undefined'==typeof n[e]?e:n[e][a]}),t}},function(e){'use strict';e.exports=function(e){function t(e){var t=Math.floor(Math.random()*e);return t}function n(e){var t=!1;return a.filter(function(n){t=n===e}),t}e=e||'   he is here   ';var r={up:['\u030D','\u030E','\u0304','\u0305','\u033F','\u0311','\u0306','\u0310','\u0352','\u0357','\u0351','\u0307','\u0308','\u030A','\u0342','\u0313','\u0308','\u034A','\u034B','\u034C','\u0303','\u0302','\u030C','\u0350','\u0300','\u0301','\u030B','\u030F','\u0312','\u0313','\u0314','\u033D','\u0309','\u0363','\u0364','\u0365','\u0366','\u0367','\u0368','\u0369','\u036A','\u036B','\u036C','\u036D','\u036E','\u036F','\u033E','\u035B','\u0346','\u031A'],down:['\u0316','\u0317','\u0318','\u0319','\u031C','\u031D','\u031E','\u031F','\u0320','\u0324','\u0325','\u0326','\u0329','\u032A','\u032B','\u032C','\u032D','\u032E','\u032F','\u0330','\u0331','\u0332','\u0333','\u0339','\u033A','\u033B','\u033C','\u0345','\u0347','\u0348','\u0349','\u034D','\u034E','\u0353','\u0354','\u0355','\u0356','\u0359','\u035A','\u0323'],mid:['\u0315','\u031B','\u0300','\u0301','\u0358','\u0321','\u0322','\u0327','\u0328','\u0334','\u0335','\u0336','\u035C','\u035D','\u035E','\u035F','\u0360','\u0362','\u0338','\u0337','\u0361',' \u0489']},a=[].concat(r.up,r.down,r.mid),o={};return function(e,a){var o='',s,c;for(c in a=a||{},a.up=a.up||!0,a.mid=a.mid||!0,a.down=a.down||!0,a.size=a.size||'maxi',e=e.split(''),e)if(!n(c)){switch(o+=e[c],s={up:0,down:0,mid:0},a.size){case'mini':s.up=t(8),s.min=t(2),s.down=t(8);break;case'maxi':s.up=t(16)+3,s.min=t(4)+1,s.down=t(64)+3;break;default:s.up=t(8)+1,s.mid=t(6)/2,s.down=t(8)+1;}var l=['up','mid','down'];for(var u in l)for(var d=l[u],p=0;p<=s[d];p++)a[d]&&(o+=r[d][t(r[d].length)])}return o}(e)}},function(e,t,n){'use strict';var r=n(14);e.exports=function(){return function(e,t){if(' '===e)return e;switch(t%3){case 0:return r.red(e);case 1:return r.white(e);case 2:return r.blue(e);}}}()},function(e,t,n){'use strict';var r=n(14);e.exports=function(e,t){return 0==t%2?e:r.inverse(e)}},function(e,t,n){'use strict';var r=n(14);e.exports=function(){var e=['red','yellow','green','blue','magenta'];return function(t,n){return' '===t?t:r[e[n++%e.length]](t)}}()},function(e,t,n){'use strict';var r=n(14);e.exports=function(){var e=['underline','inverse','grey','yellow','red','green','blue','white','cyan','magenta'];return function(t){return' '===t?t:r[e[Math.round(Math.random()*(e.length-1))]](t)}}()},function(e,t){'use strict';var n=t;n.levels={error:0,warn:1,help:2,data:3,info:4,debug:5,prompt:6,verbose:7,input:8,silly:9},n.colors={error:'red',warn:'yellow',help:'cyan',data:'grey',info:'green',debug:'blue',prompt:'grey',verbose:'cyan',input:'grey',silly:'magenta'}},function(e,t){'use strict';var n=t;n.levels={error:0,warn:1,info:2,verbose:3,debug:4,silly:5},n.colors={error:'red',warn:'yellow',info:'green',verbose:'cyan',debug:'blue',silly:'magenta'}},function(e,t){'use strict';var n=t;n.levels={emerg:0,alert:1,crit:2,error:3,warning:4,notice:5,info:6,debug:7},n.colors={emerg:'red',alert:'yellow',crit:'red',error:'red',warning:'red',notice:'yellow',info:'green',debug:'blue'}},function(e,t,n){'use strict';var r=n(6),a=n(3),o=n(9),s=n(8),i=n(27),d=n(18),l=n(11),c=n(15).Transport,u=n(78).isWritable,p=n(13).Stream,m=n(7),g=t.File=function(e){function t(t){Array.prototype.slice.call(arguments,1).forEach(function(n){if(e[n])throw new Error('Cannot set '+n+' and '+t+'together')})}var n=this;if(c.call(this,e),e.filename||e.dirname)t('filename or dirname','stream'),this._basename=this.filename=e.filename?o.basename(e.filename):'winston.log',this.dirname=e.dirname||o.dirname(e.filename),this.options=e.options||{flags:'a'},this.options.highWaterMark=this.options.highWaterMark||24;else if(e.stream)t('stream','filename','maxsize'),this._stream=e.stream,this._isStreams2=u(this._stream),this._stream.on('error',function(e){n.emit('error',e)}),this._stream.setMaxListeners(Infinity);else throw new Error('Cannot log to file without filename or stream.');this.json=!1!==e.json,this.logstash=e.logstash||!1,this.colorize=e.colorize||!1,this.maxsize=e.maxsize||null,this.rotationFormat=e.rotationFormat||!1,this.zippedArchive=e.zippedArchive||!1,this.maxFiles=e.maxFiles||null,this.prettyPrint=e.prettyPrint||!1,this.label=e.label||null,this.timestamp=null==e.timestamp||e.timestamp,this.eol=e.eol||m.EOL,this.tailable=e.tailable||!1,this.depth=e.depth||null,this.showLevel=void 0===e.showLevel||e.showLevel,this.maxRetries=e.maxRetries||2,this.json&&(this.stringify=e.stringify),this._size=0,this._created=0,this._buffer=[],this._draining=!1,this._opening=!1,this._failures=0,this._archive=null};s.inherits(g,c),g.prototype.name='file',g.prototype.log=function(e,t,n,r){if(this.silent)return r(null,!0);if(this._failures>=this.maxRetries)return r(new Error('Transport is in a failed state.'));var a=this;'string'!=typeof t&&(t=''+t);var o=l.log({level:e,message:t,meta:n,json:this.json,logstash:this.logstash,colorize:this.colorize,prettyPrint:this.prettyPrint,timestamp:this.timestamp,showLevel:this.showLevel,stringify:this.stringify,label:this.label,depth:this.depth,formatter:this.formatter,humanReadableUnhandledException:this.humanReadableUnhandledException});'string'==typeof o&&(o+=this.eol),this.filename?this.open(function(e){return e?a._buffer.push([o,r]):void(a._write(o,r),a._size+=o.length,a._lazyDrain())}):(this._write(o,r),this._size+=o.length,this._lazyDrain())},g.prototype._write=function(e,t){if(this._isStreams2)return this._stream.write(e),t&&process.nextTick(function(){t(null,!0)});var n=this._stream.write(e);return t?!1===n?this._stream.once('drain',function(){t(null,!0)}):void process.nextTick(function(){t(null,!0)}):void 0},g.prototype.query=function(e,t){function n(e,t){try{var n=JSON.parse(e);s(n)&&r(n)}catch(n){t||u.emit('error',n)}}function r(t){if(e.rows&&l.length>=e.rows&&'desc'!=e.order)return void(u.readable&&u.destroy());if(e.fields){var n={};e.fields.forEach(function(e){n[e]=t[e]}),t=n}'desc'===e.order&&l.length>=e.rows&&l.shift(),l.push(t)}function s(t){if(t&&'object'==typeof t){var n=new Date(t.timestamp);return e.from&&n<e.from||e.until&&n>e.until?void 0:!0}}'function'==typeof e&&(t=e,e={});var i=o.join(this.dirname,this.filename),e=this.normalizeQuery(e),d='',l=[],c=0,u=a.createReadStream(i,{encoding:'utf8'});u.on('error',function(e){return u.readable&&u.destroy(),t?'ENOENT'===e.code?t(null,l):t(e):void 0}),u.on('data',function(t){for(var t=(d+t).split(/\n+/),r=t.length-1,a=0;a<r;a++)(!e.start||c>=e.start)&&n(t[a]),c++;d=t[r]}),u.on('close',function(){d&&n(d,!0),'desc'===e.order&&(l=l.reverse()),t&&t(null,l)})},g.prototype.stream=function(e){var t=o.join(this.dirname,this.filename),e=e||{},n=new p,r={file:t,start:e.start};return n.destroy=l.tailFile(r,function(e,t){if(e)return n.emit('error',e);try{n.emit('data',t),t=JSON.parse(t),n.emit('log',t)}catch(t){n.emit('error',t)}}),n},g.prototype.open=function(e){if(this.opening)return e(!0);return!this._stream||this.maxsize&&this._size>=this.maxsize?(e(!0),this._createStream()):void(this._archive=this.zippedArchive?this._stream.path:null,e())},g.prototype.close=function(){var e=this;this._stream&&(this._stream.end(),this._stream.destroySoon(),this._stream.once('finish',function(){e.emit('flush'),e.emit('closed')}))},g.prototype.flush=function(){var e=this;return this._buffer.length?void(this._buffer.forEach(function(t){var n=t[0],r=t[1];process.nextTick(function(){e._write(n,r),e._size+=n.length})}),e._buffer.length=0,e._stream.once('drain',function(){e.emit('flush'),e.emit('logged')})):e.emit('flush')},g.prototype._createStream=function(){var e=this;this.opening=!0,function t(n){function r(t){e._stream&&(e._stream.end(),e._stream.destroySoon()),e._size=t,e.filename=n,e._stream=a.createWriteStream(i,e.options),e._isStreams2=u(e._stream),e._stream.on('error',function(t){e._failures<e.maxRetries?(e._createStream(),e._failures++):e.emit('error',t)}),e._stream.setMaxListeners(Infinity),e.once('flush',function(){e.flush(),e.opening=!1,e.emit('open',i)}),e.flush(),s()}function s(){if(e._archive){var t=d.createGzip(),n=a.createReadStream(e._archive+''),r=a.createWriteStream(e._archive+'.gz');n.pipe(t).pipe(r),a.unlink(e._archive+''),e._archive=''}}var i=o.join(e.dirname,n);a.stat(i,function(n,a){return n?'ENOENT'===n.code?r(0):e.emit('error',n):!a||e.maxsize&&a.size>=e.maxsize?e._incFile(function(){t(e._getFile())}):void r(a.size)})}(this._getFile())},g.prototype._incFile=function(e){var t=o.extname(this._basename),n=o.basename(this._basename,t);this.tailable?this._checkMaxFilesTailable(t,n,e):(this._created+=1,this._checkMaxFilesIncrementing(t,n,e))},g.prototype._getFile=function(){var e=o.extname(this._basename),t=o.basename(this._basename,e);return!this.tailable&&this._created?t+(this.rotationFormat?this.rotationFormat():this._created)+e:t+e},g.prototype._checkMaxFilesIncrementing=function(e,t,n){var r=this,s,i;return r.zippedArchive&&(r._archive=o.join(r.dirname,t+(1===r._created?'':r._created-1)+e)),!r.maxFiles||r._created<r.maxFiles?n():void(s=r._created-r.maxFiles,i=o.join(r.dirname,t+(0===s?'':s)+e+(r.zippedArchive?'.gz':'')),a.unlink(i,n))},g.prototype._checkMaxFilesTailable=function(e,t,n){var r=[],s=this;if(this.maxFiles){for(var d=this.maxFiles-1;0<d;d--)r.push(function(n){return function(r){var i=o.join(s.dirname,t+(n-1)+e+(s.zippedArchive?'.gz':''));a.exists(i,function(d){return d?void a.rename(i,o.join(s.dirname,t+n+e+(s.zippedArchive?'.gz':'')),r):r(null)})}}(d));s.zippedArchive&&(s._archive=o.join(s.dirname,t+1+e)),i.series(r,function(){a.rename(o.join(s.dirname,t+e),o.join(s.dirname,t+1+e),n)})}},g.prototype._lazyDrain=function(){var e=this;!this._draining&&this._stream&&(this._draining=!0,this._stream.once('drain',function(){this._draining=!1,e.emit('logged')}))}},function(e,t,n){'use strict';function r(e){return e instanceof s.Stream}function a(e){return r(e)&&'function'==typeof e._read&&'object'==typeof e._readableState}function o(e){return r(e)&&'function'==typeof e._write&&'object'==typeof e._writableState}var s=n(13);e.exports=r,e.exports.isReadable=a,e.exports.isWritable=o,e.exports.isDuplex=function(e){return a(e)&&o(e)}},function(e,t,n){'use strict';var r=n(8),a=n(12),o=n(80),s=n(81),i=n(13).Stream,d=n(15).Transport,l=t.Http=function(e){d.call(this,e),e=e||{},this.name='http',this.ssl=!!e.ssl,this.host=e.host||'localhost',this.port=e.port,this.auth=e.auth,this.path=e.path||'',this.agent=e.agent,this.port||(this.port=this.ssl?443:80)};r.inherits(l,a.Transport),l.prototype.name='http',l.prototype._request=function(e,t){e=e||{};var n=e.auth||this.auth,r=e.path||this.path||'',a;delete e.auth,delete e.path,a=(this.ssl?s:o).request({host:this.host,port:this.port,path:'/'+r.replace(/^\//,''),method:'POST',headers:{"Content-Type":'application/json'},agent:this.agent,auth:n?n.username+':'+n.password:''}),a.on('error',t),a.on('response',function(e){var n='';e.on('data',function(e){n+=e}),e.on('end',function(){t(null,e,n)}),e.resume()}),a.end(new Buffer(JSON.stringify(e),'utf8'))},l.prototype.log=function(e,t,n,r){var a=this;'function'==typeof n&&(r=n,n={});var o={method:'collect',params:{level:e,message:t,meta:n}};n&&(n.path&&(o.path=n.path,delete n.path),n.auth&&(o.auth=n.auth,delete n.auth)),this._request(o,function(e,t){return t&&200!==t.statusCode&&(e=new Error('HTTP Status Code: '+t.statusCode)),e?r(e):void(a.emit('logged'),r&&r(null,!0))})},l.prototype.query=function(e,t){'function'==typeof e&&(t=e,e={});var n=this,e=this.normalizeQuery(e);e={method:'query',params:e},e.params.path&&(e.path=e.params.path,delete e.params.path),e.params.auth&&(e.auth=e.params.auth,delete e.params.auth),this._request(e,function(e,n,r){if(n&&200!==n.statusCode&&(e=new Error('HTTP Status Code: '+n.statusCode)),e)return t(e);if('string'==typeof r)try{r=JSON.parse(r)}catch(n){return t(n)}t(null,r)})},l.prototype.stream=function(e){e=e||{};var t=this,n=new i,r,a;return n.destroy=function(){r.destroy()},e={method:'stream',params:e},e.params.path&&(e.path=e.params.path,delete e.params.path),e.params.auth&&(e.auth=e.params.auth,delete e.params.auth),r=this._request(e),a='',r.on('data',function(e){for(var e=(a+e).split(/\n+/),t=e.length-1,r=0;r<t;r++)try{n.emit('log',JSON.parse(e[r]))}catch(t){n.emit('error',t)}a=e[t]}),r.on('error',function(e){n.emit('error',e)}),n}},function(e){e.exports=require('http')},function(e){e.exports=require('https')},function(e,t,n){'use strict';var r=n(6),a=n(8),o=n(11),s=n(15).Transport,i=t.Memory=function(e){s.call(this,e),e=e||{},this.errorOutput=[],this.writeOutput=[],this.json=e.json||!1,this.colorize=e.colorize||!1,this.prettyPrint=e.prettyPrint||!1,this.timestamp='undefined'!=typeof e.timestamp&&e.timestamp,this.showLevel=!(e.showLevel!==void 0)||e.showLevel,this.label=e.label||null,this.depth=e.depth||null,this.json&&(this.stringify=e.stringify||function(e){return JSON.stringify(e,null,2)})};a.inherits(i,s),i.prototype.name='memory',i.prototype.log=function(e,t,n,r){if(this.silent)return r(null,!0);var a=this,s;s=o.log({colorize:this.colorize,json:this.json,level:e,message:t,meta:n,stringify:this.stringify,timestamp:this.timestamp,prettyPrint:this.prettyPrint,raw:this.raw,label:this.label,depth:this.depth,formatter:this.formatter,humanReadableUnhandledException:this.humanReadableUnhandledException}),'error'===e||'debug'===e?this.errorOutput.push(s):this.writeOutput.push(s),a.emit('logged'),r(null,!0)},i.prototype.clearLogs=function(){this.errorOutput=[],this.writeOutput=[]}},function(e,t){'use strict';function n(e){for(var t in e)this[t]=e[t]}t.get=function(e){var n=Error.stackTraceLimit;Error.stackTraceLimit=Infinity;var r={},a=Error.prepareStackTrace;Error.prepareStackTrace=function(e,t){return t},Error.captureStackTrace(r,e||t.get);var o=r.stack;return Error.prepareStackTrace=a,Error.stackTraceLimit=n,o},t.parse=function(e){if(!e.stack)return[];var t=this,n=e.stack.split('\n').slice(1);return n.map(function(e){if(e.match(/^\s*[-]{4,}$/))return t._createParsedCallSite({fileName:e,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,native:null});var n=e.match(/at (?:(.+)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);if(n){var r=null,a=null,o=null,s=null,i=null,d='native'===n[5];if(n[1]){o=n[1];var l=o.lastIndexOf('.');if('.'==o[l-1]&&l--,0<l){r=o.substr(0,l),a=o.substr(l+1);var c=r.indexOf('.Module');0<c&&(o=o.substr(c+1),r=r.substr(0,c))}s=null}a&&(s=r,i=a),'<anonymous>'===a&&(i=null,o=null);var u={fileName:n[2]||null,lineNumber:parseInt(n[3],10)||null,functionName:o,typeName:s,methodName:i,columnNumber:parseInt(n[4],10)||null,native:d};return t._createParsedCallSite(u)}}).filter(function(e){return!!e})};['this','typeName','functionName','methodName','fileName','lineNumber','columnNumber','function','evalOrigin'].forEach(function(e){n.prototype[e]=null,n.prototype['get'+e[0].toUpperCase()+e.substr(1)]=function(){return this[e]}}),['topLevel','eval','native','constructor'].forEach(function(e){n.prototype[e]=!1,n.prototype['is'+e[0].toUpperCase()+e.substr(1)]=function(){return this[e]}}),t._createParsedCallSite=function(e){return new n(e)}},function(e,t,n){'use strict';var r=n(11),a=n(12),o=n(8)._extend,s=t.Container=function(e){this.loggers={},this.options=e||{},this.default={transports:[new a.transports.Console({level:'silly',colorize:!1})]}};s.prototype.get=s.prototype.add=function(e,t){var n=this,s;return this.loggers[e]||(t=o({},t||this.options||this.default),s=t.transports||this.options.transports,t.transports=s?s.slice():[],0===t.transports.length&&(!t||!t.console)&&t.transports.push(this.default.transports[0]),Object.keys(t).forEach(function(n){if('transports'!==n){var o=r.capitalize(n);if(!a.transports[o])throw new Error('Cannot add unknown transport: '+o);var s=t[n];s.id=e,t.transports.push(new a.transports[o](s))}}),t.id=e,this.loggers[e]=new a.Logger(t),this.loggers[e].on('close',function(){n._delete(e)})),this.loggers[e]},s.prototype.has=function(e){return!!this.loggers[e]},s.prototype.close=function(e){function t(e){n.loggers[e]&&(n.loggers[e].close(),n._delete(e))}var n=this;return e?t(e):Object.keys(this.loggers).forEach(function(e){t(e)})},s.prototype._delete=function(e){delete this.loggers[e]}},function(e,t,n){'use strict';function r(e){this.logger=e,this.start=Date.now()}var a=n(6),o=n(8),s=n(27),i=n(17),d=n(11),l=n(28),c=n(13).Stream,u=/%[sdj%]/g,p=t.Logger=function(e){a.EventEmitter.call(this),this.configure(e)};o.inherits(p,a.EventEmitter),p.prototype.configure=function(e){var t=this;Array.isArray(this._names)&&this._names.length&&this.clear(),e=e||{},this.transports={},this._names=[],e.transports&&e.transports.forEach(function(e){t.add(e,null,!0)}),this.padLevels=e.padLevels||!1,this.setLevels(e.levels),e.colors&&i.addColors(e.colors),this.id=e.id||null,this.level=e.level||'info',this.emitErrs=e.emitErrs||!1,this.stripColors=e.stripColors||!1,this.exitOnError=!('undefined'!=typeof e.exitOnError)||e.exitOnError,this.exceptionHandlers={},this.profilers={},['rewriters','filters'].forEach(function(n){t[n]=Array.isArray(e[n])?e[n]:[]}),e.exceptionHandlers&&this.handleExceptions(e.exceptionHandlers)},p.prototype.log=function(e){function t(e){i?i(e):a.emitErrs&&a.emit('error',e)}function n(t){if(i){if(t)return i(t);i(null,e,f,l)}i=null,t||a.emit('logged',e,f,l)}for(var r=Array.prototype.slice.call(arguments,1),a=this;null===r[r.length-1];)r.pop();var i='function'==typeof r[r.length-1]?r.pop():null;if(0===this._names.length)return t(new Error('Cannot log with no transports.'));if('undefined'==typeof a.levels[e])return t(new Error('Unknown log level: '+e));var d=this._names.filter(function(t){var n=a.transports[t];return n.level&&a.levels[n.level]>=a.levels[e]||!n.level&&a.levels[a.level]>=a.levels[e]});if(!d.length)return void(i&&i());var l={},c=!1,p=r&&r[0]&&r[0].match&&null!==r[0].match(u),m=p?r[0].match(u):[],g=m.filter(function(e){return'%%'===e}),f;if(0<r.length-1-(m.length-g.length)||1===r.length){l=r[r.length-1]||r;var h=Object.prototype.toString.call(l);c='[object Object]'===h||'[object Error]'===h||'[object Array]'===h,l=c?r.pop():{}}if(f=o.format.apply(null,r),this.padLevels&&(f=Array(this.levelLength-e.length+1).join(' ')+f),this.rewriters.forEach(function(t){l=t(e,f,l,a)}),this.filters.forEach(function(t){var n=t(e,f,l,a);'string'==typeof n?f=n:(f=n.msg,l=n.meta)}),this.stripColors){var _=/\u001b\[(\d+(;\d+)*)?m/g;f=(''+f).replace(_,'')}return s.forEach(d,function(t,r){var o=a.transports[t];o.log(e,f,l,function(t){return t?(t.transport=o,n(t),r()):void(a.emit('logging',o,e,f,l),r())})},n),this},p.prototype.query=function(e,t){function n(t,n){e.query&&(e.query=t.formatQuery(o)),t.query(e,function(r,a){return r?n(r):void n(null,t.formatResults(a,e.format))})}'function'==typeof e&&(t=e,e={});var r=this,e=e||{},a={},o=d.clone(e.query)||{},i;return e.transport?(e.transport=e.transport.toLowerCase(),n(this.transports[e.transport],t)):void(i=this._names.map(function(e){return r.transports[e]}).filter(function(e){return!!e.query}),s.forEach(i,function(e,t){n(e,function(n,r){t&&(r=n||r,r&&(a[e.name]=r),t()),t=null})},function(){t(null,a)}))},p.prototype.stream=function(e){var t=this,e=e||{},n=new c,r=[],a;if(e.transport){var o=this.transports[e.transport];if(delete e.transport,o&&o.stream)return o.stream(e)}return n._streams=r,n.destroy=function(){for(var e=r.length;e--;)r[e].destroy()},a=this._names.map(function(e){return t.transports[e]}).filter(function(e){return!!e.stream}),a.forEach(function(t){var a=t.stream(e);a&&(r.push(a),a.on('log',function(e){e.transport=e.transport||[],e.transport.push(t.name),n.emit('log',e)}),a.on('error',function(e){e.transport=e.transport||[],e.transport.push(t.name),n.emit('error',e)}))}),n},p.prototype.close=function(){var e=this;this._names.forEach(function(t){var n=e.transports[t];n&&n.close&&n.close()}),this.emit('close')},p.prototype.handleExceptions=function(){var e=Array.prototype.slice.call(arguments),t=[],n=this;e.forEach(function(e){Array.isArray(e)?t=t.concat(e):t.push(e)}),this.exceptionHandlers=this.exceptionHandlers||{},t.forEach(function(e){n.exceptionHandlers[e.name]=e}),this._hnames=Object.keys(n.exceptionHandlers),this.catchExceptions||(this.catchExceptions=this._uncaughtException.bind(this),process.on('uncaughtException',this.catchExceptions))},p.prototype.unhandleExceptions=function(){var e=this;this.catchExceptions&&(Object.keys(this.exceptionHandlers).forEach(function(t){var n=e.exceptionHandlers[t];n.close&&n.close()}),this.exceptionHandlers={},Object.keys(this.transports).forEach(function(t){var n=e.transports[t];n.handleExceptions&&(n.handleExceptions=!1)}),process.removeListener('uncaughtException',this.catchExceptions),this.catchExceptions=!1)},p.prototype.add=function(e,t,n){var r=n?e:new e(t);if(!r.name&&!r.log)throw new Error('Unknown transport with no log() method');else if(this.transports[r.name])throw new Error('Transport already attached: '+r.name+', assign a different name');return this.transports[r.name]=r,this._names=Object.keys(this.transports),r._onError=this._onError.bind(this,r),n||r.on('error',r._onError),r.handleExceptions&&!this.catchExceptions&&this.handleExceptions(),this},p.prototype.clear=function(){Object.keys(this.transports).forEach(function(e){this.remove({name:e})},this)},p.prototype.remove=function(e){var t='string'==typeof e?e:e.name||e.prototype.name;if(!this.transports[t])throw new Error('Transport '+t+' not attached to this instance');var n=this.transports[t];return delete this.transports[t],this._names=Object.keys(this.transports),n.close&&n.close(),n._onError&&n.removeListener('error',n._onError),this},p.prototype.startTimer=function(){return new r(this)},p.prototype.profile=function(e){var t=Date.now(),n,r,a,o,s;return this.profilers[e]?(n=this.profilers[e],delete this.profilers[e],r=Array.prototype.slice.call(arguments),s='function'==typeof r[r.length-1]?r.pop():null,o='object'==typeof r[r.length-1]?r.pop():{},a=2===r.length?r[1]:e,o.durationMs=t-n,this.info(a,o,s)):(this.profilers[e]=t,this)},p.prototype.setLevels=function(e){return d.setLevels(this,this.levels,e)},p.prototype.cli=function(){return this.padLevels=!0,this.setLevels(i.cli.levels),i.addColors(i.cli.colors),this.transports.console&&(this.transports.console.colorize=this.transports.console.colorize||!0,this.transports.console.timestamp=this.transports.console.timestamp||!1),this},p.prototype._uncaughtException=function(e){function t(){d&&!r&&(clearTimeout(i),r=!0,process.exit(1))}var n=this,r=!1,a=l.getAllInfo(e),o=this._getExceptionHandlers(),i,d;return d='function'==typeof this.exitOnError?this.exitOnError(e):this.exitOnError,o&&0!==o.length?void(s.forEach(o,function(t,n){t.logException('uncaughtException: '+(e.message||e),a,n,e)},t),d&&(i=setTimeout(t,3e3))):t()},p.prototype._getExceptionHandlers=function(){var e=this;return this._hnames.map(function(t){return e.exceptionHandlers[t]}).concat(this._names.map(function(t){return e.transports[t].handleExceptions&&e.transports[t]})).filter(Boolean)},p.prototype._onError=function(e,t){this.emitErrs&&this.emit('error',t,e)},r.prototype.done=function(e){var t=Array.prototype.slice.call(arguments),n='function'==typeof t[t.length-1]?t.pop():null,r='object'==typeof t[t.length-1]?t.pop():{};return r.duration=Date.now()-this.start+'ms',this.logger.info(e,r,n)}},function(e){'use strict';function t(e){var t=!1;if(null!=e&&'function'!=typeof e.toString)try{t=!!(e+'')}catch(t){}return t}function n(e){return!!e&&'object'==typeof e}var r=Function.prototype,a=Object.prototype,o=r.toString,s=a.hasOwnProperty,i=o.call(Object),d=a.toString,l=function(e,t){return function(n){return e(t(n))}}(Object.getPrototypeOf,Object);e.exports=function(e){if(!n(e)||d.call(e)!='[object Object]'||t(e))return!1;var r=l(e);if(null===r)return!0;var a=s.call(r,'constructor')&&r.constructor;return'function'==typeof a&&a instanceof a&&o.call(a)==i}},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(10),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=n(1),s=n(88);class i extends o.IPreset{constructor(...e){var t;return t=super(...e),this._proxy=null,t}handleProxy({buffer:e,next:t,broadcast:n}){if(null===this._proxy&&(this._proxy=new s.Proxifier({onHandshakeDone:(e,r)=>{var i=[e.type===s.ATYP_DOMAIN?e.host.toString():a.default.toString(e.host),e.port.readUInt16BE(0)];const d=i[0],l=i[1];n({type:o.CONNECT_TO_REMOTE,payload:{host:d,port:l,onConnected:()=>r(t)}})}})),!this._proxy.isDone()){this._proxy.makeHandshake((e)=>t(e,!0),e)}else return e}clientOut(e){return this.handleProxy(e)}serverIn(e){return this.handleProxy(e)}}t.default=i},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(5);Object.keys(r).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var a=n(91);Object.keys(a).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0});t.Message=class{static parse(){return null}toBuffer(){return Buffer.from([])}}},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0});const n=t.NOOP=0,r=t.SOCKS_VERSION_V4=4,a=t.SOCKS_VERSION_V5=5,o=t.METHOD_NO_AUTH=0,s=t.REQUEST_COMMAND_CONNECT=1,i=t.REQUEST_COMMAND_BIND=2,d=t.REQUEST_COMMAND_UDP=3,l=t.ATYP_V4=1,c=t.ATYP_DOMAIN=3,u=t.ATYP_V6=4,p=t.REPLY_GRANTED=90,m=t.REPLY_SUCCEEDED=0,g=t.REPLY_COMMAND_NOT_SUPPORTED=7,f=t.REPLY_UNASSIGNED=255},function(e,t,n){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.Proxifier=void 0;var a=n(4),o=r(a),s=n(10),i=r(s),d=n(0),l=n(92),c=n(98),u=n(101),p=n(5);t.Proxifier=class{constructor(e){this._socksTcpReady=!1,this._socksUdpReady=!1,this._httpReady=!1,this.onHandshakeDone=e.onHandshakeDone}isDone(){return this._socksTcpReady||this._socksUdpReady||this._httpReady}makeHandshake(e,t){this._trySocksHandshake(e,t),this.isDone()||this._tryHttpHandshake(e,t)}_trySocksHandshake(e,t){this.isDone()||this._trySocks5Handshake(e,t),this.isDone()||this._trySocks4Handshake(e,t)}_trySocks4Handshake(e,t){const n=c.RequestMessage.parse(t);if(null!==n){const t=n.CMD,r=n.DSTIP,a=n.DSTADDR,o=n.DSTPORT;if(t===p.REQUEST_COMMAND_CONNECT){const t={type:0<a.length?p.ATYP_DOMAIN:p.ATYP_V4,host:0<a.length?a:r,port:o};this.onHandshakeDone(t,()=>{const t=new c.ReplyMessage({CMD:p.REPLY_GRANTED});e(t.toBuffer()),this._socksTcpReady=!0})}}}_trySocks5Handshake(e,t){const n=l.IdentifierMessage.parse(t);if(null!==n){const t=new l.SelectMessage;return void e(t.toBuffer())}const r=l.RequestMessage.parse(t);if(null!==r){const t=r.CMD;switch(t){case p.REQUEST_COMMAND_UDP:case p.REQUEST_COMMAND_CONNECT:{const n={type:r.ATYP,host:r.DSTADDR,port:r.DSTPORT};this.onHandshakeDone(n,()=>{const n=new l.ReplyMessage({REP:p.REPLY_SUCCEEDED});e(n.toBuffer()),t===p.REQUEST_COMMAND_CONNECT?this._socksTcpReady=!0:this._socksUdpReady=!0});break}default:{const t=new l.ReplyMessage({REP:p.REPLY_COMMAND_NOT_SUPPORTED});e(t.toBuffer());break}}}}_tryHttpHandshake(e,t){const n=u.HttpRequestMessage.parse(t);if(null!==n){const r=n.METHOD,a=n.URI,s=n.HOST,l=r.toString();let c={};if('CONNECT'===l)c=(0,d.parseURI)(a.toString());else{let e=null,t=s.toString();o.default.isIP(t)?(e=o.default.isIPv4(t)?p.ATYP_V4:p.ATYP_V6,t=i.default.toBuffer(t)):(e=p.ATYP_DOMAIN,t=s),c={type:e,host:t,port:Buffer.from([0,80])}}this.onHandshakeDone(c,(n)=>{if('CONNECT'===l){const t=new u.ConnectReplyMessage;e(t.toBuffer())}else n(t);this._httpReady=!0})}}}},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(93);Object.keys(r).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var a=n(94);Object.keys(a).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var o=n(95);Object.keys(o).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var s=n(96);Object.keys(s).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var i=n(97);Object.keys(i).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.IdentifierMessage=void 0;var r=Object.assign||function(e){for(var t=1,n;t<arguments.length;t++)for(var r in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},a=n(5);class o extends a.Message{constructor(e){super();const t=r({VER:a.SOCKS_VERSION_V5,NMETHODS:1,METHODS:[a.METHOD_NO_AUTH]},e);this.VER=t.VER,this.NMETHODS=t.NMETHODS,this.METHODS=t.METHODS}static parse(e){return 3>e.length?null:e[0]===a.SOCKS_VERSION_V5?1>e[1]?null:e.slice(2).length===e[1]?new o({VER:e[0],NMETHODS:e[1],METHODS:e.slice(2)}):null:null}toBuffer(){return Buffer.from([this.VER,this.NMETHODS,...this.METHODS])}}t.IdentifierMessage=o},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.SelectMessage=void 0;var r=Object.assign||function(e){for(var t=1,n;t<arguments.length;t++)for(var r in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},a=n(5);class o extends a.Message{constructor(e){super();const t=r({VER:a.SOCKS_VERSION_V5,METHOD:a.METHOD_NO_AUTH},e);this.VER=t.VER,this.METHOD=t.METHOD}toBuffer(){return Buffer.from([this.VER,this.METHOD])}}t.SelectMessage=o},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.RequestMessage=void 0;var r=Object.assign||function(e){for(var t=1,n;t<arguments.length;t++)for(var r in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},a=n(5);class o extends a.Message{constructor(e){super();const t=r({VER:a.SOCKS_VERSION_V5,CMD:a.REQUEST_COMMAND_CONNECT,RSV:a.NOOP,ATYP:a.ATYP_V4,DSTADDR:[a.NOOP],DSTPORT:[a.NOOP,a.NOOP]},e);this.VER=t.VER,this.CMD=t.CMD,this.RSV=t.RSV,this.ATYP=t.ATYP,this.DSTADDR=t.DSTADDR,this.DSTPORT=t.DSTPORT}static parse(e){if(9>e.length)return null;if(e[0]!==a.SOCKS_VERSION_V5)return null;const t=[a.REQUEST_COMMAND_CONNECT,a.REQUEST_COMMAND_BIND,a.REQUEST_COMMAND_UDP];if(!t.includes(e[1]))return null;if(e[2]!==a.NOOP)return null;const n=[a.ATYP_V4,a.ATYP_DOMAIN,a.ATYP_V6];if(!n.includes(e[3]))return null;let r=null;switch(e[3]){case a.ATYP_DOMAIN:r=e.slice(5,5+e[4]);break;case a.ATYP_V6:r=e.slice(4,20);break;default:r=e.slice(4,8);}return new o({VER:e[0],CMD:e[1],RSV:e[2],ATYP:e[3],DSTADDR:r,DSTPORT:e.slice(-2)})}}t.RequestMessage=o},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.ReplyMessage=void 0;var r=Object.assign||function(e){for(var t=1,n;t<arguments.length;t++)for(var r in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},a=n(5);class o extends a.Message{constructor(e){super();const t=r({VER:a.SOCKS_VERSION_V5,REP:a.REPLY_UNASSIGNED,RSV:a.NOOP,ATYP:a.ATYP_V4,BNDADDR:[a.NOOP,a.NOOP,a.NOOP,a.NOOP],BNDPORT:[a.NOOP,a.NOOP]},e);this.VER=t.VER,this.REP=t.REP,this.RSV=t.RSV,this.ATYP=t.ATYP,this.BNDADDR=t.BNDADDR,this.BNDPORT=t.BNDPORT}toBuffer(){return Buffer.from([this.VER,this.REP,this.RSV,this.ATYP,...this.BNDADDR,...this.BNDPORT])}}t.ReplyMessage=o},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.UdpRequestMessage=void 0;var r=Object.assign||function(e){for(var t=1,n;t<arguments.length;t++)for(var r in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},a=n(5);class o extends a.Message{constructor(e){super();const t=r({RSV:[a.NOOP,a.NOOP],FRAG:a.NOOP,ATYP:a.ATYP_V4,DSTADDR:[a.NOOP],DSTPORT:[a.NOOP,a.NOOP],DATA:[a.NOOP]},e);this.RSV=t.RSV,this.FRAG=t.FRAG,this.ATYP=t.ATYP,this.DSTADDR=t.DSTADDR,this.DSTPORT=t.DSTPORT,this.DATA=t.DATA}static parse(e){if(7>e.length)return null;if(e[0]!==a.NOOP||e[1]!==a.NOOP)return null;const t=[a.ATYP_V4,a.ATYP_DOMAIN,a.ATYP_V6];if(!t.includes(e[3]))return null;let n=null,r=null;switch(e[3]){case a.ATYP_DOMAIN:n=e.slice(5,5+e[4]),r=e.slice(5+e[4],7+e[4]);break;case a.ATYP_V6:n=e.slice(4,20),r=e.slice(20,22);break;default:n=e.slice(4,8),r=e.slice(8,10);}return new o({RSV:[a.NOOP,a.NOOP],FRAG:e[2],ATYP:e[3],DSTADDR:n,DSTPORT:r,DATA:e.slice(6+n.length)})}}t.UdpRequestMessage=o},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(99);Object.keys(r).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var a=n(100);Object.keys(a).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.RequestMessage=void 0;var r=Object.assign||function(e){for(var t=1,n;t<arguments.length;t++)for(var r in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},a=n(5);class o extends a.Message{constructor(e){super();const t=r({VER:a.SOCKS_VERSION_V4,CMD:a.REQUEST_COMMAND_CONNECT,DSTPORT:[a.NOOP,a.NOOP],DSTIP:[a.NOOP,a.NOOP,a.NOOP,a.NOOP],USERID:[a.NOOP],DSTADDR:[a.NOOP]},e);this.VER=t.VER,this.CMD=t.CMD,this.DSTPORT=t.DSTPORT,this.DSTIP=t.DSTIP,this.USERID=t.USERID,this.DSTADDR=t.DSTADDR}static parse(e){if(9>e.length)return null;if(e[0]!==a.SOCKS_VERSION_V4)return null;const t=[a.REQUEST_COMMAND_CONNECT,a.REQUEST_COMMAND_BIND];if(!t.includes(e[1]))return null;if(e[e.length-1]!==a.NOOP)return null;const n=e.slice(4,8);let r=[],s=[];if(n[0]===a.NOOP&&n[1]===a.NOOP&&n[2]===a.NOOP&&n[3]!==a.NOOP){const t=e.slice(8),n=[];let o=[];var i=!0,d=!1,l;try{for(var c=t[Symbol.iterator](),u;!(i=(u=c.next()).done);i=!0){const e=u.value;e===a.NOOP?(n.push(o),o=[]):o.push(e)}}catch(e){d=!0,l=e}finally{try{!i&&c.return&&c.return()}finally{if(d)throw l}}if(2!==n.length||1>n[1].length)return null;r=n[0],s=Buffer.from(n[1])}return new o({VER:e[0],CMD:e[1],DSTPORT:e.slice(2,4),DSTIP:n,USERID:r,DSTADDR:s})}}t.RequestMessage=o},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.ReplyMessage=void 0;var r=Object.assign||function(e){for(var t=1,n;t<arguments.length;t++)for(var r in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},a=n(5);class o extends a.Message{constructor(e){super();const t=r({VER:a.NOOP,CMD:a.REPLY_GRANTED,DSTPORT:[a.NOOP,a.NOOP],DSTIP:[a.NOOP,a.NOOP,a.NOOP,a.NOOP]},e);this.VER=t.VER,this.CMD=t.CMD,this.DSTPORT=t.DSTPORT,this.DSTIP=t.DSTIP}toBuffer(){return Buffer.from([this.VER,this.CMD,...this.DSTPORT,...this.DSTIP])}}t.ReplyMessage=o},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(102);Object.keys(r).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var a=n(103);Object.keys(a).forEach(function(e){'default'===e||'__esModule'===e||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.HttpRequestMessage=void 0;var r=function(){function e(e,t){var n=[],r=!0,a=!1,o;try{for(var s=e[Symbol.iterator](),i;!(r=(i=s.next()).done)&&(n.push(i.value),!(t&&n.length===t));r=!0);}catch(e){a=!0,o=e}finally{try{!r&&s['return']&&s['return']()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),a=Object.assign||function(e){for(var t=1,n;t<arguments.length;t++)for(var r in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},o=n(5);class s extends o.Message{constructor(e={}){super();const t=a({},e);this.METHOD=t.METHOD,this.URI=t.URI,this.VERSION=t.VERSION,this.HOST=t.HOST}static parse(e){if(20>e.length)return null;const t=e.toString(),n=t.split('\r\n');if(4>n.length)return null;var a=n[0].split(' '),o=r(a,3);const i=o[0],d=o[1],l=o[2];if(['OPTIONS','GET','HEAD','POST','PUT','DELETE','TRACE','CONNECT'].includes(i)){const e=n.slice(1,-2);var c=!0,u=!1,p;try{for(var m=e[Symbol.iterator](),g;!(c=(g=m.next()).done);c=!0){const e=g.value;if(e.startsWith('Host: ')){const t=e.split(' ')[1];return new s({METHOD:Buffer.from(i),URI:Buffer.from(d),VERSION:Buffer.from(l),HOST:Buffer.from(t)})}}}catch(e){u=!0,p=e}finally{try{!c&&m.return&&m.return()}finally{if(u)throw p}}}return null}}t.HttpRequestMessage=s},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.ConnectReplyMessage=void 0;var r=Object.assign||function(e){for(var t=1,n;t<arguments.length;t++)for(var r in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},a=n(5);class o extends a.Message{constructor(e={}){super();const t=r({VERSION:Buffer.from('HTTP/1.1'),STATUS:Buffer.from('200'),PHRASE:Buffer.from('Connection established')},e);this.VERSION=t.VERSION,this.STATUS=t.STATUS,this.PHRASE=t.PHRASE}toBuffer(){return Buffer.from([...this.VERSION,32,...this.STATUS,32,...this.PHRASE,13,10,13,10])}}t.ConnectReplyMessage=o},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(1),a=n(0);class o extends r.IPreset{static checkParams({host:e,port:t}){if(!(0,a.isValidHostname)(e))throw Error('host is invalid');if(!(0,a.isValidPort)(t))throw Error('port is invalid')}constructor({host:e,port:t}){super(),this._host=null,this._port=null,this._isTunnelReady=!1,this._isBroadCasting=!1,this._staging=Buffer.alloc(0),this._host=e,this._port=t}handleTunnel({buffer:e,next:t,broadcast:n}){return this._isTunnelReady?e:void(this._isBroadCasting?this._staging=Buffer.concat([this._staging,e]):(this._isBroadCasting=!0,n({type:r.CONNECT_TO_REMOTE,payload:{host:this._host,port:this._port,onConnected:()=>{t(Buffer.concat([e,this._staging])),this._isTunnelReady=!0,this._isBroadCasting=!1,this._staging=null}}})))}clientOut(e){return this.handleTunnel(e)}serverIn(e){return this.handleTunnel(e)}}t.default=o},function(e,t,n){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}var a=Math.max;Object.defineProperty(t,'__esModule',{value:!0});var o=n(3),s=r(o),i=n(9),d=r(i),l=n(1);const c=()=>new Date().getTime(),u=30,p=60;class m extends l.IPresetStatic{static checkParams({save_to:e,sample_interval:t=u,save_interval:n=p}){var r=Number.isSafeInteger;if('string'!=typeof e||''===e)throw Error('\'save_to\' must be a non-empty string');if('undefined'==typeof t)throw Error('\'sample_interval\' must be provided as an integer');if('number'!=typeof t)throw Error('\'sample_interval\' must be a number');if(!r(t))throw Error('\'sample_interval\' must be an integer');if(1>t)throw Error('\'sample_interval\' must be greater than 0');if('undefined'==typeof n)throw Error('\'save_interval\' must be provided as an integer');if('number'!=typeof n)throw Error('\'save_interval\' must be a number');if(!r(n))throw Error('\'save_interval\' must be an integer');if(1>n)throw Error('\'save_interval\' must be greater than 0')}constructor({save_to:e,sample_interval:t=u,save_interval:n=p}){super(),this.sampleInterval=u,this.saveInterval=p,this.saveTo='',this.sampleTimer=null,this.saveTimer=null,this.startedAt=c(),this.totalOutBytes=0,this.totalInBytes=0,this.totalOutPackets=0,this.totalInPackets=0,this.totalErrors=0,this.totalConnections=0,this.instantOutSpeed=0,this.instantInSpeed=0,this.maxOutSpeed=0,this.maxInSpeed=0,this.maxConnections=0,this.tmpOut=0,this.tmpIn=0,this.onSave=this.onSave.bind(this),this.onSample=this.onSample.bind(this),this.saveTo=d.default.resolve(process.cwd(),e),this.sampleInterval=t,this.saveInterval=n,this.sampleTimer=setInterval(this.onSample,1e3*t),this.saveTimer=setInterval(this.onSave,1e3*n),process.on('SIGINT',this.onSave)}onSave(){const e=this.startedAt,t=c(),n=t-e,r=n/1e3,a=this.totalInPackets+this.totalOutPackets,o=this.totalInBytes+this.totalOutBytes,i={sample:{from:e,to:t,duration:n},summary:{maxOutSpeed:this.maxOutSpeed,maxInSpeed:this.maxInSpeed,maxConnections:this.maxConnections,totalOutBytes:this.totalOutBytes,totalOutPackets:this.totalOutPackets,totalInBytes:this.totalInBytes,totalInPackets:this.totalInPackets,totalBytes:o,totalPackets:a,totalErrors:this.totalErrors},instant:{outSpeed:this.instantOutSpeed,inSpeed:this.instantInSpeed,totalConnections:this.totalConnections,errorRate:0<a.length?this.totalErrors/a:0,outBytesPerSecond:this.totalOutBytes/r,outPacketsPerSecond:this.totalOutPackets/r,inBytesPerSecond:this.totalInBytes/r,inPacketsPerSecond:this.totalInPackets/r,totalBytesPerSecond:o/r,totalPacketsPerSecond:a/r},process:{upTime:process.uptime(),cpuUsage:process.cpuUsage(),memoryUsage:process.memoryUsage()}};s.default.writeFileSync(this.saveTo,JSON.stringify(i,null,'  '))}onSample(){this.instantOutSpeed=this.tmpOut/this.sampleInterval,this.instantInSpeed=this.tmpIn/this.sampleInterval,this.maxOutSpeed=a(this.maxOutSpeed,this.instantOutSpeed),this.maxInSpeed=a(this.maxInSpeed,this.instantInSpeed),this.tmpOut=0,this.tmpIn=0}onNotified(e){e.type===l.PRESET_FAILED&&(this.totalErrors+=1),e.type===l.CONNECTION_CREATED&&(this.totalConnections+=1,this.maxConnections=a(this.maxConnections,this.totalConnections)),e.type===l.CONNECTION_CLOSED&&(this.totalConnections-=1)}onDestroy(){clearInterval(this.sampleTimer),clearInterval(this.saveTimer)}beforeOut({buffer:e}){return this.totalOutBytes+=e.length,this.totalOutPackets+=1,this.tmpOut+=e.length,e}beforeIn({buffer:e}){return this.totalInBytes+=e.length,this.totalInPackets+=1,this.tmpIn+=e.length,e}}t.default=m},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(1),a=n(0);const o='u',s='d';class i extends r.IPreset{constructor(...e){var t;return t=super(...e),this._tracks=[],t}onNotified({type:e,payload:t}){switch(e){case r.CONNECTION_CREATED:case r.CONNECT_TO_REMOTE:const n=t.host,a=t.port;this._tracks.push(`${n}:${a}`);break;case r.CONNECTION_CLOSED:this.dump(),this._tracks=[];break;default:}}beforeOut({buffer:e}){return this._tracks.push(o),this._tracks.push(e.length),e}beforeIn({buffer:e}){return this._tracks.push(s),this._tracks.push(e.length),e}dump(){let e=[],t=0,n=0,r=0,i=0,d='';var l=!0,c=!1,u;try{for(var p=this._tracks[Symbol.iterator](),m;!(l=(m=p.next()).done);l=!0){const a=m.value;if(a===o||a===s){if(d===a)continue;d=a}Number.isInteger(a)&&(d===s&&(t+=1,n+=a),d===o&&(r+=1,i+=a)),e.push(a)}}catch(e){c=!0,u=e}finally{try{!l&&p.return&&p.return()}finally{if(c)throw u}}const g=20;e.length>40&&(e=e.slice(0,g).concat([' ... ']).concat(e.slice(-g)));const f=__IS_CLIENT__?`out/in = ${r}/${t}, ${i}b/${n}b`:`in/out = ${t}/${r}, ${n}b/${i}b`;a.logger.info(`[tracker] summary(${f}) abstract(${e.join(' ')})`)}}t.default=i},function(e,t,n){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){const n=this.host,r=this.port,a=n.indexOf('/');let o=!1;return o=-1===a?n===e:x.default.cidrSubnet(n).contains(e),('*'===n||o)&&('*'===r||t===r)}function o(){return`${this.host}:${this.port} ${this.isBan?1:0} ${this.upLimit} ${this.dlLimit}`}function s(e){const t=e.indexOf('/');if(0>t)return'*'===e||b.default.isIP(e)||(0,O.isValidHostname)(e)?e:null;if(7>t)return null;const n=e.split('/'),r=n[0],a=n[n.length-1];return b.default.isIP(r)?''===a||!u(+a)||0>+a||32<+a?null:e:null}function i(e){const t=/^(\d+)(b|k|kb|m|mb|g|gb)$/g,n=t.exec(e.toLowerCase());if(null!==n){var r=m(n,3);const e=r[1],t=r[2];return+e*{b:1,k:1024,kb:1024,m:1048576,mb:1048576,g:1073741824,gb:1073741824}[t]}return null}function d(e){if(300<e.length)return null;if(e=e.trim(),1>e.length)return null;if('#'===e[0])return null;var t=e.split(' ').filter((e)=>0<e.length),n=m(t,4);const r=n[0],d=n[1],l=n[2],c=n[3];let u=null,p=null,g=!1,f='-',h='-';if(0<r.indexOf(':')){const e=r.split(':'),t=e[0],n=e[e.length-1];if(u=s(t),'*'!==n){if(!(0,O.isValidPort)(+n))return null;p=+n}else p=n}else u=s(r),p='*';if(null===u)return null;if(void 0!==d){if('0'!==d&&'1'!==d)return null;g='0'!==d}return void 0!==l&&'-'!==l&&(f=i(l),!f)?null:void 0!==c&&'-'!==c&&(h=i(c),!h)?null:{host:u,port:p,isBan:g,upLimit:f,dlLimit:h,isMatch:a,toString:o}}function l(e){O.logger.verbose('[acl] (re)loading access list');const t=f.default.createReadStream(e,{encoding:'utf-8'});t.on('error',(e)=>{O.logger.warn(`[acl] fail to reload acl: ${e.message}, keep using previous rules`)});const n=P.default.createInterface({input:t}),r=[];n.on('line',(e)=>{const t=d(e);null!==t&&r.push(t)}),n.on('close',()=>{R=r.reverse(),C={},O.logger.info(`[acl] ${R.length} rules loaded`)})}function c(e,t){const n=`${e}:${t}`,r=C[n];if(r!==void 0)return r;var a=!0,o=!1,s;try{for(var i=R[Symbol.iterator](),d;!(a=(d=i.next()).done);a=!0){const r=d.value;if(r.isMatch(e,t))return C[n]=r}}catch(e){o=!0,s=e}finally{try{!a&&i.return&&i.return()}finally{if(o)throw s}}return C[n]=null}var u=Number.isInteger,p=Math.ceil;Object.defineProperty(t,'__esModule',{value:!0});var m=function(){function e(e,t){var n=[],r=!0,a=!1,o;try{for(var s=e[Symbol.iterator](),i;!(r=(i=s.next()).done)&&(n.push(i.value),!(t&&n.length===t));r=!0);}catch(e){a=!0,o=e}finally{try{!r&&s['return']&&s['return']()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),g=n(3),f=r(g),h=n(7),_=r(h),y=n(4),b=r(y),k=n(9),v=r(k),E=n(31),P=r(E),S=n(10),x=r(S),T=n(1),O=n(0);let R=[],C={};const w=60,D={};class N extends T.IPreset{static checkParams({acl:e,max_tries:t=w}){if('string'!=typeof e||''===e)throw Error('\'acl\' must be a non-empty string');const n=v.default.resolve(process.cwd(),e);if(!f.default.existsSync(n))throw Error(`"${n}" not found`);if(void 0!==t){if('number'!=typeof t||!u(t))throw Error('\'max_tries\' must be an integer');if(1>t)throw Error('\'max_tries\' must be greater than 0')}}static onInit({acl:e}){const t=v.default.resolve(process.cwd(),e);l(t),f.default.watchFile(t,(e,n)=>{e.mtime>n.mtime&&l(t)})}constructor({acl:e,max_tries:t=w}){super(),this._aclPath='',this._maxTries=0,this._hrTimeBegin=process.hrtime(),this._remoteHost=null,this._remotePort=null,this._dstHost=null,this._dstPort=null,this._totalOut=0,this._totalIn=0,this._isBlocking=!1,this._isDlPaused=!1,this._isUpPaused=!1,this._aclPath=v.default.resolve(process.cwd(),e),this._maxTries=t}applyRule(e){const t=e.host,n=e.port,r=e.isBan,a=e.upLimit,o=e.dlLimit;if(O.logger.debug(`[acl] [${this._remoteHost}:${this._remotePort}] apply rule: "${e}"`),r&&(O.logger.info(`[acl] [${t}:${n}] baned by rule: "${e}"`),this.broadcast({type:T.PRESET_CLOSE_CONNECTION}),this._isBlocking=!0),'-'!==a){var s=process.hrtime(this._hrTimeBegin),i=m(s,2);const e=i[0],t=i[1],n=p(this._totalIn/(e+t/1e9));if(O.logger.debug(`[acl] upload speed: ${n}b/s`),n>a&&!this._isUpPaused){this._isUpPaused=!0,this.broadcast({type:T.PRESET_PAUSE_RECV});const e=1.1*(n/a),t=`[${this._remoteHost}:${this._remotePort}] -> [${this._dstHost}:${this._dstPort}]`;O.logger.info(`[acl] ${t} upload speed exceed: ${n}b/s > ${a}b/s, pause for ${e}s...`),setTimeout(()=>{this.broadcast({type:T.PRESET_RESUME_RECV}),this._isUpPaused=!1},1e3*e)}}if('-'!==o){var d=process.hrtime(this._hrTimeBegin),l=m(d,2);const e=l[0],t=l[1],n=p(this._totalOut/(e+t/1e9));if(O.logger.debug(`[acl] download speed: ${n}b/s`),n>o&&!this._isDlPaused){this._isDlPaused=!0,this.broadcast({type:T.PRESET_PAUSE_SEND});const e=1.1*(n/o),t=`[${this._remoteHost}:${this._remotePort}] <- [${this._dstHost}:${this._dstPort}]`;O.logger.info(`[acl] ${t} download speed exceed: ${n}b/s > ${o}b/s, pause for ${e}s...`),setTimeout(()=>{this.broadcast({type:T.PRESET_RESUME_SEND}),this._isDlPaused=!1},1e3*e)}}}checkRule(e,t){const n=c(e,t);null!==n&&this.applyRule(n)}appendToAcl(e){O.logger.info(`[acl] append rule: "${e}" to acl`),f.default.appendFile(this._aclPath,`${_.default.EOL}${e}`,(t)=>{t&&O.logger.warn(`[acl] fail to update acl: ${t.message}`),R.push(d(e))})}onNotified({type:e,payload:t}){switch(e){case T.CONNECTION_CREATED:{const e=t.host,n=t.port;this._remoteHost=e,this._remotePort=n,this.checkRule(e,n);break}case T.CONNECT_TO_REMOTE:{const e=t.host,n=t.port;this._dstHost=e,this._dstPort=n,this.checkRule(e,n);break}case T.PRESET_FAILED:{const e=this._remoteHost,t=this._maxTries;return void 0===D[e]&&(D[e]=0),void(++D[e]>=t&&(O.logger.warn(`[acl] ${e} max tries(${t}) exceed`),this.broadcast({type:T.PRESET_CLOSE_CONNECTION}),this._isBlocking=!0,null===c(e,'*')&&this.appendToAcl(`${e}:* 1`)))}}}beforeOut({buffer:e}){if(this._totalOut+=e.length,!this._isBlocking)return this.checkRule(this._remoteHost,this._remotePort),this.checkRule(this._dstHost,this._dstPort),e}beforeIn({buffer:e}){if(this._totalIn+=e.length,!this._isBlocking)return this.checkRule(this._remoteHost,this._remotePort),this.checkRule(this._dstHost,this._dstPort),e}}t.default=N},function(e,t,n){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}function a(e){return s.default.isIPv4(e)?u:s.default.isIPv6(e)?p:m}Object.defineProperty(t,'__esModule',{value:!0});var o=n(4),s=r(o),i=n(10),d=r(i),l=n(0),c=n(1);const u=1,p=4,m=3;class g extends c.IPreset{constructor(...e){var t;return t=super(...e),this._isHandshakeDone=!1,this._isBroadCasting=!1,this._staging=Buffer.alloc(0),this._atyp=u,this._host=null,this._port=null,t}onDestroy(){this._staging=null,this._host=null,this._port=null}onNotified(e){if(__IS_CLIENT__&&e.type===c.CONNECT_TO_REMOTE){var t=e.payload;const n=t.host,r=t.port,o=a(n);this._atyp=o,this._port=(0,l.numberToBuffer)(r),this._host=o===m?Buffer.from(n):d.default.toBuffer(n)}}clientOut({buffer:e}){return this._isHandshakeDone?e:(this._isHandshakeDone=!0,Buffer.from([this._atyp,...(this._atyp===m?(0,l.numberToBuffer)(this._host.length,1):[]),...this._host,...this._port,...e]))}serverIn({buffer:e,next:t,broadcast:n,fail:r}){if(!this._isHandshakeDone){if(this._isBroadCasting)return void(this._staging=Buffer.concat([this._staging,e]));if(7>e.length)return void r(`invalid length: ${e.length}`);const a=e[0];let o=3,s,i;switch(a){case u:s=d.default.toString(e.slice(1,5)),i=e.slice(5,7).readUInt16BE(0),o+=4;break;case p:if(19>e.length)return void r(`invalid length: ${e.length}`);s=d.default.toString(e.slice(1,17)),i=e.slice(17,19).readUInt16BE(0),o+=16;break;case m:const t=e[1];if(e.length<t+4)return void r(`invalid length: ${e.length}`);if(s=e.slice(2,2+t).toString(),!(0,l.isValidHostname)(s))return void r(`addr=${s} is an invalid hostname`);i=e.slice(2+t,4+t).readUInt16BE(0),o+=t+1;break;default:return void r(`invalid atyp: ${a}`);}const g=e.slice(o);this._isBroadCasting=!0,n({type:c.CONNECT_TO_REMOTE,payload:{host:s,port:i,onConnected:()=>{t(Buffer.concat([g,this._staging])),this._isHandshakeDone=!0,this._isBroadCasting=!1,this._staging=null}}})}else return e}}t.default=g},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(2),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=n(0),s=n(1);const i=16,d=['aes-128-ctr','aes-192-ctr','aes-256-ctr','aes-128-cfb','aes-192-cfb','aes-256-cfb','camellia-128-cfb','camellia-192-cfb','camellia-256-cfb'];class l extends s.IPreset{constructor(...e){var t;return t=super(...e),this._cipher=null,this._decipher=null,t}static checkParams({method:e}){if('string'!=typeof e||''===e)throw Error('\'method\' must be set');if(!d.includes(e))throw Error(`'method' must be one of [${d}]`)}static onInit({method:e}){this.cipherName=e,this.key=(0,o.EVP_BytesToKey)(__KEY__,e.split('-')[1]/8,i)}onDestroy(){this._cipher=null,this._decipher=null}beforeOut({buffer:e}){if(!this._cipher){const t=a.default.randomBytes(i);return this._cipher=a.default.createCipheriv(l.cipherName,l.key,t),Buffer.concat([t,this.encrypt(e)])}return this.encrypt(e)}beforeIn({buffer:e,fail:t}){if(!this._decipher){if(e.length<i)return t(`buffer is too short ${e.length} bytes to get iv, dump=${e.toString('hex')}`);const n=e.slice(0,i);return this._decipher=a.default.createDecipheriv(l.cipherName,l.key,n),this.decrypt(e.slice(i))}return this.decrypt(e)}encrypt(e){return this._cipher.update(e)}decrypt(e){return this._decipher.update(e)}}t.default=l,l.cipherName='',l.key=null},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=function(){function e(e,t){var n=[],r=!0,a=!1,o;try{for(var s=e[Symbol.iterator](),i;!(r=(i=s.next()).done)&&(n.push(i.value),!(t&&n.length===t));r=!0);}catch(e){a=!0,o=e}finally{try{!r&&s['return']&&s['return']()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),a=n(2),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=n(0),i=n(1);const d=12,l=16,c=16383,u={"aes-128-gcm":16,"aes-192-gcm":24,"aes-256-gcm":32},p='sha1';class m extends i.IPreset{static checkParams({method:e}){const t=Object.keys(u);if(!t.includes(e))throw Error(`'method' must be one of [${t}]`)}static onInit({method:e}){this.cipherName=e,this.keySaltSize=u[e],this.evpKey=(0,s.EVP_BytesToKey)(__KEY__,this.keySaltSize,16)}constructor(){super(),this._cipherKey=null,this._decipherKey=null,this._cipherNonce=0,this._decipherNonce=0,this._adBuf=null,this._adBuf=new s.AdvancedBuffer({getPacketLength:this.onReceiving.bind(this)}),this._adBuf.on('data',this.onChunkReceived.bind(this))}onDestroy(){this._adBuf.clear(),this._adBuf=null,this._cipherKey=null,this._decipherKey=null,this._cipherNonce=0,this._decipherNonce=0}beforeOut({buffer:e}){let t=null;if(null===this._cipherKey){const e=m.keySaltSize;t=o.default.randomBytes(e),this._cipherKey=(0,s.HKDF)(p,t,m.evpKey,m.info,e)}const n=(0,s.getRandomChunks)(e,2048,c).map((e)=>{const t=(0,s.numberToBuffer)(e.length);var n=this.encrypt(t),a=r(n,2);const o=a[0],i=a[1];var d=this.encrypt(e),l=r(d,2);const c=l[0],u=l[1];return Buffer.concat([o,i,c,u])});return t?Buffer.concat([t,...n]):Buffer.concat(n)}beforeIn({buffer:e,next:t,fail:n}){this._adBuf.put(e,{next:t,fail:n})}onReceiving(e,{fail:t}){if(null===this._decipherKey){const t=m.keySaltSize;if(e.length<t)return;const n=e.slice(0,t);return this._decipherKey=(0,s.HKDF)(p,n,m.evpKey,m.info,t),e.slice(t)}if(!(e.length<2*l+3)){var n=[e.slice(0,2),e.slice(2,2+l)];const r=n[0],a=n[1],o=this.decrypt(r,a);if(null===o)return t(`unexpected DataLen_TAG=${a.toString('hex')} when verify DataLen=${r.toString('hex')}, dump=${e.slice(0,60).toString('hex')}`),-1;const s=o.readUInt16BE(0);return s>c?(t(`invalid DataLen=${s} is over ${c}, dump=${e.slice(0,60).toString('hex')}`),-1):2+l+s+l}}onChunkReceived(e,{next:t,fail:n}){var r=[e.slice(2+l,-l),e.slice(-l)];const a=r[0],o=r[1],s=this.decrypt(a,o);return null===s?void n(`unexpected Data_TAG=${o.toString('hex')} when verify Data=${a.slice(0,60).toString('hex')}, dump=${e.slice(0,60).toString('hex')}`):void t(s)}encrypt(e){const t=o.default.createCipheriv(m.cipherName,this._cipherKey,(0,s.numberToBuffer)(this._cipherNonce,d,s.BYTE_ORDER_LE)),n=Buffer.concat([t.update(e),t.final()]),r=t.getAuthTag();return this._cipherNonce+=1,[n,r]}decrypt(e,t){const n=o.default.createDecipheriv(m.cipherName,this._decipherKey,(0,s.numberToBuffer)(this._decipherNonce,d,s.BYTE_ORDER_LE));n.setAuthTag(t);try{const t=Buffer.concat([n.update(e),n.final()]);return this._decipherNonce+=1,t}catch(e){return null}}}t.default=m,m.cipherName='',m.info=Buffer.from('ss-subkey'),m.keySaltSize=0,m.evpKey=null},function(e,t,n){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}function a(e){return s.default.isIPv4(e)?g:s.default.isIPv6(e)?_:h}Object.defineProperty(t,'__esModule',{value:!0});var o=n(4),s=r(o),i=n(2),d=r(i),l=n(10),c=r(l),u=n(16),p=n(1),m=n(0);const g=1,h=2,_=3,f=30,y=3,b={"aes-128-gcm":y,none:5};class k extends p.IPreset{static checkParams({id:e,security:t='aes-128-gcm'}){if(16!==Buffer.from(e.split('-').join(''),'hex').length)throw Error('id is not a valid uuid');const n=Object.keys(b);if(!n.includes(t))throw Error(`security must be one of ${n}`)}static onInit({id:e,security:t='aes-128-gcm'}){this.uuid=Buffer.from(e.split('-').join(''),'hex'),__IS_CLIENT__&&(this.security=b[t]),setInterval(()=>this.updateAuthCache(),1e3),this.updateAuthCache()}static updateAuthCache(){const e=this.userHashCache,t=(0,m.getCurrentTimestampInt)();let n=t-f;let r=[];if(0!==e.length){const a=e[e.length-1].timestamp;r=e.slice(t-a-f-1),n=a+1}for(let e=n;e<=t+f;++e){const t=this.uuid,n=(0,m.hmac)('md5',t,(0,m.numberToBuffer)(e,8));r.push({timestamp:e,authInfo:n})}this.userHashCache=r}constructor(){super(),this._atyp=null,this._host=null,this._port=null,this._isBroadCasting=!1,this._staging=Buffer.alloc(0),this._isHeaderSent=!1,this._isHeaderRecv=!1,this._v=null,this._opt=5,this._dataEncKey=null,this._dataEncIV=null,this._dataDecKey=null,this._dataDecIV=null,this._chunkLenEncMaskGenerator=null,this._chunkLenDecMaskGenerator=null,this._cipherNonce=0,this._decipherNonce=0,this._adBuf=new m.AdvancedBuffer({getPacketLength:this.onReceiving.bind(this)}),this._adBuf.on('data',this.onChunkReceived.bind(this))}onDestroy(){this._adBuf.clear(),this._adBuf=null,this._host=null,this._port=null,this._dataEncKey=null,this._dataEncIV=null,this._dataDecKey=null,this._dataDecIV=null,this._chunkLenEncMaskGenerator=null,this._chunkLenDecMaskGenerator=null}onNotified(e){if(__IS_CLIENT__&&e.type===p.CONNECT_TO_REMOTE){var t=e.payload;const n=t.host,r=t.port,o=a(n);this._atyp=o,this._port=(0,m.numberToBuffer)(r),this._host=o===h?Buffer.from(n):c.default.toBuffer(n)}e.type===p.CONNECTION_WILL_CLOSE&&this.next(u.MIDDLEWARE_DIRECTION_UPWARD,Buffer.alloc(2))}beforeOut({buffer:e}){if(!this._isHeaderSent){this._isHeaderSent=!0;const t=__IS_CLIENT__?this.createRequestHeader():this.createResponseHeader(),n=this.getBufferChunks(e);return Buffer.concat([t,...n])}else{const t=this.getBufferChunks(e);return Buffer.concat(t)}}clientIn({buffer:e,next:t,fail:n}){if(!this._isHeaderRecv){this._isHeaderRecv=!0;const r=d.default.createDecipheriv('aes-128-cfb',this._dataDecKey,this._dataDecIV),a=r.update(e.slice(0,4)),o=a[0],s=a[3];return this._v===o?this._adBuf.put(e.slice(4+s),{next:t,fail:n}):n(`server response v doesn't match, expect ${this._v} but got ${o}`)}this._adBuf.put(e,{next:t,fail:n})}serverIn({buffer:e,next:t,fail:n}){if(!this._isHeaderRecv){if(this._isBroadCasting)return void(this._staging=Buffer.concat([this._staging,e]));if(16>e.length)return n(`fail to parse request header: ${e.toString('hex')}`);const r=k.uuid,a=k.userHashCache,o=e.slice(0,16),s=a.find(({authInfo:e})=>e.equals(o));if(s===void 0)return n(`cannot find ${o.toString('hex')} in cache, maybe a wrong auth info`);const i=(0,m.numberToBuffer)(s.timestamp,8),l=d.default.createDecipheriv('aes-128-cfb',(0,m.hash)('md5',Buffer.concat([r,Buffer.from('c48619fe-8f02-49e0-b9e9-edf763e17e21')])),(0,m.hash)('md5',Buffer.concat([i,i,i,i]))),u=Buffer.from(e.slice(16));if(41>u.length)return n(`request command is too short: ${u.length}bytes, command=${u.toString('hex')}`);const y=l.update(u.slice(0,41)),b=y[0];if(1!==b)return n(`invalid version number: ${b}`);this._dataDecIV=y.slice(1,17),this._dataDecKey=y.slice(17,33),this._dataEncIV=(0,m.hash)('md5',this._dataDecIV),this._dataEncKey=(0,m.hash)('md5',this._dataDecKey),this._chunkLenDecMaskGenerator=(0,m.shake128)(this._dataDecIV),this._chunkLenEncMaskGenerator=(0,m.shake128)(this._dataEncIV),this._v=y[33],this._opt=y[34];const v=y[35]>>4,E=15&y[35],P=y[37];if(![1].includes(P))return n(`unsupported cmd: ${P}`);const S=y.readUInt16BE(38),x=y[40];let T=null,O=40;if(x===g){if(45>u.length)return n(`request command is too short ${u.length}bytes to get ipv4, command=${u.toString('hex')}`);T=l.update(u.slice(41,45)),O+=4}else if(x===_){if(57>u.length)return n(`request command is too short: ${u.length}bytes to get ipv6, command=${u.toString('hex')}`);T=l.update(u.slice(41,57)),O+=16}else if(x===h){if(42>u.length)return n(`request command is too short: ${u.length}bytes to get host name, command=${u.toString('hex')}`);const e=l.update(u.slice(41,42))[0];if(u.length<42+e)return n(`request command is too short: ${u.length}bytes, command=${u.toString('hex')}`);T=l.update(u.slice(42,42+e)),O+=1+e}else return n(`unknown address type: ${x}, command=${y.toString('hex')}`);if(u.length<O+v+4)return n(`request command is too short: ${u.length}bytes to get padding and f, command=${u.toString('hex')}`);const R=l.update(u.slice(O,O+v));O+=v;const C=l.update(u.slice(O,O+4)),f=Buffer.from([...y.slice(0,41),...(x===h?[T.length]:[]),...T,...R]);if((0,m.fnv1a)(f).equals(C))return n('fail to verify request command');const w=e.slice(16+f.length+4);k.security=E,this._isBroadCasting=!0,this.broadcast({type:p.CONNECT_TO_REMOTE,payload:{host:x===h?T.toString():c.default.toString(T),port:S,onConnected:()=>{this._adBuf.put(Buffer.concat([w,this._staging]),{next:t,fail:n}),this._isHeaderRecv=!0,this._isBroadCasting=!1,this._staging=null}}})}else this._adBuf.put(e,{next:t,fail:n})}createRequestHeader(){const e=d.default.randomBytes(33);this._dataEncIV=e.slice(0,16),this._dataEncKey=e.slice(16,32),this._dataDecKey=(0,m.hash)('md5',this._dataEncKey),this._dataDecIV=(0,m.hash)('md5',this._dataEncIV),this._chunkLenEncMaskGenerator=(0,m.shake128)(this._dataEncIV),this._chunkLenDecMaskGenerator=(0,m.shake128)(this._dataDecIV),this._v=e[32],this._opt=5;const t=k.userHashCache,n=k.uuid;var r=t[(0,m.getRandomInt)(0,t.length-1)];const a=r.timestamp,o=r.authInfo,s=(0,m.numberToBuffer)(a,8),i=(0,m.getRandomInt)(0,15),l=d.default.randomBytes(i);let c=Buffer.from([1,...this._dataEncIV,...this._dataEncKey,this._v,this._opt,i<<4|k.security,0,1,...this._port,this._atyp,...Buffer.concat([this._atyp===h?(0,m.numberToBuffer)(this._host.length,1):Buffer.alloc(0),this._host]),...l]);c=Buffer.concat([c,(0,m.fnv1a)(c)]);const u=d.default.createCipheriv('aes-128-cfb',(0,m.hash)('md5',Buffer.concat([n,Buffer.from('c48619fe-8f02-49e0-b9e9-edf763e17e21')])),(0,m.hash)('md5',Buffer.concat([s,s,s,s])));return c=u.update(c),Buffer.concat([o,c])}createResponseHeader(){const e=d.default.createCipheriv('aes-128-cfb',this._dataEncKey,this._dataEncIV);return e.update(Buffer.from([this._v,1,0,0]))}getBufferChunks(e){return(0,m.getChunks)(e,16383).map((e)=>{let t=e;k.security===y&&(t=Buffer.concat(this.encrypt(t)));let n=t.length;if(5===this._opt){const e=this._chunkLenEncMaskGenerator.nextBytes(2).readUInt16BE(0);n=e^n}return Buffer.concat([(0,m.numberToBuffer)(n),t])})}onReceiving(e){let t=e.readUInt16BE(0);if(5===this._opt){const e=this._chunkLenDecMaskGenerator.nextBytes(2).readUInt16BE(0);t=e^t}return 2+t}onChunkReceived(e,{next:t,fail:n}){if(k.security===y){const r=e.slice(-16),a=this.decrypt(e.slice(2,-16),r);return null===a?n(`fail to verify data chunk, dump=${e.slice(0,60).toString('hex')}`):t(a)}return t(e.slice(2))}encrypt(e){const t=Buffer.concat([(0,m.numberToBuffer)(this._cipherNonce),this._dataEncIV.slice(2,12)]),n=d.default.createCipheriv('aes-128-gcm',this._dataEncKey,t),r=Buffer.concat([n.update(e),n.final()]),a=n.getAuthTag();return this._cipherNonce+=1,[r,a]}decrypt(e,t){const n=Buffer.concat([(0,m.numberToBuffer)(this._decipherNonce),this._dataDecIV.slice(2,12)]),r=d.default.createDecipheriv('aes-128-gcm',this._dataDecKey,n);r.setAuthTag(t);try{const t=Buffer.concat([r.update(e),r.final()]);return this._decipherNonce+=1,t}catch(e){return null}}}t.default=k,k.uuid=null,k.security=null,k.userHashCache=[]},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(2),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=n(1),s=n(0);class i extends o.IPreset{constructor(){super(),this._adBuf=null,this._adBuf=new s.AdvancedBuffer({getPacketLength:this.onReceiving.bind(this)}),this._adBuf.on('data',this.onChunkReceived.bind(this))}onDestroy(){this._adBuf.clear(),this._adBuf=null}beforeOut({buffer:e}){const t=(0,s.getRandomChunks)(e,0,65535).map((e)=>{const t=(0,s.getRandomInt)(0,255),n=a.default.randomBytes(t);return Buffer.concat([(0,s.numberToBuffer)(t,1),n,(0,s.numberToBuffer)(e.length),e])});return Buffer.concat(t)}beforeIn({buffer:e,next:t}){this._adBuf.put(e,{next:t})}onReceiving(e){if(!(3>e.length)){const t=e[0];if(!(e.length<1+t+2)){const n=e.readUInt16BE(1+t);return e.length<1+t+2+n?void 0:1+t+2+n}}}onChunkReceived(e,{next:t}){const n=e[0];t(e.slice(1+n+2))}}t.default=i},function(e,t,n){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var a=n(3),o=r(a),s=n(31),i=r(s),d=n(2),l=r(d),c=n(1);class u{static _parse(e,t){if(0<this._fakes.length)return void t(this._fakes);const n=[];let r='';const a=i.default.createInterface({input:o.default.createReadStream(e)});a.on('line',function(e){switch(e[0]){case'=':case'-':''!=r&&(r+='\r\n',n.push(r),r='');break;default:r+=e,r+='\r\n';}}),a.on('close',()=>{for(let e=0;e<n.length;e+=2){const t=n[e],r=n[e+1];this._fakes.push({request:Buffer.from(t),response:Buffer.from(r)})}t(this._fakes)})}static get(e,t){this._parse(e,t)}}u._fakes=[];class p extends c.IPreset{static checkParams({file:e}){if('string'!=typeof e||''===e)throw Error('\'file\' must be a non-empty string')}constructor({file:e}){super(),this._isHandshakeDone=!1,this._file=null,this._response=null,this._file=e}clientOut({buffer:e,next:t}){return this._isHandshakeDone?e:void u.get(this._file,(n)=>{const r=l.default.randomBytes(1)[0]%n.length,a=n[r].request;t(Buffer.concat([a,e]))})}serverIn({buffer:e,next:t,fail:n}){return this._isHandshakeDone?e:void u.get(this._file,(r)=>{const a=r.find(({request:t})=>0===e.indexOf(t));'undefined'==typeof a?n('http header mismatch'):(this._response=a.response,t(e.slice(a.request.length)))})}serverOut({buffer:e}){return this._isHandshakeDone?e:(this._isHandshakeDone=!0,Buffer.concat([this._response,e]))}clientIn({buffer:e,next:t,fail:n}){return this._isHandshakeDone?e:void(u.get(this._file,(r)=>{const a=r.find(({response:t})=>0===e.indexOf(t));'undefined'==typeof a?n('http header mismatch'):t(e.slice(a.response.length))}),this._isHandshakeDone=!0)}}t.default=p},function(e,t,n){'use strict';function r(e){return Buffer.from(e,'hex')}function a(){return(0,d.numberToBuffer)((0,d.getCurrentTimestampInt)(),4)}function o(e){const t=(0,d.numberToBuffer)(e.length);return Buffer.concat([r('170303'),t,e])}Object.defineProperty(t,'__esModule',{value:!0});var s=n(2),i=function(e){return e&&e.__esModule?e:{default:e}}(s),d=n(0),l=n(1);const c=1,u=2,p=3,m=2048,g=16383;class f extends l.IPreset{static checkParams({sni:e}){if('undefined'==typeof e)throw Error('\'sni\' must be set');if(Array.isArray(e)||(e=[e]),e.some((e)=>'string'!=typeof e||1>e.length))throw Error('\'sni\' must be a non-empty string or an array without empty strings')}constructor({sni:e}){super(),this._sni=[],this._stage=c,this._staging=Buffer.alloc(0),this._adBuf=null,this.onReceiving=this.onReceiving.bind(this),this.onChunkReceived=this.onChunkReceived.bind(this),this._sni=Array.isArray(e)?e:[e],this._adBuf=new d.AdvancedBuffer({getPacketLength:this.onReceiving}),this._adBuf.on('data',this.onChunkReceived)}onDestroy(){this._adBuf.clear(),this._adBuf=null,this._staging=null,this._sni=null}getRandomSNI(){const e=i.default.randomBytes(1)[0]%this._sni.length;return Buffer.from(this._sni[e])}clientOut({buffer:e,next:t}){if(this._stage===c){this._stage=u,this._staging=e;const n=this.getRandomSNI(),o=[...a(),...i.default.randomBytes(28)],s=[...r('20'),...i.default.randomBytes(32)],l=[...r('001a'),...r('c02b'),...r('c02f'),...r('c02c'),...r('c030'),...r('cc14'),...r('cc13'),...r('c013'),...r('c014'),...r('009c'),...r('009d'),...r('002f'),...r('0035'),...r('000a')],c=[...r('0000'),...(0,d.numberToBuffer)(5+n.length),...(0,d.numberToBuffer)(3+n.length),...r('00'),...(0,d.numberToBuffer)(n.length),...n],p=(0,d.getRandomInt)(200,400),m=[...r('0023'),...(0,d.numberToBuffer)(p),...i.default.randomBytes(p)],g=[...r('ff01000100'),...c,...r('00170000'),...m,...r('000d00140012040308040401050308050501080606010201'),...r('000500050100000000'),...r('00120000'),...r('75500000'),...r('000b00020100'),...r('000a0006000400170018')],f=[...r('0303'),...o,...s,...l,...r('01'),...r('00'),...(0,d.numberToBuffer)(g.length),...g],h=[...r('16'),...r('0301'),...(0,d.numberToBuffer)(4+f.length),...r('01'),...(0,d.numberToBuffer)(f.length,3)];return t(Buffer.from([...h,...f]))}if(this._stage===u&&(this._staging=Buffer.concat([this._staging,e])),this._stage===p){const t=(0,d.getRandomChunks)(e,m,g).map((e)=>o(e));return Buffer.concat(t)}}serverIn({buffer:e,next:t,fail:n}){if(this._stage===c){if(this._stage=u,200>e.length)return void n(`TLS handshake header is too short, length=${e.length} dump=${e.slice(0,100).toString('hex')}`);if(!e.slice(0,3).equals(r('160301')))return void n(`invalid TLS handshake header=${e.slice(0,3).toString('hex')}, want=160301, dump=${e.slice(0,100).toString('hex')}`);const o=e.slice(3,5).readUInt16BE(0);if(o!==e.length-5)return void n(`unexpected TLS handshake body length=${e.length-5}, want=${o}, dump=${e.slice(0,100).toString('hex')}`);const s=[...a(),...i.default.randomBytes(28)],l=[...r('20'),...i.default.randomBytes(32)],c=[...r('ff01000100'),...r('00050000'),...r('00170000')],p=[...r('0303'),...s,...l,...r('c02f'),...r('00'),...(0,d.numberToBuffer)(c.length),...c],m=[...r('16'),...r('0303'),...(0,d.numberToBuffer)(4+p.length),...r('02'),...(0,d.numberToBuffer)(p.length,3)],g=[...m,...p],f=i.default.randomBytes((0,d.getRandomInt)(200,255)),h=[...r('000004b0'),...(0,d.numberToBuffer)(f.length),...f],_=[...r('04'),...(0,d.numberToBuffer)(h.length,3),...h],y=[...r('160303'),...(0,d.numberToBuffer)(_.length),..._],b=[...r('140303000101')],k=(0,d.getRandomInt)(32,40),v=[...r('16'),...r('0303'),...(0,d.numberToBuffer)(k),...i.default.randomBytes(k)];return t(Buffer.from([...g,...y,...b,...v]),!0)}let o=e;this._stage===u&&(this._stage=p,o=e.slice(43)),this._adBuf.put(o,{next:t,fail:n})}serverOut({buffer:e}){const t=(0,d.getRandomChunks)(e,m,g).map((e)=>o(e));return Buffer.concat(t)}clientIn({buffer:e,next:t,fail:n}){if(this._stage===u){this._stage=p;const e=[...r('140303000101')],n=[...r('16'),...r('0303'),...r('0020'),...i.default.randomBytes(32)],a=(0,d.getRandomChunks)(this._staging,m,g).map((e)=>o(e));return this._staging=null,t(Buffer.from([...e,...n,...Buffer.concat(a)]),!0)}this._adBuf.put(e,{next:t,fail:n})}onReceiving(e){return 5>e.length?void 0:5+e.readUInt16BE(3)}onChunkReceived(e,{next:t}){t(e.slice(5))}}t.default=f},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(18),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=n(0),s=n(1);const i={gzip:[a.default.createGzip,a.default.createGunzip],deflate:[a.default.createDeflate,a.default.createInflate]},d={flush:a.default.Z_PARTIAL_FLUSH};class l extends s.IPreset{static checkParams({method:e}){const t=Object.keys(i);if(!t.includes(e))throw Error(`'method' must be one of [${t}]`)}constructor({method:e}){super(),this._method='',this._compressor=null,this._decompressor=null,this._outBytesA=0,this._outBytesB=0,this._inBytesA=0,this._inBytesB=0,this._method=e}onNotified(e){e.type===s.CONNECTION_CLOSED&&(o.logger.debug(`compression ratio: ${this._outBytesB/this._outBytesA}`),o.logger.debug(`decompression ratio: ${this._inBytesB/this._inBytesA}`))}beforeOut({buffer:e,next:t,fail:n}){null===this._compressor&&(this._compressor=i[this._method][0](d),this._compressor.on('error',(e)=>n(e.message)),this._compressor.on('data',(e)=>{this._outBytesB+=e.length,t(e)})),this._compressor.write(e),this._outBytesA+=e.length}beforeIn({buffer:e,next:t,fail:n}){null===this._decompressor&&(this._decompressor=i[this._method][1](d),this._decompressor.on('error',(e)=>n(e.message)),this._decompressor.on('data',(e)=>{this._inBytesB+=e.length,t(e)})),this._decompressor.write(e),this._inBytesA+=e.length}}t.default=l},function(e,t,n){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var a=n(4),o=r(a),s=n(10),i=r(s),d=n(0),l=n(1);class c extends l.IPreset{constructor(...e){var t;return t=super(...e),this._isHandshakeDone=!1,this._isBroadCasting=!1,this._staging=Buffer.alloc(0),this._host=null,this._port=null,t}static checkParams({salt:e}){if('string'!=typeof e||''===e)throw Error('\'salt\' must be a non-empty string')}static onInit({salt:e}){this.padding=(0,d.hash)('sha256',e).slice(0,15)}onDestroy(){this._staging=null,this._host=null,this._port=null}onNotified(e){if(__IS_CLIENT__&&e.type===l.CONNECT_TO_REMOTE){var t=e.payload;const n=t.host,r=t.port;this._host=Buffer.from(n),this._port=(0,d.numberToBuffer)(r)}}clientOut({buffer:e}){return this._isHandshakeDone?e:(this._isHandshakeDone=!0,Buffer.concat([(0,d.numberToBuffer)(this._host.length,1),c.padding,this._host,this._port,e]))}serverIn({buffer:e,next:t,broadcast:n,fail:r}){if(!this._isHandshakeDone){if(this._isBroadCasting)return void(this._staging=Buffer.concat([this._staging,e]));if(20>e.length)return r(`unexpected buffer length: ${e.length}, buffer=${e.toString('hex')}`);if(!e.slice(1,16).equals(c.padding))return r(`unexpected padding=${c.padding.toString('hex')}`);const a=e[0];if(e.length<=a+18)return r(`unexpected buffer length: ${e.length}, buffer=${e.toString('hex')}`);let s=e.slice(16,16+a);if((0,d.isValidHostname)(s.toString()))s=s.toString();else if(o.default.isIP(s))s=i.default.toString(s);else return r(`invalid addr: (${s.toString()})`);const u=e.slice(a+16,a+18).readUInt16BE(0),p=e.slice(a+18);this._isBroadCasting=!0,n({type:l.CONNECT_TO_REMOTE,payload:{host:s,port:u,onConnected:()=>{t(Buffer.concat([p,this._staging])),this._isHandshakeDone=!0,this._isBroadCasting=!1,this._staging=null}}})}else return e}}t.default=c,c.padding=null},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=n(2),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=n(0),s=n(1);const i=16,d=16,l=['aes-128-ctr','aes-192-ctr','aes-256-ctr','aes-128-cfb','aes-192-cfb','aes-256-cfb','camellia-128-cfb','camellia-192-cfb','camellia-256-cfb'];class c extends s.IPreset{constructor(...e){var t;return t=super(...e),this._isHandshakeDone=!1,this._isBroadCasting=!1,this._staging=Buffer.alloc(0),this._host=null,this._port=null,this._cipher=null,this._decipher=null,t}static checkParams({method:e}){if(!l.includes(e))throw Error(`'method' must be one of [${l}]`)}static onInit({method:e}){this.cipherName=e,this.key=(0,o.EVP_BytesToKey)(__KEY__,e.split('-')[1]/8,i)}onDestroy(){this._staging=null,this._host=null,this._port=null,this._cipher=null,this._decipher=null}onNotified(e){if(__IS_CLIENT__&&e.type===s.CONNECT_TO_REMOTE){var t=e.payload;const n=t.host,r=t.port;this._host=Buffer.from(n),this._port=(0,o.numberToBuffer)(r)}}clientOut({buffer:e}){if(!this._isHandshakeDone){this._isHandshakeDone=!0;const t=a.default.randomBytes(i),n=c.key,r=(0,o.xor)(t,n.slice(0,i));this._cipher=a.default.createCipheriv(c.cipherName,n,t),this._decipher=a.default.createDecipheriv(c.cipherName,n,t);const s=this.encrypt(Buffer.concat([(0,o.numberToBuffer)(this._host.length,1),this._host,this._port,e])),l=(0,o.hmac)('sha1',r,s.slice(0,-e.length)).slice(0,d);return Buffer.concat([t,l,s])}return this.encrypt(e)}serverIn({buffer:e,next:t,broadcast:n,fail:r}){if(!this._isHandshakeDone){if(this._isBroadCasting)return void(this._staging=Buffer.concat([this._staging,e]));if(37>e.length)return r(`unexpected buffer length_1: ${e.length}, buffer=${e.toString('hex')}`);const l=e.slice(0,i),u=c.key;this._cipher=a.default.createCipheriv(c.cipherName,u,l),this._decipher=a.default.createDecipheriv(c.cipherName,u,l);const p=this.decrypt(e.slice(32)),m=e.slice(16,32),g=p[0];if(e.length<=35+g)return r(`unexpected buffer length_2: ${e.length}, buffer=${e.toString('hex')}`);const f=(0,o.xor)(l,u.slice(0,i)),h=(0,o.hmac)('sha1',f,e.slice(32,35+g)).slice(0,d);if(!h.equals(m))return r(`unexpected HMAC-SHA1=${m.toString('hex')} want=${h.toString('hex')}`);const _=p.slice(1,g+1).toString(),y=p.slice(g+1,g+3).readUInt16BE(0),b=p.slice(g+3);this._isBroadCasting=!0,n({type:s.CONNECT_TO_REMOTE,payload:{host:_,port:y,onConnected:()=>{t(Buffer.concat([b,this._staging])),this._isHandshakeDone=!0,this._isBroadCasting=!1,this._staging=null}}})}else return this.decrypt(e)}serverOut({buffer:e}){return this.encrypt(e)}clientIn({buffer:e}){return this.decrypt(e)}encrypt(e){return this._cipher.update(e)}decrypt(e){return this._decipher.update(e)}}t.default=c,c.cipherName='',c.key=null},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=function(){function e(e,t){var n=[],r=!0,a=!1,o;try{for(var s=e[Symbol.iterator](),i;!(r=(i=s.next()).done)&&(n.push(i.value),!(t&&n.length===t));r=!0);}catch(e){a=!0,o=e}finally{try{!r&&s['return']&&s['return']()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),a=n(2),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=n(0),i=n(1);const d=12,l=16,c=16383,u='bs-subkey',p=2,m={"aes-128-gcm":16,"aes-192-gcm":24,"aes-256-gcm":32},g='sha1';class f extends i.IPreset{static checkParams({method:e,info:t=u,factor:n=p}){if(e===void 0||''===e)throw Error('\'method\' must be set');const r=Object.keys(m);if(!r.includes(e))throw Error(`'method' must be one of [${r}]`);if('string'!=typeof t||0>=t.length)throw Error('\'info\' must be a non-empty string');if(!Number.isInteger(n))throw Error('\'factor\' must be an integer');if(1>n||10<n)throw Error('\'factor\' must be in [1, 10]')}static onInit({method:e,info:t=u,factor:n=p}){this.cipherName=e,this.info=Buffer.from(t),this.factor=n,this.rawKey=Buffer.from(__KEY__),this.keySaltSize=m[e]}constructor(){super(),this._cipherKey=null,this._decipherKey=null,this._cipherNonce=0,this._decipherNonce=0,this._nextExpectDecipherNonce=0,this._adBuf=null,this._adBuf=new s.AdvancedBuffer({getPacketLength:this.onReceiving.bind(this)}),this._adBuf.on('data',this.onChunkReceived.bind(this))}onDestroy(){this._adBuf.clear(),this._adBuf=null,this._cipherKey=null,this._decipherKey=null,this._cipherNonce=0,this._decipherNonce=0,this._nextExpectDecipherNonce=0}beforeOut({buffer:e}){let t=null;if(null===this._cipherKey){const e=f.keySaltSize;t=o.default.randomBytes(e),this._cipherKey=(0,s.HKDF)(g,t,f.rawKey,f.info,e)}const n=(0,s.getRandomChunks)(e,2048,c).map((e)=>{const t=this.getPaddingLength(this._cipherKey,this._cipherNonce),n=o.default.randomBytes(t),a=(0,s.numberToBuffer)(e.length);var i=this.encrypt(a),d=r(i,2);const l=d[0],c=d[1];var u=this.encrypt(e),p=r(u,2);const m=p[0],g=p[1];return Buffer.concat([n,l,c,m,g])});return t?Buffer.concat([t,...n]):Buffer.concat(n)}beforeIn({buffer:e,next:t,fail:n}){this._adBuf.put(e,{next:t,fail:n})}onReceiving(e,{fail:t}){if(null===this._decipherKey){const t=f.keySaltSize;if(e.length<t)return;const n=e.slice(0,t);return this._decipherKey=(0,s.HKDF)(g,n,f.rawKey,f.info,t),e.slice(t)}if(this._decipherNonce===this._nextExpectDecipherNonce){const t=this.getPaddingLength(this._decipherKey,this._decipherNonce);return e.length<t?void 0:(this._nextExpectDecipherNonce+=2,e.slice(t))}if(!(e.length<2*l+3)){var n=[e.slice(0,2),e.slice(2,2+l)];const r=n[0],a=n[1],o=this.decrypt(r,a);if(null===o)return t(`unexpected DataLen_TAG=${a.toString('hex')} when verify DataLen=${r.toString('hex')}, dump=${e.slice(0,60).toString('hex')}`),-1;const s=o.readUInt16BE(0);return s>c?(t(`invalid DataLen=${s} is over ${c}, dump=${e.slice(0,60).toString('hex')}`),-1):2+l+s+l}}onChunkReceived(e,{next:t,fail:n}){var r=[e.slice(2+l,-l),e.slice(-l)];const a=r[0],o=r[1],s=this.decrypt(a,o);return null===s?void n(`unexpected Data_TAG=${o.toString('hex')} when verify Data=${a.slice(0,60).toString('hex')}, dump=${e.slice(0,60).toString('hex')}`):void t(s)}getPaddingLength(e,t){const n=(0,s.numberToBuffer)(t,d,s.BYTE_ORDER_LE),r=o.default.createCipheriv(f.cipherName,e,n);return r.update(n),r.final(),r.getAuthTag()[0]*f.factor}encrypt(e){const t=o.default.createCipheriv(f.cipherName,this._cipherKey,(0,s.numberToBuffer)(this._cipherNonce,d,s.BYTE_ORDER_LE)),n=Buffer.concat([t.update(e),t.final()]),r=t.getAuthTag();return this._cipherNonce+=1,[n,r]}decrypt(e,t){const n=o.default.createDecipheriv(f.cipherName,this._decipherKey,(0,s.numberToBuffer)(this._decipherNonce,d,s.BYTE_ORDER_LE));n.setAuthTag(t);try{const t=Buffer.concat([n.update(e),n.final()]);return this._decipherNonce+=1,t}catch(e){return null}}}t.default=f,f.cipherName='',f.info=null,f.factor=p,f.rawKey=null,f.keySaltSize=0},function(e,t,n){'use strict';var r=n(3),a=n(9),o=n(8),s=n(11),i=n(12).Transport,d=n(13).Stream,l=n(7),c=n(12),u=n(120),p=n(18),m=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],g=e.exports=function(e){function t(t){Array.prototype.slice.call(arguments,1).forEach(function(n){if(e[n])throw new Error('Cannot set '+n+' and '+t+'together')})}if(i.call(this,e),e.filename||e.dirname)t('filename or dirname','stream'),this._basename=this.filename=e.filename?a.basename(e.filename):'winston.log',this.dirname=e.dirname||a.dirname(e.filename),this.options=e.options||{flags:'a'},this.options.highWaterMark=this.options.highWaterMark||24;else if(e.stream){t('stream','filename','maxsize'),this._stream=e.stream;var n=this;this._stream.on('error',function(e){n.emit('error',e)}),this._stream.setMaxListeners(Infinity)}else throw new Error('Cannot log to file without filename or stream.');this.json=!1!==e.json,this.colorize=e.colorize||!1,this.maxsize=e.maxsize||null,this.logstash=e.logstash||null,this.maxFiles=e.maxFiles||null,this.label=e.label||null,this.prettyPrint=e.prettyPrint||!1,this.showLevel=void 0===e.showLevel||e.showLevel,this.timestamp=void 0===e.timestamp||e.timestamp,this.datePattern=e.datePattern?e.datePattern:'.yyyy-MM-dd',this.depth=e.depth||null,this.eol=e.eol||l.EOL,this.maxRetries=e.maxRetries||2,this.prepend=e.prepend||!1,this.createTree=e.createTree||!1,this.localTime=e.localTime||!1,this.zippedArchive=e.zippedArchive||!1,this.maxDays=e.maxDays||0,this.json&&(this.stringify=e.stringify),this._size=0,this._created=0,this._buffer=[],this._draining=!1,this._failures=0,this._archive=!1,this._currentFiles=function(){if(!this.maxsize)try{return r.readdirSync(this.dirname).filter(function(e){return e.includes(this._basename)}.bind(this)).map(function(e){return{name:e,time:r.statSync(a.join(this.dirname,e)).mtime.getTime()}}.bind(this)).sort(function(e,t){return e.time-t.time}).map(function(e){return e.name})}catch(t){}return[]}.bind(this)(),this._year=this._getTime('year'),this._month=this._getTime('month'),this._date=this._getTime('date'),this._hour=this._getTime('hour'),this._minute=this._getTime('minute'),this._weekday=m[this._getTime('day')];var o=/d{1,4}|m{1,4}|yy(?:yy)?|([HhM])\1?/g,s=function(e,t){for(e+='',t=t||2;e.length<t;)e='0'+e;return e};this.getFormattedDate=function(){this._year=this._getTime('year'),this._month=this._getTime('month'),this._date=this._getTime('date'),this._hour=this._getTime('hour'),this._minute=this._getTime('minute'),this._weekday=m[this._getTime('day')];var e={yy:(this._year+'').slice(2),yyyy:this._year,M:this._month+1,MM:s(this._month+1),d:this._date,dd:s(this._date),H:this._hour,HH:s(this._hour),m:this._minute,mm:s(this._minute),ddd:this._weekday};return this.datePattern.replace(o,function(t){return t in e?e[t]:t.slice(1,t.length-1)})}};o.inherits(g,i),c.transports.DailyRotateFile=g,g.prototype.name='dailyRotateFile',g.prototype.log=function(e,t,n,r){if(this.silent)return r(null,!0);if(this._failures>=this.maxRetries)return r(new Error('Transport is in a failed state.'));var a=this,o=s.log({level:e,message:t,meta:n,json:this.json,colorize:this.colorize,logstash:this.logstash,prettyPrint:this.prettyPrint,timestamp:this.timestamp,label:this.label,stringify:this.stringify,showLevel:this.showLevel,depth:this.depth,formatter:this.formatter,humanReadableUnhandledException:this.humanReadableUnhandledException})+this.eol;this._size+=o.length,this.filename?this.open(function(e){return e?a._buffer.push([o,r]):void(a._write(o,r),a._lazyDrain())}):(this._write(o,r),this._lazyDrain())},g.prototype._write=function(e,t){var n=this._stream.write(e);return t?!1===n?this._stream.once('drain',function(){t(null,!0)}):void t(null,!0):void 0},g.prototype.query=function(e,t){'function'==typeof e&&(t=e,e={});var n=this,o=n._currentFiles,s=[],d=0;e=n.normalizeQuery(e),function i(l){function c(e,t){try{var n=JSON.parse(e);p(n)&&u(n)}catch(n){t||f.emit('error',n)}}function u(t){if(e.rows&&s.length>=e.rows)return void(f.readable&&f.destroy());if(e.fields){var n={};e.fields.forEach(function(e){n[e]=t[e]}),t=n}s.push(t)}function p(t){if(t&&'object'==typeof t){var n=new Date(t.timestamp);return e.from&&n<e.from||e.until&&n>e.until?void 0:!0}}if(l){var m=a.join(n.dirname,l),g='',f=r.createReadStream(m,{encoding:'utf8'});f.on('error',function(e){return f.readable&&f.destroy(),t?'ENOENT'===e.code?t(null,s):t(e):void 0}),f.on('data',function(t){t=(g+t).split(/\n+/);for(var n=t.length-1,r=0;r<n;r++)(!e.start||d>=e.start)&&c(t[r]),d++;g=t[n]}),f.on('close',function(){g&&c(g,!0),'desc'===e.order&&(s=s.reverse()),o.length?i(o.shift()):t&&t(null,s)})}}(o.shift())},g.prototype.stream=function(e){var t=a.join(this.dirname,this._getFilename());e=e||{};var n=new d,r={file:t,start:e.start};return n.destroy=s.tailFile(r,function(e,t){if(e)return n.emit('error',e);try{n.emit('data',t),t=JSON.parse(t),n.emit('log',t)}catch(t){n.emit('error',t)}}),n.resume&&n.resume(),n},g.prototype.open=function(e){if(this.opening)return e(!0);return!this._stream||this.maxsize&&this._size>=this.maxsize||this._filenameHasExpired()?(this._cleanOldFiles(),e(!0),this._createStream()):void e()},g.prototype.close=function(){var e=this;this._stream&&(this._stream.end(),this._stream.destroySoon(),this._stream.once('drain',function(){e.emit('flush'),e.emit('closed')}))},g.prototype.flush=function(){var e=this;this._buffer.forEach(function(t){var n=t[0],r=t[1];process.nextTick(function(){e._write(n,r),e._size+=n.length})}),e._buffer.length=0,e._stream.once('drain',function(){e.emit('flush'),e.emit('logged')})},g.prototype._createStream=function(){var e=this;this.opening=!0,function t(n){function o(t){e._stream&&(e._archive=!!e.zippedArchive&&e._stream.path,e._stream.end(),e._stream.destroySoon()),e.createTree&&u.sync(a.dirname(i)),e._size=t,e.filename=n,e._stream=r.createWriteStream(i,e.options),e._stream.on('error',function(t){e._failures<e.maxRetries?(e._createStream(),e._failures++):e.emit('error',t)}),e._stream.setMaxListeners(Infinity),e.once('flush',function(){e.flush(),e.opening=!1,e.emit('open',i)}),e.flush(),s()}function s(){var t=e._archive;if(e._archive=!1,t&&r.existsSync(t+'')){var n=p.createGzip(),a=r.createReadStream(t+''),o=r.createWriteStream(t+'.gz');a.pipe(n).pipe(o),r.unlinkSync(t+'')}}var i=a.join(e.dirname,n);r.stat(i,function(n,r){return n?'ENOENT'===n.code?o(0):e.emit('error',n):!r||e.maxsize&&r.size>=e.maxsize?t(e._getFile(!0)):e._filenameHasExpired()?(e._year=e._getTime('year'),e._month=e._getTime('month'),e._date=e._getTime('date'),e._hour=e._getTime('hour'),e._minute=e._getTime('minute'),e._weekday=m[e._getTime('day')],e._created=0,t(e._getFile())):void o(r.size)})}(this._getFile())},g.prototype._getFile=function(e){var t=this._getFilename(),n;if(e){if(this.maxFiles&&this._created>=this.maxFiles-1)if(n=this._created-(this.maxFiles-1),0===n)try{r.unlinkSync(a.join(this.dirname,t))}catch(t){}else try{r.unlinkSync(a.join(this.dirname,t+'.'+n))}catch(t){}this._created+=1}else if(!this.maxsize)for(-1===this._currentFiles.indexOf(t)&&this._currentFiles.push(t);this.maxFiles&&this._currentFiles.length>this.maxFiles;){try{r.unlinkSync(a.join(this.dirname,this._currentFiles[0]))}catch(t){}this._currentFiles=this._currentFiles.slice(1)}return this._created?t+'.'+this._created:t},g.prototype._getFilename=function(){var e=this.getFormattedDate();return this.prepend?('.yyyy-MM-dd'===this.datePattern&&(this.datePattern='yyyy-MM-dd.',e=this.getFormattedDate()),e+this._basename):this._basename+e},g.prototype._lazyDrain=function(){var e=this;!this._draining&&this._stream&&(this._draining=!0,this._stream.once('drain',function(){this._draining=!1,e.emit('logged')}))},g.prototype._filenameHasExpired=function(){if(this.datePattern.match(/m/))return this._year<this._getTime('year')||this._month<this._getTime('month')||this._date<this._getTime('date')||this._hour<this._getTime('hour')||this._minute<this._getTime('minute');return this.datePattern.match(/H/)?this._year<this._getTime('year')||this._month<this._getTime('month')||this._date<this._getTime('date')||this._hour<this._getTime('hour'):this.datePattern.match(/d/)?this._year<this._getTime('year')||this._month<this._getTime('month')||this._date<this._getTime('date'):this.datePattern.match(/M/)?this._year<this._getTime('year')||this._month<this._getTime('month'):!!this.datePattern.match(/yy/)&&this._year<this._getTime('year')},g.prototype._getTime=function(e){var t=new Date;if(this.localTime){if('year'===e)return t.getFullYear();if('month'===e)return t.getMonth();if('date'===e)return t.getDate();if('hour'===e)return t.getHours();if('minute'===e)return t.getMinutes();if('day'===e)return t.getDay()}return'year'===e?t.getUTCFullYear():'month'===e?t.getUTCMonth():'date'===e?t.getUTCDate():'hour'===e?t.getUTCHours():'minute'===e?t.getUTCMinutes():'day'===e?t.getUTCDay():void 0},g.prototype._cleanOldFiles=function(){function e(e){r.unlink(n.dirname+a.sep+e,function(t){t&&console.error('Error removing file ',e)})}function t(t){var i=n.dirname+a.sep+t;r.stat(i,function(r,a){if(r)return void console.error('Error stats file ',t,r);var i=a.mtime&&a.mtime.getTime()||0;a.isFile()&&s-i>o*n.maxDays&&e(t)})}var n=this,o=8.64e7,s=Date.now();n.maxDays&&r.readdir(n.dirname,function(e,r){if(e)return void console.error('Error reading directory ',n.dirname,e);var a=new RegExp(n._basename,'g');r.forEach(function(e){/.log/.test(e)&&a.test(e)&&t(e)})})}},function(e,t,n){'use strict';function r(e,t,n,i){'function'==typeof t?(n=t,t={}):(!t||'object'!=typeof t)&&(t={mode:t});var d=t.mode,l=t.fs||o;d===void 0&&(d=s&~process.umask()),i||(i=null);var c=n||function(){};e=a.resolve(e),l.mkdir(e,d,function(n){if(!n)return i=i||e,c(null,i);switch(n.code){case'ENOENT':r(a.dirname(e),t,function(n,a){n?c(n,a):r(e,t,c,a)});break;default:l.stat(e,function(e,t){e||!t.isDirectory()?c(n,i):c(null,i)});}})}var a=n(9),o=n(3),s=parseInt('0777',8);e.exports=r.mkdirp=r.mkdirP=r,r.sync=function e(t,n,r){n&&'object'==typeof n||(n={mode:n});var i=n.mode,d=n.fs||o;i===void 0&&(i=s&~process.umask()),r||(r=null),t=a.resolve(t);try{d.mkdirSync(t,i),r=r||t}catch(o){switch(o.code){case'ENOENT':r=e(a.dirname(t),n,r),e(t,n,r);break;default:var l;try{l=d.statSync(t)}catch(e){throw o}if(!l.isDirectory())throw o;}}return r}},function(e,t,n){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(a,o){try{var s=t[a](o),i=s.value}catch(e){return void n(e)}return s.done?void e(i):Promise.resolve(i).then(function(e){r('next',e)},function(e){r('throw',e)})}return r('next')})}}Object.defineProperty(t,'__esModule',{value:!0}),t.Hub=void 0;var o=n(22),s=r(o),i=n(6),d=r(i),l=n(4),c=r(l),u=n(33),p=r(u),m=n(122),g=r(m),f=n(23),h=n(29),_=n(123),y=n(16),b=n(0);class k extends d.default{constructor(e){super(),this._isFirstWorker=!s.default.worker||1>=s.default.worker.id,this._localServer=null,this._fastestServer=null,this._relays=[],this.onConnect=this.onConnect.bind(this),this.onClose=this.onClose.bind(this),e!==void 0&&h.Config.init(e),this._isFirstWorker&&(b.logger.info(`==> [hub] use configuration: ${JSON.stringify(__ALL_CONFIG__)}`),b.logger.info(`==> [hub] running as: ${__IS_SERVER__?'server':'client'}`)),__IS_CLIENT__&&(this._isFirstWorker&&b.logger.info('==> [balancer] started'),f.Balancer.start(__SERVERS__))}run(){var e=this;return a(function*(){const t={host:__LOCAL_HOST__,port:__LOCAL_PORT__};return e._localServer=e.createServer(),e._localServer.on('close',e.onClose),new Promise(function(n){return e._localServer.listen(t,n)})})()}terminate(){this.onClose()}createServer(){if(__IS_SERVER__&&__IS_TLS__){const e=p.default.createServer({key:[__TLS_KEY__],cert:[__TLS_CERT__]});return e.on('secureConnection',this.onConnect),e}else{const e=c.default.createServer();return e.on('connection',this.onConnect),e}}selectServer(){const e=f.Balancer.getFastest();(null===this._fastestServer||e.id!==this._fastestServer.id)&&(this._fastestServer=e,h.Config.initServer(e),b.logger.info(`[balancer] use: ${e.host}:${e.port}`))}onConnect(e){__IS_CLIENT__&&this.selectServer();const t=(0,g.default)(),n=new _.Relay({socket:e});n.id=t,n.on('close',()=>{this._relays=this._relays.filter((e)=>e.id!==t)}),this._relays.push(n),b.logger.verbose(`[hub] [${e.remoteAddress}:${e.remotePort}] connected`)}onClose(){null!==this._localServer&&(this._relays.forEach((e)=>e.destroy()),this._relays=null,(0,y.cleanup)(),__IS_CLIENT__&&(f.Balancer.destroy(),this._isFirstWorker&&b.logger.info('==> [balancer] stopped')),this._localServer.close(),this._localServer=null,this._isFirstWorker&&b.logger.info('==> [hub] shutdown'),this.emit('close'))}}t.Hub=k},function(e){'use strict';function t(e){if('string'==typeof e)return e;if(r(e))return f?f.call(e):'';var t=e+'';return'0'==t&&1/e==-o?'-0':t}function n(e){return!!e&&'object'==typeof e}function r(e){return'symbol'==typeof e||n(e)&&p.call(e)==s}function a(e){return null==e?'':t(e)}var o=1/0,s='[object Symbol]',i='object'==typeof global&&global&&global.Object===Object&&global,d='object'==typeof self&&self&&self.Object===Object&&self,l=i||d||Function('return this')(),c=Object.prototype,u=0,p=c.toString,m=l.Symbol,g=m?m.prototype:void 0,f=g?g.toString:void 0;e.exports=function(e){var t=++u;return a(e)+t}},function(e,t,n){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(a,o){try{var s=t[a](o),i=s.value}catch(e){return void n(e)}return s.done?void e(i):Promise.resolve(i).then(function(e){r('next',e)},function(e){r('throw',e)})}return r('next')})}}Object.defineProperty(t,'__esModule',{value:!0}),t.Relay=void 0;var o=n(6),s=r(o),i=n(4),d=r(i),l=n(33),c=r(l),u=n(124),p=r(u),m=n(125),g=n(32),f=n(16),h=n(0),_=n(1);const y=524288;class b extends s.default{constructor({socket:e}){super(),this._dnsCache=null,this._isConnectedToRemote=!1,this._remoteHost='',this._remotePort='',this._bsocket=null,this._fsocket=null,this._pipe=null,this._presets=[],this.onForward=this.onForward.bind(this),this.onBackward=this.onBackward.bind(this),this.onError=this.onError.bind(this),this.onBackwardSocketTimeout=this.onBackwardSocketTimeout.bind(this),this.onBackwardSocketClose=this.onBackwardSocketClose.bind(this),this.onForwardSocketTimeout=this.onForwardSocketTimeout.bind(this),this.onForwardSocketClose=this.onForwardSocketClose.bind(this),this.sendForward=this.sendForward.bind(this),this.sendBackward=this.sendBackward.bind(this),this.connect=this.connect.bind(this),this.setPresets=this.setPresets.bind(this),this.destroy=this.destroy.bind(this),this._dnsCache=new g.DNSCache({expire:__DNS_EXPIRE__}),this._remoteHost=e.remoteAddress,this._remotePort=e.remotePort,this._bsocket=e,this._bsocket.on('error',this.onError),this._bsocket.on('close',this.onBackwardSocketClose),this._bsocket.on('timeout',this.onBackwardSocketTimeout),this._bsocket.on('data',this.onForward),this._bsocket.setTimeout(__TIMEOUT__);let t=__PRESETS__;__IS_CLIENT__&&!['proxy','tunnel'].includes(t[0].name)&&(t=[{name:'proxy'}].concat(t)),'tracker'!==t[t.length-1].name&&(t=t.concat([{name:'tracker'}])),this._presets=t,this._pipe=this.createPipe(t),this.broadcast({type:_.CONNECTION_CREATED,payload:{host:this._remoteHost,port:this._remotePort}})}get remote(){return`${this._remoteHost}:${this._remotePort}`}get fsocketWritable(){return this._fsocket&&!this._fsocket.destroyed&&this._fsocket.writable}get bsocketWritable(){return this._bsocket&&!this._bsocket.destroyed&&this._bsocket.writable}onError(e){h.logger.warn(`[relay] [${this.remote}] ${e.code||''} - ${e.message}`)}onForward(e){if(this.fsocketWritable||!this._isConnectedToRemote){const t=__IS_CLIENT__?f.MIDDLEWARE_DIRECTION_UPWARD:f.MIDDLEWARE_DIRECTION_DOWNWARD;this._pipe.feed(t,e)}this._fsocket&&this._fsocket.bufferSize>=y&&(h.logger.debug(`[relay] bsocket recv paused due to fsocket.bufferSize=${this._fsocket.bufferSize} > ${y}`),this._bsocket.pause(),this._fsocket.once('drain',()=>{this._bsocket&&!this._bsocket.destroyed&&(h.logger.debug('[relay] bsocket resume to recv'),this._bsocket.resume())}))}onForwardSocketTimeout(){h.logger.warn(`[relay] [${this.remote}] timeout: no I/O on the connection for ${__TIMEOUT__/1e3}s`),this.onForwardSocketClose()}onForwardSocketClose(){if(this._fsocket&&(this._fsocket.destroy(),this._fsocket=null),this._bsocket){const e=this._bsocket.bufferSize-(__IS_TLS__?1:0);0<e?this._bsocket.once('drain',this.onBackwardSocketClose):this.onBackwardSocketClose()}}onBackward(e){if(this.bsocketWritable){const t=__IS_CLIENT__?f.MIDDLEWARE_DIRECTION_DOWNWARD:f.MIDDLEWARE_DIRECTION_UPWARD;this._pipe.feed(t,e)}this._bsocket&&this._bsocket.bufferSize>=y&&(h.logger.debug(`[relay] fsocket recv paused due to bsocket.bufferSize=${this._bsocket.bufferSize} > ${y}`),this._fsocket.pause(),this._bsocket.once('drain',()=>{this._fsocket&&!this._fsocket.destroyed&&(h.logger.debug('[relay] fsocket resume to recv'),this._fsocket.resume())}))}onBackwardSocketTimeout(){h.logger.warn(`[relay] [${this.remote}] timeout: no I/O on the connection for ${__TIMEOUT__/1e3}s`),this.onBackwardSocketClose()}onBackwardSocketClose(){if(this._bsocket&&(this.broadcast({type:_.CONNECTION_WILL_CLOSE,payload:{host:this._remoteHost,port:this._remotePort}}),this._bsocket.destroy(),this._bsocket=null,this.broadcast({type:_.CONNECTION_CLOSED,payload:{host:this._remoteHost,port:this._remotePort}}),this._pipe.destroy(),this._pipe=null,this.emit('close')),this._fsocket){const e=this._fsocket.bufferSize-(__IS_TLS__?1:0);0<e?this._fsocket.once('drain',this.onForwardSocketClose):this.onForwardSocketClose()}}sendForward(e){__IS_CLIENT__?this.fsocketWritable&&this._fsocket.write(e):this.bsocketWritable&&this._bsocket.write(e)}sendBackward(e){__IS_CLIENT__?this.bsocketWritable&&this._bsocket.write(e):this.fsocketWritable&&this._fsocket.write(e)}broadcast(e){this._pipe&&this._pipe.broadcast('pipe',e)}connect({host:e,port:t}){var n=this;return a(function*(){if(!(0,h.isValidHostname)(e)||!(0,h.isValidPort)(t))return h.logger.warn(`unexpected host=${e} port=${t}`),void n.onBackwardSocketClose();let r=null;try{r=yield n._dnsCache.get(e)}catch(r){h.logger.error(`[relay] [${n.remote}] fail to resolve host ${e}:${t}: ${r.message}`)}return h.logger.info(`[relay] [${n.remote}] connecting to: ${e}(${r}):${t}`),new Promise(function(a){n._fsocket&&!n._fsocket.destroyed&&(n._fsocket.destroy(),n._fsocket=null),n._fsocket=__IS_CLIENT__&&__IS_TLS__?c.default.connect({host:e,port:t,ca:[__TLS_CERT__]},function(){return a(n._fsocket)}):d.default.connect({host:r,port:t},function(){return a(n._fsocket)}),n._fsocket.on('error',n.onError),n._fsocket.on('close',n.onForwardSocketClose),n._fsocket.on('timeout',n.onForwardSocketTimeout),n._fsocket.on('data',n.onBackward),n._fsocket.setTimeout(__TIMEOUT__)})})()}setPresets(e){this._presets=e(this._presets),this._pipe.destroy(),this._pipe=this.createPipe(this._presets)}createPipe(e){const t=e.map((e)=>(0,f.createMiddleware)(e.name,e.params||{})),n=new m.Pipe;return n.on('broadcast',p.default.bind(this)),n.on(`next_${f.MIDDLEWARE_DIRECTION_UPWARD}`,this.sendForward),n.on(`next_${f.MIDDLEWARE_DIRECTION_DOWNWARD}`,this.sendBackward),n.setMiddlewares(t),n}destroy(){this.onForwardSocketClose(),this.onBackwardSocketClose()}}t.Relay=b},function(e,t,n){'use strict';function r(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(a,o){try{var s=t[a](o),i=s.value}catch(e){return void n(e)}return s.done?void e(i):Promise.resolve(i).then(function(e){r('next',e)},function(e){r('throw',e)})}return r('next')})}}Object.defineProperty(t,'__esModule',{value:!0});var a=function(){function e(e,t){var n=[],r=!0,a=!1,o;try{for(var s=e[Symbol.iterator](),i;!(r=(i=s.next()).done)&&(n.push(i.value),!(t&&n.length===t));r=!0);}catch(e){a=!0,o=e}finally{try{!r&&s['return']&&s['return']()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}();let o=(()=>{var e=r(function*(e){var t=e.payload;const n=t.host,r=t.port,a=t.onConnected;__IS_SERVER__&&(yield this.connect({host:n,port:r})),__IS_CLIENT__&&(i.logger.info(`[relay] [${this.remote}] request: ${n}:${r}`),yield this.connect({host:__SERVER_HOST__,port:__SERVER_PORT__})),this._isConnectedToRemote=!0,'function'==typeof a&&a()});return function(){return e.apply(this,arguments)}})(),s=(()=>{var e=r(function*(e){var t=e.payload;const n=t.name,r=t.message;if(i.logger.error(`[relay] [${this.remote}] preset "${n}" fail to process: ${r}`),__IS_CLIENT__&&(i.logger.warn(`[relay] [${this.remote}] connection closed`),this.destroy()),__IS_SERVER__)if(__REDIRECT__){const t=e.payload.orgData;var o=__REDIRECT__.split(':'),s=a(o,2);const n=s[0],r=s[1];i.logger.warn(`[relay] [${this.remote}] connection is redirecting to: ${n}:${r}`),this.setPresets(function(){return[{name:'tracker'}]});const d=yield this.connect({host:n,port:+r});d&&d.writable&&d.write(t)}else{this._bsocket&&this._bsocket.pause(),this._fsocket&&this._fsocket.pause();const e=(0,i.getRandomInt)(10,40);i.logger.warn(`[relay] [${this.remote}] connection will be closed in ${e}s...`),setTimeout(this.destroy,1e3*e)}});return function(){return e.apply(this,arguments)}})();t.default=function(e){const t=l[e.type];'function'==typeof t?t.call(this,e):i.logger.warn(`unhandled action type: ${e.type}`)};var i=n(0),d=n(1);const l={[d.CONNECT_TO_REMOTE]:o,[d.PRESET_FAILED]:s,[d.PRESET_CLOSE_CONNECTION]:function(){i.logger.info(`[relay] [${this.remote}] preset request to close connection`),this.destroy()},[d.PRESET_PAUSE_RECV]:function(){__IS_SERVER__?this._bsocket&&this._bsocket.pause():this._fsocket&&this._fsocket.pause()},[d.PRESET_RESUME_RECV]:function(){__IS_SERVER__?this._bsocket&&this._bsocket.resume():this._fsocket&&this._fsocket.resume()},[d.PRESET_PAUSE_SEND]:function(){__IS_SERVER__?this._fsocket&&this._fsocket.pause():this._bsocket&&this._bsocket.pause()},[d.PRESET_RESUME_SEND]:function(){__IS_SERVER__?this._fsocket&&this._fsocket.resume():this._bsocket&&this._bsocket.resume()}}},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.Pipe=void 0;var r=n(6),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=n(16),s=n(1);class i extends a.default{constructor(){super(),this._upstream_middlewares=[],this._downstream_middlewares=[],this._cacheBuffer=null,this.broadcast=this.broadcast.bind(this)}broadcast(e,t){const n=this.getMiddlewares(),r=[];var a=!0,o=!1,s;try{for(var i=n[Symbol.iterator](),d;!(a=(d=i.next()).done);a=!0){const n=d.value;n.name!==e&&r.push(n.notify(t))}}catch(e){o=!0,s=e}finally{try{!a&&i.return&&i.return()}finally{if(o)throw s}}'pipe'!==e&&r.every((e)=>!1==!!e)&&this.emit('broadcast',t)}setMiddlewares(e){var t=!0,n=!1,r;try{for(var a=e[Symbol.iterator](),o;!(t=(o=a.next()).done);t=!0){const e=o.value;e.setMaxListeners(4),e.on('broadcast',this.broadcast),e.on('fail',(e,t)=>void this.broadcast(e,{type:s.PRESET_FAILED,payload:{name:e,message:t,orgData:this._cacheBuffer}}))}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}this._upstream_middlewares=e,this._downstream_middlewares=[].concat(e).reverse()}getMiddlewares(e=o.MIDDLEWARE_DIRECTION_UPWARD){return e===o.MIDDLEWARE_DIRECTION_UPWARD?this._upstream_middlewares:this._downstream_middlewares}feed(e,t){this._cacheBuffer=t;const n=`next_${e}`,r=this.getMiddlewares(e),a=(t,r=!1)=>this.emit(r?`next_${-e}`:n,t),o=r.reduce((t,r)=>(t.hasListener(n)||t.on(n,(t)=>r.write(e,{buffer:t,direct:a})),r));o.hasListener(n)||o.on(n,a),r[0].write(e,{buffer:t,direct:a})}destroy(){const e=this.getMiddlewares();var t=!0,n=!1,r;try{for(var a=e[Symbol.iterator](),o;!(t=(o=a.next()).done);t=!0){const e=o.value;e.onDestroy()}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}this._upstream_middlewares=null,this._downstream_middlewares=null,this._cacheBuffer=null,this.removeAllListeners()}}t.Pipe=i}]);
//# sourceMappingURL=blinksocks.js.map